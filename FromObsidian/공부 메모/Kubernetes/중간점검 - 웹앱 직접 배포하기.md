
### 1. 워드프레스 배포

1. MySQL
| 키              | 값                        |
| --------------- | ------------------------- |
| 컨테이너 이미지 | mariadb:10.7              |
| 포트            | 3306                      |
| 환경변수        | MYSQL_DATABASE: wordpress |
| 환경변수        | MYSQL_ROOT_PASSWORD: password                          |

2. WordPress
| 키              | 값                                  |
| --------------- | ----------------------------------- |
| 컨테이너 이미지 | wordpress:5.9.1-php8.1-apache       |
| 포트            | 80                                  |
| 환경변수        | WORDPRESS_DB_HOST: [wordpress host] |
| 환경변수        | WORDPRESS_DB_NAME: wordpress        |
| 환경변수        | WORDPRESS_DB_USER: root             |
| 환경변수        | WORDPRESS_DB_PASSWORD: password                                    |
- 추가) NodePort 구성 : 30000:80

- [[k8s_Service]]에서 배운 거로 생각하면
- MySQL에서 Deployment + Service를 만들어야 함
- Wordpress에선 Deployment만 만들면 됨

- 근데 막히는 지점이 있음
1. wordpress -> mysql로 어떻게 접근 설정을 만듦?
- mysql의 포트가 3306이란 말임? 그러면 워드프레스에서 mysql를 연결하는 설정을 만들어줘야 하잖음? 그걸 어디에 만들지?
	- mysql 문서를 봤는데 포트 설정에 관한 환경 변수는 없음

- `env` 항목에서는
	```
	- name:
	  value: 
	```
	로 넣는다..
----------
- 사실 정답은 [[워드프레스 배포하기]]에 있는데, 1개의 파일로 통합할 수 있다(나는 2개로 진행했음;)

- 잘 되는가 확인하려면 `minikube service wordpress` 입력

- 오류 : `Error Establishing a database connection`
	- 이거 원래 워드프레스 실행할 때도 발생했음
	- 찾아보니까 DB에 대한 정보가 정확한지 확인하라고 함(아마 WORDPRESS_DB_HOST 부분인 것 같음) 
#### 내 정답
- 정답과 다른 부분은 표시해둠
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql # wordpress-mysql
  #################
  labels: 
    app: wordpress 
  #################
spec:
  selector:
    matchLabels:
      app: mysql # 정답: wordpress
      tier: db # 정답 : mysql
  template:
    metadata:
      labels:
        app: mysql # 정답 : wordpress
        tier: db # 정답 : mysql
    spec:
      containers:
        - name: mysql
          image: mariadb:10.7
          ports:
            - containerPort: 3306
              protocol: TCP # 정답에 없음
              name: mysql # 
          env:
            - name: MYSQL_DATABASE
              value: wordpress
            - name: MYSQL_ROOT_PASSWORD
              value: password
---
apiVersion: v1
kind: Service
metadata:
  name: mysql # 정답 : wordpress-mysql
  ##########
  labels:
    app: wordpress
  ##########
spec:
  ports:
    - port: 3306
      protocol: TCP # 정답에 없음
  selector:
    app: mysql # 정답 : wordpress
    tier: db # 정답 : mysql
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wordpress
  ###########
  labels:
    app: wordpress
  ###########
spec:
  selector:
    matchLabels:
      app: wordpress
      tier: frontend
  template:
    metadata:
      labels:
        app: wordpress
        tier: frontend
    spec:
      containers:
        - name: wordpress
          image: wordpress:5.9.1-php8.1-apache
          ports:
            - containerPort: 80
              protocol: TCP # 정답에 없음
            #  name: wordpress 
          env:
            - name: WORDPRESS_DB_HOST
              value: dowrave # 정답 : wordpress-mysql
            - name: WORDPRESS_DB_NAME
              value: wordpress
            - name: WORDPRESS_DB_USER
              value: root
            - name: WORDPRESS_DB_PASSWORD
              value: password
---
apiVersion: v1
kind: Service
metadata:
  name: wordpress
  #######
  labels:
    app: wordpress
  #######
spec:
  # type: NodePort 
  ports:
    - port: 80
      protocol: TCP # 정답에 없음
    # nodePort: 30000 
  selector:
    app: wordpress
    tier: frontend
```

### 2. 투표 어플리케이션 배포
- [여기](https://subicura.com/k8s/guide/sample.html#%E1%84%8B%E1%85%AF%E1%84%83%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%A6%E1%84%89%E1%85%B3-%E1%84%87%E1%85%A2%E1%84%91%E1%85%A9)부터 계~속