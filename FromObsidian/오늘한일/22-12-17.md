- 도커 이미지 생성 & 배포

### 트러블슈팅
#### 1.  [[도커 이미지 생성(dockerfile)]] 실습 중
```
docker run --rm \
-p 4567:4567 \
-v $PWD:/usr/src/app \
-w /usr/src/app \
ruby \
bash -c "bundle install && bundle exec ruby app.rb -o 0.0.0.0"
```
- 나는 `Couldn't find handler for: thin, falcon, puma, HTTP, webrick. (LoadError)`이라는 오류가 떴음 -> 저 본문에 반영함(`Gemfile` 수정)
	해결법으로는 둘 중 하나 고르면 됨
	1. `thin`, `puma`, `reel`, `http`, `webrick`에 대해 `gem install {packages}`를 적용하는 것
	2. **`gemfile`에 위의 명령어들 추가하고 `bundle install` 돌리기**
	2가 편해보이니까 2로 감

#### 2. [[도커 이미지 생성(dockerfile)]] 실습 중 이미지 생성이 정상적으로 안됨
```dockerfile
FROM ruby:2.3
MAINTAINER subicura@subicura.com

COPY Gemfile* /usr/src/app{/}
WORKDIR /usr/src/app{/}
RUN bundle install {--no-rdoc --no-ri}
COPY . /usr/src/app{/}

EXPOSE 4567
CMD bundle exec ruby app.rb -o 0.0.0.0
```
1. 경로는 끝까지 `/`을 쳐줘야 한다. :  `usr/src/app`이 아니라 `usr/src/app/`

2. `bundle`에는 `rdoc` 옵션과 `ri` 옵션이 없다.  `RUN bundle install`만 남겨도 무방
	2-1.  `RUN bundle install`만 남겼을 때 발생하는 오류 : `# [You must use Bundler 2 or greater with this lockfile]`
		- `Gemfile.lock` 때문에 발생하는 오류로 이를 지워주면 됨(bundle install을 하면 만들어지는 파일인 것 같음 : 이미 있다면 제거해주자)

#### 3. [[도커 이미지 배포]] 중
```
docker push subicura/sinatra-app:1
```
- `denied: requested access to the resource is denied`
- 원인 : 이미지를 올릴 때 `user_id/appname:version` 형식으로 작성하는데, 여기서 `user_id`는 우분투에서 도커에 접속한 `user_id`와 동일해야 한다.
- `subicura`는 위 가이드를 작성한 분의 아이디이기 때문에 내 아이디로 바꿔서 작성하면 됨.

#### 4. 실습 종료 후 정리하는 과정에서
```
docker rmi {image_id}
```
하는 과정에서 `docker tag`로 바꾼 이미지들이 삭제되지 않는 현상이 있었음(여러 개의 이름을 가지느 공통된 `image_id`를 가짐)
- `docker rmi -f {image_id}`로 삭제하면 됨 (`-f` : `forced`)