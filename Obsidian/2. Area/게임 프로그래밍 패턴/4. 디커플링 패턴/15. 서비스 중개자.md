#게임프로그래밍패턴

1. [[#책 내용|책 내용]]
	1. [[#책 내용#문제 상황 : 결합도 지옥|문제 상황 : 결합도 지옥]]
	2. [[#책 내용#해결책 : 중개자Locator 두기|해결책 : 중개자Locator 두기]]
	3. [[#책 내용#장점|장점]]
2. [[#유니티에서|유니티에서]]
	1. [[#유니티에서#간단한 서비스 중개자 구현|간단한 서비스 중개자 구현]]
	2. [[#유니티에서#널 객체 패턴(Null Object Pattern)과의 결합|널 객체 패턴(Null Object Pattern)과의 결합]]
3. [[#유니티에서 사용 시 주의할 점|유니티에서 사용 시 주의할 점]]
	1. [[#유니티에서 사용 시 주의할 점#싱글턴 vs 서비스 중개자 vs 의존성 주입|싱글턴 vs 서비스 중개자 vs 의존성 주입]]
	2. [[#유니티에서 사용 시 주의할 점#유니티에서의 DI 프레임워크|유니티에서의 DI 프레임워크]]
	3. [[#유니티에서 사용 시 주의할 점#요약|요약]]

## 책 내용

### 문제 상황 : 결합도 지옥
- 오디오 시스템, 물리 시스템, 렌더링 시스템 등 전역적으로 쓰이는 시스템들을 클래스마다 싱글턴으로 직접 부르면?

- 문제 1 : 나중에 `AudioSystem`을 `AdvancedAudioSystem`으로 바꾸면 코드를 수천 곳에서 고쳐야 함
- 문제 2 : 테스트할 때 소리를 끄고 싶은데 실제 오디오 시스템이 로딩되어서 에러가 남

### 해결책 : 중개자Locator 두기
- 직접 시스템을 찾는 대신, `안내 데스크Locator`에게 물어보게 한다.

- 서비스 인터페이스 : `IAudio`
- 서비스 제공자 : `ConsoleAudio`, `LoggedAudio` (실제 구현체)
- 중개자(Locator) : 서비스를 `등록Provide`하고 `찾아주는Get` 정적 클래스

```cpp
// 사용 코드
IAudio* audio = Locator::getAudio();
audio->playSound("Bang");
```

사용하는 쪽에선 실제 오디오가 콘솔용인지, PC용인지, 아무 소리가 나지 않는 가짜인지 몰라도 된다. `IAudio` 인터페이스만 보고 쓴다.

### 장점
- 교체 용이 : `Locator:provide(new NullAudio())`만 넣으면 게임 전체의 사운드를 끌 수 있다.
	- 디버깅, 테스트에 최고.
- 지연 초기화 : 필요할 때 서비스를 등록할 수 있다.

## 유니티에서
- 싱글턴의 대안, 혹은 의존성 주입의 전 단계로 쓰인다.

### 간단한 서비스 중개자 구현
```cs
public interface IAudioService 
{
    void PlaySound(string name);
}

public static class ServiceLocator
{
    private static IAudioService _audioService;

    // 서비스 등록 (보통 게임 시작 시 GameManager가 함)
    public static void Provide(IAudioService service)
    {
        _audioService = service;
    }

    // 서비스 요청 (어디서든 호출)
    public static IAudioService GetAudio()
    {
        return _audioService;
    }
}
```

### 널 객체 패턴(Null Object Pattern)과의 결합
- 서비스가 등록되지 않았는데 `null`을 리턴하면 게임이 터진다.
- 그래서 아무 일도 하지 않는 객체를 기본값으로 넣는 게 좋다.
```cs
public class NullAudioService : IAudioService
{
    public void PlaySound(string name) { /* 아무것도 안 함 */ }
}

// Locator 초기화 시
private static IAudioService _audioService = new NullAudioService();
```

이렇게 하면 오디오 시스템이 고장나도 게임이 멈추지 않고 잘 돌아간다. 소리만 안 남.

## 유니티에서 사용 시 주의할 점

### 싱글턴 vs 서비스 중개자 vs 의존성 주입
- 전역 시스템에 어떻게 접근할까? 에 대한 진화 과정이다.

- 싱글턴 : `AudioManager.Instance.Play()`
	- 가장 쉽지만 가장 뻣뻣하다. 교체가 어렵다.
- 서비스 중개자 : `ServiceLocator.Get<IAudio>().Play()`
	- 교체가 가능하지만 여전히 전역 상태를 사용한다.
- 의존성 주입`DI` : `Inject`
	- `public player(IAudio audio) { ... }`
	- 가장 유연하고 깔끔하다. 전역 상태가 없다.

### 유니티에서의 DI 프레임워크
- 현대 유니티 프로젝트에서는 서비스 중개자를 직접 짜기보다는 `DI 프레임워크`를 쓰는 추세다.
- DI 컨테이너가 자동화된 서비스 중개자 역할을 한다.
```cs
// 설정 파일에서
builder.Register<IAudioService, RealAudioService>(Lifetime.Singleton);

// 사용하는 곳 (자동 주입)
[Inject] IAudioService audio;
```

### 요약
- **싱글턴이 10개를 넘어간다면 서비스 중개자 도입을 검토**해보자. `ServiceLocator.Get<T>()` 1개로 통일할 수 있다.
- 테스트/디버깅에도 유용하다. `NulAudio, MockNetwork` 등의 비어 있는(하지만 오류를 발생시키지 않는) 객체로 바꿔끼우면 되기 때문이다.
- **나중에는 DI 프레임워크를 공부하면 좋다.** 구조가 훨씬 탄탄해진다. 