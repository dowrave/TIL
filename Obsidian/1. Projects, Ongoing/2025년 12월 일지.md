
>[!note]
>
>  **"흐름"으로 설명하는 것 외에도 "원리"도 곁들이면 좋다**
> - 지금은 "어떤 이슈가 발생해서 어떻게 해결했더라"로 정리했다면
> - 추가로 **이슈가 '왜' 발생했는지**까지 정리해두면 나중에 볼 때 다시 헷갈리지 않을 수 있음
> 
> 모든 코드를 일일이 기억하는 건 불가능함! 나중에 봤을 때 '이러면 되겠다'는 감이 바로 잡히도록 메모해보자.

>[!objective]
>- 프로젝트가 계속 늘어지는 관계로 완료 기준을 정해놓기로 한다.
>- [[프로젝트 완료 기준에 대해]]
> 	- 소리 추가(BGM 2~3개 + SFX 5개 정도? 링크 참조)
> 	- 이전 스테이지 요소들이 반영된 다음 스테이지 설계 및 밸런스 조절
> 	- 포폴용 프로젝트니까 **진행이 안되지 않는 이상 버그 수정은 자제**
> 	- 치트키 구현 (F1 키 등으로 스테이지 바로 클리어할 수 있게끔)
> - 완료 후에는 프로젝트에 관한 글도 적어두면 좋을 듯
> 	- 무엇을 구현했는지
> 	- 왜 늘어졌는지 등등


## 251204

>[!done]
>- 플레이 테스트 및 밸런스 조정
>	- 코스트 회복 속도 관련

## 플레이 테스트 및 밸런스 조정
### 코스트 회복 속도 관련

전반적으로 게임이 무겁게 느껴진다. 돌발 상황이 생겼을 때 그거에 대응할 자원이 없는 경우가 많다. 지금까지는 코스트가 없는 경우가 많음(오퍼레이터를 배치할 수 있음에도)

여기에 영향을 주는 요소가 크게 아래와 같은데,
- 적의 이동 속도
- 배치 코스트 자연 회복 속도
- 초기 코스트

이 수치들을 만져가면서 적합한 지점을 찾아봐야겠음

- 적 이동속도 : 약 70%로 설정
- 투사체 속도 : 5 -> 3
		- (모든 투사체 속도가 동일했다)

이동속도 낮춘 게 많이 괜찮아 보인다. 


> 일단 지금 포커스를 두고 있는 건 '**뱅가드 육성 없이 게임을 깰 수 있는가?**'이다.



## 기타 이슈 수정

### 스테이지 클리어 로직 중
- 3성 이하로 클리어한 스테이지를 다시 깼는데 기존보다 수치가 같거나 낮을 때에 대한 처리가 작성되어 있지 않았음
```cs
	// 기존 기록보다 더 잘 클리어했을 때
	if (resultInfo.stars < stars)
	{
		if (resultInfo.stars == 1)
		{
			if (stars == 2) return 0.25f;
			if (stars == 3) return 0.75f;
		}
		else if (resultInfo.stars == 2)
		{
			if (stars == 3) return 0.5f;
		}
	}
	// 추가
	else 
	{
		// 기존 기록과 같거나 더 못 깼을때
		return 0f;
	}

	throw new InvalidOperationException("FirstClearItemRate의 예상치 못한 동작");
```
> `stars`가 이번에 클리어한 스테이지의 기록, `resultInfo.stars`가 기존 기록이라고 할 때, 여기까지만 작성하면 "기존 기록보다 더 못 깼을 때"에 오류가 발생함
> 단순하게 `else` 문에 `return 0f`만 달아주면 해결되는 이슈였다. 최초 클리어 보상에 관한 메서드이기 떄문.

### AreaHasteHeal 스킬에서 힐이 안 나감
- `AreaHasteHealController`에는 `Initialize`가 없었다. 상위 클래스를 보면 
```cs
public virtual void Initialize(
	UnitEntity caster,
	IReadOnlyCollection<Vector2Int> skillRangeGridPositions,
	float fieldDuration,
	float tickDamageRatio,
	float interval,
	GameObject hitEffectPrefab,
	string hitEffectTag
	)
{
	this.caster = caster;
	this.skillRangeGridPositions = skillRangeGridPositions;
	this.fieldDuration = fieldDuration;
	this.interval = interval;
	this.tickDamageRatio = tickDamageRatio;
	this.hitEffectPrefab = hitEffectPrefab;
	this.hitEffectTag = hitEffectTag;
	
	// 이 아래 부분 추가
	if (_currentCoroutine != null)
	{
		StopCoroutine(_currentCoroutine);
		_currentCoroutine = null;
	}

	_currentCoroutine = StartCoroutine(FieldRoutine(fieldDuration, interval));
}
```
이런 구조인데, 기존엔 필드 설정하는 부분만 있었고 아래의 if문 부터는 방금 추가한 부분이다.

> - **그래서 기존에 어떻게 동작한 건지가 더 궁금하다.** 이거 없으면 틱으로 들어가는 동작이 아예 작동을 안 할텐데?
> - `ArcaneField`의 경우는 별도의 `Initialize`를 사용해서 상관 없는 이슈

#### 조금 더 개선해봄
- 부모 클래스의 `Initialize`에서 코루틴까지 한꺼번에 실행시키는 대신, `Initialize`는 구현해놓되 세부 내용은 자식 클래스에서 다시 설정하도록 하면 됨
- 대신 필드를 할당하는 메서드, 코루틴을 실행하는 메서드를 따로따로 만들고 `Initialize`에서 해당 메서드들을 실행시키는 방식
- 필드가 늘어지는 건 지금 수정하기 귀찮으니까 냅둠(..)


## 251203

>[!done]
>
>- 플레이 테스트 및 밸런스 조정
>- 기타 이슈 수정
>	- `Enemy`에 누락된 `ID, Localization Key` 등등 추가
>	- 범위 이펙트 관련 이슈 수정(텍스쳐 누락, 조건문 등등)
>	- `Artillery`의 타격 이펙트 오브젝트가 풀로 돌아가지 않는 현상 수정

## 플레이 테스트와 밸런스 조정


## 기타 이슈 수정

- `Entity`에 누락되었던 `ID, Localization Key` 값 설정

### AreaHasteHealSkill - 범위 이펙트 나타나지 않음
- 크게 2가지 문제가 있었다.
1. 텍스쳐가 사라졌음.
2. 이펙트의 경우 셰이더로만 구현한 것도 있고, 파티클 시스템으로 구현한 것도 있음 
	- 벽 이펙트가 안 나타나는 현상도 수정 완료

### Artillery - Hit VFX
1. 범위 공격에 맞은 적들 모두에게 피격 이펙트가 나타나는데 부자연스러워 보임
	- 폭발 지점은 1개여야 하는데 피격된 객체 수만큼 이펙트가 나타남
	-  `Projectile`에 붙어 있는 `CreateAreaOfDamage` 메서드를 실행할 때, 이펙트를 여기서 1회만 실행시키는 방식으로 구현했다.
		- 원래는 `UnitEntity.TakeDamage` 안에 `PlayGetHitVFX()`가 있다. 피격 로직 안에 피격 이펙트 실행 로직을 붙여놨는데, 위에서 수정한 로직과 겹치기 떄문에 `TakeDamage`에는 피격 이펙트를 실행할 지 여부를 판단하는 `bool` 파라미터를 추가해뒀다.

> 여기도 교통 정리가 필요해보이긴 하는데, **일단 게임을 완성한 다음에 시간이 있을 때 수정**하기로 하겠음. 앞으로도 부족한 부분은 계속 보일 건데, 이거 일일이 수정하다 보면 너무 시간을 많이 쓰게 된다.

2. 오브젝트 풀링 문제 
- 이펙트의 재생 시간을 초과했는데도 풀로 돌아가지 않고, 새로운 오브젝트가 풀에 계속 생성됨.
	- 이거 좀 재밌는 부분인 게 **1번을 수정하니까 2번도 고쳐졌다.**
	- 이전 코루틴 실행을 멈추는 로직도 추가했지만,
	- 처음에 생각한 오브젝트 풀에 있는 오브젝트 갯수를 초과해서 **한꺼번에 여러 개가 생겨서 실행되어서 그런 걸까? 정확한 원인은 모르겠음.**

## 251201

>[!done]
>- 스테이지 밸런스 수정
>	- `Tanker` 방어력 550 -> 400 -> 350으로 하향
>	- 스테이지 1-1 몹 생성 타이밍 수정
>	- 스테이지 1-2 맵 크기 축소 
>		- 밸런스는 더 만져야 할 듯
>- 기타 이슈 수정
>	- 바리케이드 이름 한글로 나타나지 않는 현상 수정

## 스테이지 밸런스 수정

### 1-1
- 탱커 방어력 500에서 350으로 하향
- 탱커 생성 시간 간격 조정

### 1-2 
- 맵 크기 축소(비슷한 구조의 맵을 새로 만듦)
- `Default` 몹들 전반적으로 하향해야 할 듯? `Ghost`도 이속이나 체력 깎아야 할 것 같다.





## 기타 이슈 수정
### 바리케이드 이름 한글로 나타나지 않는 현상
```cs
private void UpdateDeployableInfo()
{
	HideOperatorPanels();
	// nameText.text = currentDeployableInfo.deployableUnitData?.EntityID ?? string.Empty;
	nameText.text = GameManagement.Instance!.LocalizationManager.GetText(currentDeployableInfo.deployableUnitData?.EntityNameLocalizationKey) ?? string.Empty;
}
```

### `RetreatButton` 입력 시 천천히 사라지는 현상
- 바리케이드에서 보였던 이슈다. 퇴각 버튼은 바로 사라지게끔 구현해야 할 듯
- 버튼을 입력했을 때 `deployable.Retreat()`이 있는데 막상 `deployableUnitEntity.Retreat()`의 디버깅 로그는 관찰이 안 됨.

- 아 **`Barricade`에 `Retreat` 메서드가 따로 있었다. ㅋㅋㅋㅋㅋㅋㅋㅋㅋㅋㅋ**
```cs
public override void Retreat()
{
	UndeployBarricade();
	base.Retreat();
}

protected override void Die()
{
	UndeployBarricade();
	base.Die();
}

private void UndeployBarricade()
{
	CurrentTile!.ToggleWalkable(true); // 현재 타일 이동 가능으로 변경
	PathfindingManager.Instance!.RemoveBarricade(this); // 바리케이드 리스트에서 제거
	OnBarricadeRemoved?.Invoke(this); // 제거 이벤트 발생
}
```

바리케이드에는 경로 관련 요소가 있기 때문에 이걸 별도의 메서드로 구분하고 그 외에는 `DeployableUnitEntity`의 로직이 동작하도록 수정했음.


- `Guard - SlashSkill` 버튼 입력시 오류 발생
	- 스킬 태그를 못 찾는다고 함
```cs
            GameObject effectObj = ObjectPoolManager.Instance.SpawnFromPool(GetSlashControllerTag(caster.OperatorData), caster.transform.position, caster.transform.rotation);
```
> `SO`자체가 `string skillTag`로 갖고 있는 구현이 안 좋아서 이전에 수정했는데, 이 부분은 메서드를 만들어놓고 그냥 지나간 듯.

## 발견했으나 간헐적이라 수정하지 않음
- `Guard`가 저지하는 적이 없는데도 적이 `Guard`에 의해 저지되지 않고 그냥 진행하는 현상




