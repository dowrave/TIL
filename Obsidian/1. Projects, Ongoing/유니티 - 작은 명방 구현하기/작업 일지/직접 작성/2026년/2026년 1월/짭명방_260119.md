
>[!done]
> - `BuffVFX`
> 	- 필요 없다고 생각해서 지웠는데 필요함. 
> 	- **디버프 이펙트(스턴, 슬로우)가 필요하다.**
> 	- 오브젝트 풀링에서 스테이지 시작 시에 생성되도록 변경
> - `SlowBuff`
> 	- VFX 추가
> 	- 감을 다 잃었다. 이미지 작업은 자제하거나 AI님의 도움을 받자.
> 		- 제미나이는 투명한 배경 이미지를 못 만든다. grok이나 chatGPT가 더 나음.
> - 기타 이슈 / 수정사항
> 	- `AreaHasteHeal` : `Barricade`에도 힐이 들어가는 이슈
> 	- `ArcaneFieldSkill` : 둔화율 30% -> 50%로 증가

### Buff VFX 효과 복구
- 버프에 VFX를 달아뒀던 이유는 `Stun, Slow` 등의 효과를 시각화하기 위함이었음
- 이걸 모르고 주석처리해뒀다. 다행히 지우진 않았어서 원래대로 돌려놓고 주석 추가

> [!note]
> - 참고) 버프의 VFX를 가져오는 방식은 `BuffVFXManager.GetBuffVFXObject(Buff, Transform)`으로 가져옴

#### 추가) 스테이지 불러올 때 Buff의 VFX들도 사전에 생성되도록 수정
```cs
// 기존 코드 : BuffVFXManager
private void Start()
{
	if (Instance == null)
	{
		Instance = this;
		if (VFXDatabase != null)
		{
			// 여기서 VFX 오브젝트 풀을 만듦	
			VFXDatabase.Initialize();
		}
	}
	else
	{
		Destroy(gameObject);
	}
}
```

이전에 오브젝트 풀링으로 관리되는 객체들은 모두 스테이지가 시작되는 시점에 생성되도록 옮겨놨는데, 버프 VFX는 해당 로직에서 빠져 있음

1. `VFXDatabase.Initlaize()` 부분이 갖고 있는 버프의 VFX들을 생성하는 과정이다. 저 부분을 `BuffVFXManager`의 별도 코드로 분리하고, `StageManager`의 오브젝트들을 생성하는 과정에 끼워넣었음.
2. (크게 중요한 부분은 아니지만) 로딩 화면에서 로딩 화면 게이지를 채우는 로직이 있고 이 로직의 기반이 오브젝트 갯수이므로 "총 생성해야 하는 오브젝트의 갯수"를 얻기 위한 코드도 별도로 구현해줬음

```cs
// StageManager.cs
private IEnumerator PreloadStageObjectPoolsCoroutine(List<SquadOperatorInfo> squadData, Action<float> onProgress)
{
	// ...
	
	float buffVFXTasks = BuffVFXManager.Instance.GetAllVFXPoolCounts();
	float totalTasks = enemyCountDict.Count + squadData.Count + (stageData?.mapDeployables?.Count ?? 0) + buffVFXTasks;
	float completedTasks = 0f;

	// ...

	// 3. Buff의 오브젝트 풀들 생성
	// 이 메서드가 Awake, OnEnable 후에 실행되므로 사용 가능함
	BuffVFXManager.Instance.CreateBuffVFXPools();
}
```

### SlowBuff VFX 구현

- 초안
- 계속 나타나야 함
- 발 밑에 나타남(버프 VFX 설정의 `offset`으로 가능)

...을 갖고 작업했으나 상상력의 부족 + 슬로우 디버프 레퍼런스가 생각보다 없어서 그냥 로고로 구현하는 걸로 진행

![[Pasted image 20260119181227.png]]


...도 생각보다 직관적이지 않다. 화살표를 겹치면 안될 것 같긴 함.

- 그것보다도 가장 단순한 느낌으로 아래 2개 화살표 텍스쳐를 하나 그리고 슬로우에 걸리면 파티클이 위에서 아래로 내려가는 형태로 만들어보겠음.

![[SlowBuff01_256.png]]
를 텍스쳐 시트에 추가

상단 아이콘도 달팽이를 추가했음. 
> AI에게 아이디어 스케치를 요청하는 방법이 꽤 괜찮아보인다. 

- 셰이더 감을 다 잃어서 생각보다 애먹었음;;
	1. AI로 투명한 배경의 달팽이 이미지를 만듦
	2. 지속시간 동안 약간의 깜빡임 구현을 위해 시간에 따른 알파값 변화를 셰이더에 넣음
	3. 근데 원본 이미지가 분명 투명했고 프로젝트 탭에서도 투명하게 나오는데 셰이더에 텍스쳐를 집어넣으면 텍스쳐에 정체불명의 흰색들이 나옴
		- 이 흰색 처리 방법 때문에 한참 헤맸다.
		- 원본 이미지에 `Color`와 `Vertex Color`을 곱한 뒤에, 알파값만 `Split`해서 따로 처리하면 됨. 
		- 이 경우, 알파값의 깜빡임을 따로 구현해놨으니까 그 값이랑 분리한 알파값을 곱해서 마스터 노드의 알파값에 전달하면 된다. 
![[Pasted image 20260119215405.png]]
이펙트 구현해서 `BuffVFXDatabase`에 추가하면 이런 느낌으로 나타난다.
이탈한 `Enemy`는 디버프가 풀려 있고, `ArcaneFieldSkill` 내부에 있는 `Enemy`는 `SlowBuff`가 들어간 모습을 시각적으로 확인할 수 있음. 

### 기타 이슈
- `AreaHasteHealSkill` 
	- `Barricade`에도 힐이 들어가는 이슈(이펙트가 나타남)
		- 타입 체크만 추가하면 ㅇㅋ
