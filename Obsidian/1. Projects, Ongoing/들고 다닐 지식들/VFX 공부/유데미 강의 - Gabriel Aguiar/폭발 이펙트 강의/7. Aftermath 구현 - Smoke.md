1. [[#메쉬 제작|메쉬 제작]]
2. [[#유니티 파티클 시스템|유니티 파티클 시스템]]
3. [[#마스크 셰이더 구현|마스크 셰이더 구현]]
		1. [[#그래디언트 텍스쳐 구현|그래디언트 텍스쳐 구현]]
4. [[#Distortion 구현하기|Distortion 구현하기]]
5. [[#Smoke Trail 개선하기|Smoke Trail 개선하기]]
	1. [[#Smoke Trail 개선하기#1. 너비 제한하기|1. 너비 제한하기]]
	2. [[#Smoke Trail 개선하기#2. 검은 연기를 만들고 싶은데 경계 부분이 보임|2. 검은 연기를 만들고 싶은데 경계 부분이 보임]]
6. [[#Smoke Trail 복사, 여러 곳에 배치|Smoke Trail 복사, 여러 곳에 배치]]
7. [[#지금까지의 구현|지금까지의 구현]]

## 메쉬 제작
![[Pasted image 20250910142022.png]]
- `Plane` 만듦
	- `R` - `X` 고정 - `90도 회전`
	- `S` - `X` 고정 - `.3`
	- `Ctrl + R` - 총 3등분으로 루프컷

- `O - Proportion Editing` 활성화 후 상단 `Edge` 잡고 `G - Y`로 메쉬에 굴곡이 생기게끔 구현
- 기울인 후 상단 `Edge` 잡은 상태에서 `S - X`로 위로 갈수록 넓어지게 함
- **3D 커서 이동시키기**
	- **하단 `Edge` 잡고 `Shift + S` -> `Cursor to Selected` 선택**
	- 이렇게 하면 하단 `Edge`의 중심 위치로 `3D Cursor`이 이동함
- `Set Origin`의 경우는 그냥 오브젝트 모드로 바꿔서 우클릭하는 게 가장 편한 거 같음. 강의에서 알려주는 단축키도 지금은 달라진 듯.

- `UV` 관련
![[Pasted image 20250910143818.png]]
- 기본적으로 `Plane`에서 시작했고 변형도 많지 않기 때문에 그 자체로 사용할 수 있긴 함
- 그런데 일반적으로 텍스쳐를 만들 때 방향은 왼쪽 -> 오른쪽이 보기 편한 감이 있음. 그래서 `UV Map`을 Rotation해서 아래가 왼쪽으로 오게끔 수정한다.
	- **`UV` 전체를 잡고 `R - 90`**. 직접 돌려서 수치 확인해봤다.

- `Shade Smooth` 적용 후 `Ctrl + A - Apply All Transform` 반영

> `Origin`이랑 블렌더 좌표계에서의 원점을 맞춰야 하나? 아닌가?
> 일단은 그냥 진행

## 유니티 파티클 시스템
- `Smoke` 라는 새로운 파티클 시스템을 만듦
- `GroundCrack`에 `Random Rotation`이 설정되어 있었는데 꺼줘야 한다 - **연기 메쉬의 위치를 `GroundCrack`에 정확하게 맞춰줘야 하기 때문임.**
- 기존에 구현했던 `SmokeRing(Seamless)` 텍스쳐를 `ErosionTextureShader`로 붙여주고 테스트해본다.
![[VFX_GroundCrack_SmokeTest.gif]]
- 이러한 **연기 효과를 위한 별도의 셰이더와 텍스쳐는 아래에서 구현**한다.

## 마스크 셰이더 구현
- 위 효과에서 머티리얼 자체의 밝기를 줄이고, 블렌딩 모드도 알파로 바꿔주면 더 연기 효과가 난다.
- 하지만 **가장 윗부분에서 짤리는 효과**가 보임. 이거는 셰이더 단위에서 수정해줘야 한다.

- `ErosionTextureShader`를 연다.
- `Mask(Texture2D)`를 `SampleTexture2D`에 연결, 기존의 메인 텍스쳐의 `SampleTexture2D`와 곱하는 노드를 추가한다. 나머지 부분(Color 곱하기 ~)은 이 곱하기 노드의 결과값을 이어준다.
	- 마스터 노드의 알파값도 이 마스크 * 메인 텍스쳐의 알파값으로 변경한다.

#### 그래디언트 텍스쳐 구현
- `Krita`에서 작업 진행. 왼쪽이 흰색이고 오른쪽이 검정색인 그래디언트 텍스쳐이다.

> 이 부분은 이전에 배웠듯 셰이더 그래프에서도 구현이 가능하다. 

![[Pasted image 20250910150843.png]]
> 여기서 `Power`값을 늘려주면 검은 부분을 더 증가시킬 수 있음.

하지만 위 방법의 장점은 **마스크 텍스쳐를 따로 받는 구현**이라는 점임 -> 그래서 어떤 모양으로 마스킹해줄지를 결정할 수 있음.

- 그래서 `Krita`로 그래디언트 이미지를 만들어서 넣어줬다. 
	- 캔버스 전체에 대해 그래디언트를 넣는 게 아니라 끝나는 부분은 모서리의 살짝 왼쪽에서 끝나게끔 함.

> 참고) `Krita`에서 `Gradient`를 넣을 때, **현재 어떤 툴로 작업하고 있는지에 대한 영향을 받는다.** 예를 들어서 **지우개가 켜져 있다면 그래디언트는 들어가지 않음.**

![[VFX_GroundCrack_SmokeWithMask.gif]]
마스크 적용 결과.

> 참고2) 넣어준 마스크 텍스쳐의 경우 `Wrap Mode - Repeat`를 `Clamp`로 바꿔줘야 한다. 안 그러면 메쉬의 상단 부분이 하얗게 비쳐보이는 `Aritfact`가 나타날 수 있음
> - `Artifact`라는 용어는 의도치 않은 오류? 아니면 결점? 같은 느낌으로 쓰이는 듯

## Distortion 구현하기
- `Erosion Texture Shader`에서 `Tiling And Offset`에 놓는 `UV`를 추가한다.
![[Pasted image 20250910154002.png]]
구체적으로 새로울 건 없는 구현임

노이즈에 `Tiling And Offset`을 적용해서 움직이게 하고, 원본 `UV`와 노이즈를 추가한 `UV` 사이에 `Lerp`로 그 수치를 조절하고, 이를 메인 텍스쳐의 `Tiling And Offset`에 전달하는 개념임

> Lerp에 넣는 게 UV와 노이즈가 아니라 UV와 `노이즈를 더한 UV`인 것만 제대로 알고 가면 됨

![[VFX_GroundCrack_SmokeDistortion.gif]]
`ScreenToGif`가 좀 이상하게 따는 느낌이 있는데, 저거보다는 훨씬 부드러워보인다;

## Smoke Trail 개선하기

### 1. 너비 제한하기

- 위에서 설정한 셰이더의 `DistortionAmount` 값이나 텍스쳐의 모양 등에 따라서 연기가 좌우에 나타나지 말아야 하는데 나타나는 상황이 생길 수 있음

![[Pasted image 20250910155229.png]]
> 연기 왼쪽에 뿌옇게 짤리는 부분 같은 거. 강의 영상 캡쳐다.

- 이런 경우를 방지하기 위해 마스크의 모양을 조금 더 다듬어준다. 
- 위에서 구현한 그래디언트 텍스쳐의 상단과 하단에 검정 -> 투명 그래디언트를 더 추가해주면 됨.

![[ForObsidian_WhiteToBlack02.png]]

1. 빈 레이어를 하나 만들고 그래디언트(검정 -> 투명)을 위에서 아래로 설정
2. 해당 레이어를 복사, `Ctrl + T`로 영역 밖에서 회전시킨 다음 아래 변에 붙게 이동시킨다.

### 2. 검은 연기를 만들고 싶은데 경계 부분이 보임
- 지금은 **`Additive` 모드라서 마스크가 곱해졌을 때 어두운 부분이 투명**해지지만, 어두운 색을 구현하기 위해 **`Blend` 모드를 설정했으나 마스크도 렌더링**됨.

- 이것도 마스크 텍스쳐를 새로 만들면 된다. `WhiteToTransparent`를 만들면 됨.
- 위와 마찬가지로 폭도 제한해줘야 하는데, 이 경우는 `Ctrl + R(사각형 선택 툴)`로 영역 지정 -> 상단 바의 `선택 - 선택 페더 - 반지름 25로 설정` 후 `Delete` 키를 눌러서 지워주면 된다.
- 아래를 지우려면 위 상태에서 선택 영역의 모서리에 마우스를 갖다 대면 옮길 수 있음. 그대로 아래로 옮겨서 `Delete` 키만 누르면 된다.
 ![[ForObsidian_WhiteToTransparent01.png]]
- 적용 후
![[Pasted image 20250910161114.png]]

- 적용 전(기존 검정 그래디언트 마스크 사용)
![[Pasted image 20250910161136.png]]

- 둘다 `Alpha Blended` 모드임

## Smoke Trail 복사, 여러 곳에 배치
- `Smoke`를 여러 곳에 배치하면서 `Rotation`과 `Scale`을 다르게 함
- 대충 5 ~ 6 개 정도 구현했으면 실행하면서 이펙트가 어떻게 동작하는지 보고 수정한다.

- `Start Lifetime` : `2.5` ~ `3.5`
- 기존에 `Alpha Clip`을 이용한 `Custom Data`에 `Curve`를 넣어서 사라지게 하는 방법도 테스트해봄. 약간 호롤롤롤 하면서 사라진다. **연기는 자연스럽게 페이드아웃되는 게 더 느낌이 있어서 원본을 유지.**
	- `Additive`
	- `Color over Lifetime`, 앞쪽이 흰색, 뒷쪽이 투명한 검은색

- 근데 `Custom Vertex Streams`을 넣고 `Custom.xyzw`을 추가했다가 다시 없애면 연기 효과가 이상해지는 현상이 있다. 왜 그런지는 모르겠는데... `Custom.xyzw` 자체는 유지하겠음. (알파 클립이 동작하는 것처럼 렌더링된다.)

## 지금까지의 구현
![[VFX_ExplosionUntilSmoke.gif]]

> 여기서 기존에 구현했던 바닥에 퍼져나가는 Smoke나 Orange Ring은 셰이더를 추가로 구현하는 과정에서 기본값을 집어넣어버려서 변형된 것으로 보인다.
> 근데 변형된 게 더 멋있잖아?


