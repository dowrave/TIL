- `240808~` : **Claude AI를 이용한 뒤에 대화가 너무 길어지거나 다른 내용으로 바꾸려고 하면 마지막에 지금까지 한 내용을 정리해달라는 식으로 넣겠음** 
	- 여기에 직접 정리하지 못하는 내용들은 거기에 들어간다. 물론 다 반영 안될 수 있음. AI가 던져준 코드를 쓰는 대신 다른 코드를 쓸 수도 있기 때문에!

# 앞으로 구현할 거 정리

## 유사 명방
- 게임적인 목표
	- 스테이지 : `1-1 ~ 1-3` 까지 구현하기
	- **최소 8명**의 오퍼레이터 구현 (스킬도 일단은 1개씩만 구현)
- 시스템 관련
	- 경로
		- 지금 하는 a* 알고리즘이 아니라 개발자가 직접 설정할 수 있어야 함
		- 즉 Spawner는 적의 종류, 적이 생성되는 시간을 갖고 있어야 함
			- 여기서 생성되는 Enemy는 자신의 경로를 갖고 있어야 함 
			- 상대 경로로 들어갈지 그리드 좌표로 일일이 넣을지는 그 때 가서 생각해보자.
	- 인게임 
		- 배치된 오퍼레이터 클릭 시 (**진행 중**)
			- 화면의 왼쪽에 오퍼레이터의 이름 및 세부 정보가 나타나야 함
	- `OperatorManager`에서 받는 오퍼레이터들의 정보는, 이전 씬에서 가져와야 함(이를 `편성 씬`이라고 하자)
	- 육성 요소 추가
		- 스테이지를 저런 식으로 구현할 거면, `레벨업 재화`를 1-1 시작 전에 얼마를 주고, 스테이지를 클리어할 때마다 `레벨업 재화`를 오퍼레이터에게 사용해서 육성을 시키게끔 구현하는 것도 괜찮을 듯(어떤 오퍼레이터에게 사용할지는 유저가 정하는 방식, **한정된 재화를 어떻게 사용할 것인가?**)
		- 오퍼레이터가 특정 레벨에 도달하면 재능(패시브)을 얻게 하거나 또다른 액티브 스킬을 얻게 하는 방식도 넣어볼 만 하겠다.
	- UI
		- 배치 / 오퍼레이터 클릭시 완전히 관계 없는 부분을 클릭하면 현재 동작이 취소되어야 함. 이를 위한 `OverlayPanel`을 구축하다가, 일단 다시 아무것도 없는 상태로 되돌려놨다.



## 블로그
- 데이터가 제때 수집되고 있는지 눈팅 정도만 하면 충분할 것 같다.
- 사실 Quill을 쓰면서 되돌리기 / 붙여넣기 기능이 좀 이상하게 작동하고 있는 문제가 있긴 한데... 언제 해결할지는 모르겠음?

## 현재 발생 중인 문제

# 8월

## 240829

### 유사 명방
- **우선 할 일**) 마름모 외부에 어두운 화면이 나타날 때, 이 화면이 균일하게 나타나지 않고 기울어지는 현상이 있음
	- 추가로 오퍼레이터 배치 로직에서 마름모 내부 / 외부 영역을 구분해야 함. 근데 내부 영역이 뚫렸다고 해서 이를 인식하는 구조는 아닌 것 같다. 레이캐스트로 조사해봐야겠지만?

## 240828
[[240828 정리]]
### 유사 명방

#### 남는 공간 클릭 시 현재의 동작 종료하기
- 상호작용이 되는 공간 이외의 공간을 클릭했을 때 현재 동작이 종료되게 함
	- 하단 패널 박스를 마우스버튼 다운만 한 상태
		- 다른 패널을 클릭하지 않았다면, 어느 곳을 클릭하든 현재 활성화된 오퍼레이터가 취소됨
	- 오퍼레이터의 타일이 정해지고, 방향을 정하는 상태`DeployingUI`
		- 오퍼레이터를 중심으로 한 마름모가 나타남. 
			- 마름모 내에서의 클릭 동작은 아무런 변화 없음
			- 마름모 내에서 드래그했을 때만 배치됨(이미 구현)
			- 마름모 밖에서의 클릭 동작 시 배치 상태가 초기화됨(아무 것도 지정되지 않음)
		- 추가로, 이 때 나타나는 `OperatorInfoPanel`의 마름모 외부는 반투명한 검은색으로 채워진다. 
	- 이미 배치된 오퍼레이터를 클릭한 경우`ActionUI`
		- 오퍼레이터를 중심으로 한 마름모가 나타남. 클릭 동작은 방향을 정하는 상태와 동일함.
		- 이 마름모 외부는 반투명한 검은색으로 채워지지 않음.
##### 마름모 구현
- 기존엔 외부에서 png 이미지를 만들어서 유니티에서 스프라이트로 변환해서 사용했는데, 이번엔 유니티 자체에서 스크립트를 만들어서 도형을 생성해보려고 한다.
- `Image`를 상속받게 하고, `OnPopulateMesh`로 구현하는 방법이 유니티 상에서 직관적으로 수정하기도 좋다. 
	- `Empty`로 만든 다음 스크립트를 넣어보기도 했지만 `OnValidate`를 별도로 구현해야 하고 나중에 다른 이미지와 통합해야 하는 이슈도 있어서 이쪽은 배제함.

- 마름모 구현까지는 끝났고, 외부 영역 / 내부 영역을 클릭 시 동작의 차이가 생기도록 구현할 예정. 생각보다 길어졌다.

- [유니티 - UI 이미지에 구멍 뚫기](https://rito15.github.io/posts/unity-punch-ui-image/) : 끌로드가 헛소리를 좀 하길래 직접 검색해보니까 이런 글이 있었다. 요는 펀칭할 부분(`Image, Mask`) 아래에 나머지 부분(`Image`)을 담당하는 오브젝트를 넣고, 해당 링크에 있는 머티리얼을 자식 오브젝트에 넣고 `Maskable` 체크를 해제한다. 그리고 부모 오브젝트의 `Mask - Show Mask Graphic` 옵션 체크를 해제한다.



## 240827
### 유사 명방

#### (완)저지 중인 적을 공격하지 않는 이슈
두 타일 사이에 딱 놓였을 때, 어떤 타일 위에도 있지 않다는 판정이 나오고 있어서 그런 거 같다. 
- 어떤 타일 위에 명확히 있을 때 오퍼레이터를 배치하면 다른 오퍼레이터가 잘 인식함
- `Enemy`가 현재 밟은 타일을 갖게 하고, 어떤 타일을 밟았을 떄 / 벗어났을 때 `Tile`과 함께 서로 들어왔다 나갔다를 함께 관리하도록 함
> 타일 a->b로 넘어가는 순간 저지가 됐다고 하고, 어떤 오퍼레이터의 공격범위가 타일 a에만 있다면, 이건 공격이 가능해야 할까 불가능해야 할까?
#### (완)오퍼레이터 클릭 시 공격범위 하이라이트
- 공격범위 하이라이트 로직을 오퍼레이터로 옮김
	- 그런데 OperatorManager에서 배치 중일 때 배치 가능한 타일이 하이라이트되는 건 그대로 남아 있음. 이거도 뭔가 일관성이 필요해보이기는 한데... 일단은 잘 동작하고 있으니 보류.
#### UI
- `Deploy / Action UI`에서 취소 로직 구현 : 버튼이 작동해야 하는 공간 이외의 공간을 클릭(다운 & 업)하면 **현재 작동 중인 Deploy / Action UI 로직이 취소**되어야 함
- `버튼이 작동해야 하는 공간 이외의 공간`을 구현하기 위해, 완전히 투명한 패널 하나를 만들고 해당 패널이 클릭되면 현재 작업중인 배치 로직이 취소되도록 구현할 수 있다. 레이캐스트 이슈니까 또 구현에 시간이 걸릴지도 모르겠음.
#### UI 렌더링
- UI 요소(ActionUI, DeployUI)가 맵의 구성 요소와 겹치는 경우 UI요소가 파묻히는 경우가 있음
- 이것도 나중에 구현
## 240826
[[240826 정리]]
### 유사 명방

#### 기존 오류 해결 : OperatorInfoPanel 참조 문제
- 기존에 발생한 문제는 최초에 비활성화를 해뒀기 때문이다. **스크립트로 활성화 / 비활성화를 제어하겠다면 최초에는 해당 오브젝트가 활성화**되어 있어야 한다.
	- 그러나 **해당 오브젝트가 부모 오브젝트를 두고 있다면, 해당 오브젝트가 비활성화된 상태에서도 부모 오브젝트는 해당 오브젝트를 참조할 수 있다.**
> 즉 **게임 실행 시 최초에 비활성화하고 싶은 어떤 오브젝트**가 있다고 하자. 이 오브젝트는 게임 중, 특정한 동작에 의해 나타나야 한다. `not-active-object`
> 1. `not-active-object`가 독자적으로 존재한다면, 게임을 실행하기 전에는 반드시 `active` 상태여야 한다. 
> - 최초에 `active`가 아니라면, 자신을 초기화하거나 자신에 대한 참조를 갖는 변수 설정이 스크립트로 있더라도, 아예 이뤄지지 않는다. 왜냐하면 애초에 실행되지 않기 때문이다.
> 2. 하지만 `not-active-object`가 `parent-object`의 자식이라면, 인스펙터 상에서 비활성화로 두더라도 `parent-object`가 `not-active-object`를 참조할 수 있다. 


- 이전에 구현한 `GameOverPanel, GameWinPanel`이 `MainCanvas.UIManager`에 의해 최초에 숨겨지되 게임을 깨거나 패배한 경우 나타나는 원리가 이 원리였다. 
- 그래서 기존에 구현한 `OperatorInfoPanel`에서의 기능 대부분을 `UIManager`로 옮겼다. 원래는 싱글턴으로 `OperatorInfoPanel`을 구현했지만, 이것도 필요없어짐. 껐다 켰다 하면 되고 그 안의 내용만 업데이트하면 된다.

#### OpeatorInfoPanel 클릭 시 카메라 이동 문제
- 위 문제를 해결하니까 오퍼레이터를 클릭하면 카메라가 어딘가로 날아가버리는 이슈가 발생하고 있다. 
- 카메라의 X축 좌표 이동만 어떻게 하면 될지도? 
- **왼쪽이 아래로 기울게 하는 방법은 카메라의 로테이션 Y, Z 값의 마이너스 방향 회전**이다. 중심을 얼마나 옮길지, 그리고 얼마나 기울일지는 직접 해보면서 눈으로 봤을 때 괜찮은지 정도가 중요한 것 같음. 
	- 맵의 크기가 달라지면서 기존에 구현해놨던 값들이 깨질 수가 있어서.. 다른 맵에선 어떻게 나타나는지도 살펴봐야 할 듯.
- 대충 정리된 듯
## 240823
[[240823 정리]]
### 유사 명방

#### 방향 표시기
**방향 표시기의 경우 별개의 프리팹이 아니라 스프라이트를 불러와서 스크립트로 요소들을 설정하고 있음!**
- 오퍼레이터의 하단에 방향 표시기 구현
	- 이미지는 파이썬의 `PIL`을 사용해서 만듦 : [[오퍼레이터 방향 인디케이터]]
		- 마스크를 어떻게 써야 할지 몰라서 겁나게 헤맸다..
	- 유니티에 적용하기 
		- 스프라이트는 프리팹처럼 미리 `transform` 관련 요소를 설정할 수 없나? 오퍼레이터의 방향 설정에서 호출하기 시작함.
	- 방향이 맞지 않는다. 
		- 방향은 `90, 0, -angle`을 넣으면 오퍼레이터가 바라보는 방향과 일치한다.
- `OperatorManager`에서 `PreviewOperator` 변수를 없애고, `currentOperator`라는 변수를 추가해서 얘의 `IsPrviewMode` 프로퍼티로 미리보기 / 배치 상태를 관리함.

#### 오퍼레이터 클릭 시 정보 표시
- 배치된 오퍼레이터 클릭 / 하단 패널 UI의 오퍼레이터 클릭 시의 UI 구현
	1. 배치된 오퍼레이터의 정보가 화면 왼쪽 1/4에 표시됨
	2. 기존 맵은 오른쪽 3/4을 차지함, 모든 맵이 보임. 살짝 기우는 효과가 있는 것 같기도?
	- 이 UI는 Claude AI를 이용, 파이썬과 PIL을 이용해 만들었다. [[오퍼레이터 정보 UI 그라데이션]]




## 240822
[[240822 정리]]
### 유사 명방 구현하기
- `actionUI, deployingUI` 관리 통일 : **클릭 시 나타나는 별개의 오브젝트**로 구현
	- 아니 또 배치 작동 안함; <- **레이어 설정 만질 때 주의하자!!**
	- 수정 완
- 배치 시 시간 느려지게 하기
	- 배치 시 : 드래그 시작 ~ 오퍼레이터 배치 종료까지
	- 1배속 -> 0.2배속 -> 0배속?? 이 되는 문제 있음.
	- 수정 : `Time.timeScale`의 초기값을 저장해두는 식으로 구현했는데, 저 초기값이 `0`이다. 왜인지는 모르겠다. 그냥 `originalTimeScale = 1f`로 저장함.


## 240821
- [[240821 정리]]
### 유사 명방
- 시작 전) 발생 중인 문제
	1. 배치 취소 버튼 클릭 시 작동 X
	2. 배치 후 퇴각 버튼, 스킬 버튼 클릭 모두 작동 X

- [[Unity - 레이캐스트(UI와 게임 요소)]]
	- UI 레이캐스트에 어떤 것들을 넣을지(주로 Canvas - GraphicRaycaster들에 대해 진행)에 대한 처리가 명확하게 되어야 한다. 계속 여기서 덜컹거리는 느낌임.
- 버튼들 모두 동작O(UI 요소에서 먼저 반응하게 하면 됨)
- 한 UI가 떠 있는 상태에서 다른 UI가 나타나는 문제도 수정(예를 들면 actionUI가 떠 있는 상태에서 새로운 오퍼레이터를 배치하려고 클릭하면 actionUI가 남아 있었음).
- `actionUI, deployingUI`의 일관성이 떨어진다. `actionUI`는 자식오브젝트, `deployingUI`는 아예 별개의 오브젝트이기 때문. 그래서 `actionUI`는 `Hide (=SetActive(false))`로 숨기기만 했고, `deployingUI`는 `Destroy()`로 아예 파괴했다. 이들에 대한 일관성도 나중에 구현할 필요가 있어 보인다.
- UI가 생각보다 골치아프다;

## 240820
[[240820 정리]]
### 유사 명방
- 배치 중 배치 취소 버튼 추가하기
	- `DragIndicator`와 함께 보여져야 할 UI이므로, `DeployingUI`로 묶고 그 안에 함께 넣음
	- 배치 후에 DeployingUI가 사라지지 않는 문제 발생 중

- 하이라이트된 상태에서 타일 위로 스냅이 안된다 갑자기; -> 수정 완(Cube에도 Tile 레이어 설정)


## 240819
- [[240819 정리]]
### 유사 명방
- [[오퍼레이터 배치 로직 정리]]
- 오퍼레이터 배치 로직 관련
	1) 하단 UI를 클릭 시 배치 가능한 타일이 활성화됨. **미리보기는 이 시점에 활성화되지 않음.**
	2) 배치 가능한 타일이 활성화된 시점에서 다시 해당 오퍼레이터를 클릭했을 때의 동작
		- 오퍼레이터 마우스 다운 (= 드래그 가능) 
			- 커서 이동 시 미리보기 활성화, 특정 타일로 이동해서 배치 가능
		- 마우스 업 
			- 커서 이동이 되었다면 배치 가능한 타일일 경우 방향 설정으로 넘어감
			- 그렇지 않다면 배치 취소(하이라이트도 취소)
	3) 방향 설정
		- 좌측 상단에 배치 취소 버튼이 생김. 
		- 마름모가 생김. 
		- 마름모 내에서 마우스 다운 시 커서가 위치한 방향으로 방향이 설정됨. 
			- 약 1타일 정도 커서가 이동한 상태에서 커서를 떼면 배치 완료
			- 1타일 이내에 커서가 여전히 위치해 있다면 계속 방향을 설정할 수 있는 상태
		- 마름모 밖에서 마우스 다운 & 업(=클릭) 시 배치 취소
			- 배치 취소 시 아무것도 선택하지 않은 상태로 돌아감

- 이게 이렇게 어려운 로직이었나.. 하루 종일 잡았다. 사실 요점은 UI 클릭 후 해당 UI를 다시 드래그하는 것만 추가하면 되는 거였는데, 생각보다 복잡해졌다.
- 특히 클릭 / 드래그를 구현할 때 어디까지는 Panel 부분에, 어디까지는 OperatorManager 에서 관리해야 하는 약간 복잡한 로직이다. 차라리 **DeployManager를 따로 만들어서 거기다 뺴두는 것도 좋을 것 같다.** 언제 할지는 모르겠지만.

## 240816
[[240816 - OperatorUI 관련]]
### 유사 명방
- Game 뷰에서 파란색으로 둘러싸인 T 아이콘이 나타나는 문제 해결
	- Game 뷰의 `Gizmos`가 클릭되어 있으면 그런 현상이 나타난다.
	- 마찬가지로 씬에도 우측 상단에 기즈모 표시 토글 버튼이 있다.

- Action UI 관련
	- 다른 오퍼레이터 클릭시 기존 Action UI 제거 후 해당 오퍼레이터의 UI가 나타나게 함
	- 빈 공간 클릭시 모든 Action UI 제거
	- 오퍼레이터와 버튼이 겹치는 경우에도 ClickableLayer를 바꾸니까 잘 되는 듯..?`(UI, Operator)`

> 필요) UI 일관성 맞추기
> - 오퍼레이터에 나타나는 UI와 하부 패널 UI가 약간 다른 구조라서 이들의 일관성을 맞출 필요가 있어보임. 아래 박스에는 `IPointerClickHandler`라는 게 있고, 이는 아래의 것으로 동작한다.
```cs
    // eventData : 유니티에 의해 자동 제공, 클릭 이벤트 정보 포함. (그래서 operatorData랑은 별개로 인풋을 저렇게 작성해야 함)
    public void OnPointerClick(PointerEventData eventData) 
    {
        if (!isOnCooldown && StageManager.Instance.CurrentDeploymentCost >= operatorData.deploymentCost)
        {

            OperatorManager.Instance.StartOperatorPlacement(operatorData);
        }
    }
```


- 중간 휴식) 
1. ActionUI가 활성화된 상태에서, 2개의 버튼을 제외한 다른 곳을 클릭하면 ActionUI가 사라져야 함 
	- 지금껏 잘 안됐던 이유가 프로퍼티로 세팅했기 때문임 : 일반적으로 프로퍼트로 세팅하면 필드 값을 직접 수정할 일이 잘 없다.




## 240815

[[240815 정리]]
### 유사 명방
- 어제 해결 못한 것부터 다시 시작한다.
>레이캐스트 사용
	- 빈 화면 클릭은 레이캐스트 인식이 잘 되는데, 맵이나 오퍼레이터 등 구현된 것들을 클릭하면 레이캐스트에 아무런 반응이 없다. 
- 어디부터 손대야 할지 모르겠다. 클릭해도 반응이 없어야 할 UI 부분이랑 타일, 오퍼레이터를 클릭했을 때의 반응이 동일하다는 게 그나마 힌트가 될 것 같음.
---
- 위 문제 해결 : `ClickDetectionSystem`의 `IsPointerOverUIObject()` 함수가 조건문으로 들어가 있었는데, 구현한 대부분의 오브젝트를 UI로 인식해서 타일이나 오퍼레이터를 인식하지 못했다. 해당 조건문을 제거해도 기존 UI를 사용한 클릭 등이 잘 나타남.

- `OperatorShowActionUI` 개선
	- 프리팹 기반으로 개발할 때 `원하는 화면을 띄움 -> 일시정지 / 재생을 반복하면서 값을 수정하고 변경 내용을 관찰함` 의 과정을 반복하면 되겠다. 그리고 그 값을 원래 프리팹에 넣고.
	- `파란색 사각형으로 둘러싸인 T` 아이콘이 나타남 : 
	- 오퍼레이터 클릭 시 카메라 이동 -> 이 과정에서 `CameraManager` 다시 구현 -> 구현하는 김에 `Map`에 카메라 위치 정보를 집어넣음 + **카메라 Rotation을 90 -> 70으로 변경**
	- 그 외 이것저것 있는데 정리 못했다.

- 오퍼레이터 클릭 UI 구현
	- 레이캐스트 우선 순위에서 막히는 듯? 클릭 시 나타나는 UI가 먼저 반응해야 함
	- 즉 오퍼레이터 자체를 구성하는 캔버스가 있고, OperatorActionUI 위의 버튼들이 있다면 레이캐스트가 겹칠 때 OperatorActionUI 위의 버튼이 우선적으로 반응하도록 해야 함. 현재는 UI 요소가 나타난다며 실행되지 않는 상황.

## 240814

[[240814 정리]]
### 유사 명방
어제 못한 것부터 시작한다 
>레이캐스트 사용
	- 빈 화면 클릭은 레이캐스트 인식이 잘 되는데, 맵이나 오퍼레이터 등 구현된 것들을 클릭하면 레이캐스트에 아무런 반응이 없다. 
- 어디부터 손대야 할지 모르겠다. 클릭해도 반응이 없어야 할 UI 부분이랑 타일, 오퍼레이터를 클릭했을 때의 반응이 동일하다는 게 그나마 힌트가 될 것 같음. **일단 보류**

- 공격 대상 설정
	- 오퍼레이터가 공격 중인 적이 죽을 경우, 오퍼레이터가 공격 범위 내에 다른 적이 있음에도 다른 적을 공격하지 않는 이슈가 있었음
	- 이를 수정하기 위해 Enemy에서 자신을 공격 중인 오퍼레이터들의 리스트를 추가하고, Enemy의 Die 메서드에서 Enemy가 죽었음을 알리는 메서드를 추가한다. (이건 나중에 Operator에도 구현해야 할 듯)
	- 구현하는 과정에서 스크립트들이 좀 중구난방이라 교통 정리도 같이 진행한다.

- 중간 휴식) 역시나 여기부터 꼬이기 시작. 
	- 적 사망 로직 제대로 구현 X
	- 오퍼레이터가 적을 찾는 로직도 계획한 것처럼 작동 X

- 휴식 끝) 일단 `Operator.blockedEnemies`를 List로 변경하고, 최대 저지 수를 넘지 못하게 바꿨다.
	- 앞에서 사망 로직이 꼬인 이유 : `Enemy`에서 `attackingOperator`를 선언은 했는데 값을 할당하지는 않았다. 이런 기초를 놓치다니.
	- (특히 원거리) 적을 파괴하고 다른 적을 찾는 로직만 반복하는 거 해결. 


## 240813

### 유사 명방

- [[240813 정리]]

- 클릭 시 UI 구현
	- 오퍼레이터 주위?에 퇴각 버튼, 스킬 사용 버튼이 나타나야 함
	- 화면의 왼쪽에 오퍼레이터의 정보가 나타나야 함
> 그러면 Canvas 를 그릴 때 `World Space vs Screen Space - Overlay` 둘 중에 뭘 써야 함?

- UI 요소를 프리팹으로 할당할 때 궁금한 점
	- 프리팹으로 실험하는 경우, 게임을 실행하지 않은 상태에서는 필드에 할당되지 않은 상태니까 프리팹을 테스트해볼 수 없는데, 그러면 자식 오브젝트로 둬서 실험하다가 테스트가 완료되면 프리팹으로 빼는 방식인가?
	- **특정 오브젝트에 완전히 종속되는 개념이 아니라면, 웬만하면 따로 프리팹으로 빼두는 편이 훨씬 낫다.** 자식 오브젝트로 놓는 방법에 비해 테스트가 조금 더 까다로워지는 면이 있지만.

#### Operator UI 관련 스크립트 뜯어고치기
- 기존엔 자식 오브젝트를 기준으로 했는데, 프리팹을 불러오는 것으로 수정하겠음
	- 갑자기 배치 로직이 이상하게 작동함... 왜 다른 부분을 수정했는데 여기가 안되지 ㅡㅡ
	- 프리팹 자체가 비활성화되어 있으면 불러와도 비활성화네 ㅋㅋㅋㅋㅋㅋ 어이가 없다
	- 사실 뜯어고칠 내용이 많지는 않다. 
		- 자식 오브젝트 제거
		- 필드 SerilaizedField화

#### 클릭시 UI 구현
1. `OnMouseDown` 메서드 구현 - UI에 가려져서 인지 Debug.Log 도 나타나지 않음
	- 화면에 `Main Canvas`가 있는 상황이라면 마우스버튼다운이 작동하지 않는 것 같다.
2. 레이캐스트 사용
	- 빈 화면 클릭은 레이캐스트 인식이 잘 되는데, 맵이나 오퍼레이터 등 구현된 것들을 클릭하면 레이캐스트에 아무런 반응이 없다. 내일 이거부터 수정하자. 뽈 차러 가야 한다.



## 240812
### 유사 명방
- [[240812 정리]]
- 저지 로직 수정
	- 여태까지는 저지 = 1로 테스트를 했는데, 저지 = 3을 하니까 몹이 6마리가 나오는데 전부 저지해버리는 상황이 생겼다. `Enemy`에서 같은 타일을 밟은 오퍼레이터를 체크하고, 그 오퍼레이터가 저지 가능한 경우에만 저지하도록 수정.
- 재배치 쿨타임 중 클릭이 되는 현상 수정
- 게임 오버 구현
	- [[Unity - 시간의 흐름]]
	- UI도 구현 완
	- 게임 승리 때의 애니메이션은 나중에 구현하기로 한다. 일단 비활성화된 캔버스가 나타나도록 함.
	- UI를 구현하는 과정에서 `Main Canvas`에 `UI Manager` 스크립트를 부여했다. 이 스크립트는 **개별 유닛의 UI를 담당하지는 않음**에 유의!

- Operator : 적을 처치했을 때 다른 적을 찾는 로직 : 자연스러운 것 같기도 하고, 아닌 것 같기도 하고..
## 240809

### 유사 명방
- 현재까지는 코스트만 만족하면 중복 배치가 가능한 상황임. 아래 것들 구현부터 시작.
	* 오퍼레이터 중복 배치 불가 : 오퍼레이터가 배치되었다면 BottomPanelOperatorBox에서 해당 Box가 사라짐
	* 이미 배치된 오퍼레이터가 사망(오퍼레이터의 체력이 0이 된 상황)하거나 퇴각(유저가 의도적으로 퇴각 버튼을 누름, 아직 구현하지 않음.)하는 경우, 다시 Box에 나타나지만 배치가 불가능하며, Box의 중앙에 재배치 쿨타임이 표시됨
	* [[Unity - Transform.Find()]]
	* 추가적인 시각화(시계 방향으로 어두운게 밝아진다든가?)가 필요할 것 같지만, 기본적인 로직 자체는 구현 완료.

- 화면 상단에 남은 적의 숫자와 라이프 포인트 구현하기
	- `StageManager`에서 관리.
	- 적의 총 숫자 : 맵에 존재하는 `EnemySpawner`들의 길이를 모두 합치면 될 듯
		- `현재 숫자 / 총 숫자`로 나타내며, `현재 숫자`는 적이 죽을 때마다 1씩 올라간다. `Enemy.Die()`랑 연결하면 될 것 같다.
		- 최종적으로 `현재 숫자 = 총 숫자`가 되면 게임이 승리로 끝난다.
	- 라이프 포인트 : `Enemy.ReachDestination()`이 있다. 이 메서드가 발동할 때마다 전체 라이프 포인트에서 1씩 깎이며, 최종적으로 라이프 포인트가 0이 되면 게임오버당한다.


## 240808

### 유사 명방
- [[240808 정리]] 
- 배치 코스트 및 UI 구현
	- `StageManager`에서 배치 코스트를 관리. 
	- 시각화를 위해 `MainCanvas`의 `BottomPanel` 바로 위의 오른쪽 끝에 배치 코스트 관련 패널이 오도록 구현.
	- UI 크기를 수정하는 상황이 있어서 이를 스크립트로 자동으로 맞춰줄까 했는데 그냥 인스펙터 상에서 눈으로 보고 테스트하겠음. 원하는 구현이 안 나온다. 
		- `RectTransform.rect`는 읽기만 가능하고 수정은 불가능함(get 메서드만 있음)
- 배치 가능한 타이밍 조절
	- 현재 전역 배치코스트가 오퍼레이터의 배치 코스트보다 낮다면, 해당 UI는 흐릿? 어둡?게 표현하고 아예 배치 시작을 불가능하게 변경
	- 필드를 쓰다가 프로퍼티를 쓰는 걸로 변경했다. 프로퍼티의 세터 함수에 이벤트를 넣어서 코스트가 변할 때마다 이벤트가 발생시키도록 한다. 
		- 특히 프로퍼티랑 필드는 나올 때마다 계속 헷갈리고 있으니 잘 기억해두자.
- [[Unity - 필드와 프로퍼티]]


## 240807

### 유사 명방
- 오퍼레이터의 색깔 정보가 하단 패널의 박스들에 반영되도록 함. 만약 Sprite가 있으면 해당 스프라이트를 넣는다.
- 박스를 클릭해도 클릭 인식하지 못하는 문제가 있었음 -> `IPointerClickHandler` 상속받는 거를 넣지 않아서 그랬다.
- (진행 중)UI 클릭과 배치 로직을 잇는 중 - Box에서 클릭해서 변경된 변수가 바로 다음 프레임에서 초기화되는 문제가 있다. 그래서 `오퍼레이터 클릭 -> 타일들 하이라이트되면서 오퍼레이터 미리보기` 가 제대로 되지 않고 있음. 
	- 이를 관리하는 변수가 클릭한 순간만 true가 되고 나머지는 false로 나타남. 클릭하는 중에만 true가 아니라 클릭하면 변수가 true로 바뀐다이고 이게 다음 프레임에도 유지돼야 하는데 이상하게 초기화되고 있다.
	- `ResetPlacement`가 발동하는 조건을 타고 있었다... 기존에는 선택하는 방식이 아니라 이미 선택된 상태를 가정하고 구현해놨었는데, UI 및 클릭하는 로직을 추가하는 과정에서 뭐가 꼬였던 듯. 

## 240806

### 유사 명방
- `OperatorManager` : 여러 Operator를 배정하고, 해당 Operator 클릭 시 Operator 배치 로직을 작동하도록 함
- UI 구현 중 - 일단 화면 하단에 Panel이랑 각 오퍼레이터 박스를 매치시켯음
- Operator들도 이제 OperatorData로 관리됨. 기존 프리팹은 OperatorData의 Prefab 필드에 들어간다.
## 240805

### 유사 명방
- `Background와 Fill Area 간의 불일치 이슈` 해결 - 의외로 `Fill Area` 와의 설정을 일치시키는 게 아니라 `Fill`과의 설정을 일치시켰다. 
- [[체력 게이지 관련 설정들]]에 현재 설정 기록해둠.
- `Enemy`도 여러 개를 만들어야 하므로 `EnemyData`을 구현, 기존에 스포너에 프리팹을 할당했는데 이 대신 스포너에 `EnemyData`를 할당하고, 그 EnemyData 각각에 기존 프리팹을 할당하는 방식이다.
- 저지 구현 완료 : 생각보다 오래 걸렸다(Data로 고치고... UI 또 적용 안되는 거 고치고...)


## 240802

### 유사 명방
- `MapEditorWindow` - 현재 맵의 Width, Height가 연동되지 않는 문제 해결
- `Health Bar` - 오퍼레이터, 적과 연동되지 않는 문제 해결 중 
- **UI Manager를 없애고 캔버스를 오브젝트의 하위에 붙이는 방식으로 다시 돌려놨다!** 
	- 그 과정에서 UI 관련 이것저것 수정 완료. 
- 일단 시야각은 90도로 놓겠음. 실제 명방은 그것보다는 사선에서 보는 느낌이지만, 캔버스 위치나 좌표를 잡기가 다소 애매한 면이 있어서 일단 이렇게 둔다.
- `UI Manager`, `Camera Manager` 등 제거.

## 240801

### 유사 명방
- 게이지 구현
	- Enemy의 서식을 가져와서 Operator에 구현해놨는데 이상하다. NullReference 에러부터 해결을 시작하도록 한다.
	- 부모 오브젝트의 스케일이 달랐다. 부모 오브젝트의 스케일은 전부 1로 고정하고, 자식 오브젝트들의 요소들을 조정하는 방식으로 수정 중.
- [[Unity - Rect Transform]]
- `Operator` 나 `Enemy` 내부에 `Canvas`가 들어가는데, 이 때 둘 모두를 따로 프리팹으로 저장하지 말고, 가장 상위의 오브젝트만 프리팹으로 저장하자
	- 일단은.
- 이런 식의 개발을 할 때, `Enemy`나 `Operator`를 따로 구분해서 만들지 말고 `Unit`이라는 베이스 오브젝트를 하나 만들고, 거기서 추가로 살을 덧붙이는 식으로 구현해나가는 게 좋을 것 같다. 지금처럼 구현하면 중복된 구현을 여러 번 해야 하는 문제가 있음.
#### 방향 수정 : UI를 관리하는 매니저를 별도로 구현하고, 인스턴스에 UI를 갖다 붙이는 방식으로 수정한다
- 지금처럼 구현하면 **부모 오브젝트의 회전에 UI도 영향을 받는 이슈가 있음**
- (그리고 사실 UI도 매니저를 이용해서 구현하라고 배웠는데, 어쩌다 보니 여기까지 왔다)
-  [[Unity - UI 매니저]]

#### 휴식 중.. (앞으로 할 일)
1. 전역 UI Manager가 생성된 인스턴스에 캔버스 프리팹을 할당
2. 지금 Stat을 가져오는 곳들이 약간 중구난방식임 : 어떤 값은 Stats에서, 어떤 값은 Data에서.. 교통 정리가 필요해보인다.

#### 다시 진행
- (수정 완)갑자기 잘 작동했던 오퍼레이터 배치 하이라이트 로직도 이상해짐
- (완) UI Manager를 이용해 Enemy와 Operator 의 체력 게이지 (및 SP 게이지) 구현
	- 추후에 카메라를 회전하면 로테이션을 바꿀 필요는 있어 보임(카메라를 수직 방향으로 바라보도록)
# 7월

## 240731
### 유사 명방
- 게이지 구현 
	- 체력바 : 아군, 적군 모두에게 공통적으로 나타남
	- 적은 체력이 1 이상 깎였을 때에만 체력바가 나타남
	- 아군은 체력바 외에도 SP 게이지 바도 나타남 
- 혼란) 애셋으로 어떻게 저장해둘까?
	- **Canvas 단위로 묶겠음** - 설정할 게 있으면 하이어라키에 올리고 편집해서 다시 저장하면 되니까
	- 즉 Bar 들을 따로 프리팹으로 저장해두는 게 아니라, Canvas 아래의 요소들로 통째로 묶는다.
- [[Unity - 하위 오브젝트 저장 방법]]

- 체력바 다듬기 <-- 이거 이상해짐
	- Enemy와 Operator의 하단에 Bar들이 떠야 함
	- Canvas 자체는 오퍼레이터를 감싸는 프레임처럼 구성돼야 할 듯?



## 240730

### 유사 명방
- `MapEditorWindow.cs` - 컴파일러가 다시 작동했을 때 윈도우가 정상적으로 맵을 얻지 못하는 현상 수정 완료(`OnEnable`에서 맵을 다시 초기화해주면 된다)
- `SniperOperator` - 공격 범위 이상한 문제 수정 완료

드디어 진도 나간다!!!!!!!!!!!!!
#### 원거리 공격 구현하기(완)
- `Projectile.cs` 작성, `Operator.cs` 수정
- 공격 범위 판정 
	- 오퍼레이터의 공격 범위는 "타일"로 설정
	- **"타일 위에 적이 있다"는 `Tile.cs`에 구현**


### 240729

#### 유사 명방

##### 오늘의 목표
- 적 생성 -> 도착 지점까지 자동으로 이동하기
- (완) MapEditorWindow.cs에 LoadMap 메서드 실행 시, 그리드에 정상적으로 반영되지 않는 문제 수정(이거만 몇 번째냐...)
	- `MapEditorWindow.InitializeNewMap` 관련 
		- 맵 에디터 윈도우를 열었을 때 
		- 이미 Map이 하이어라키에 존재한다면 해당 Map을 그리드에 그린다
		- 없다면 새로운 맵을 만들거나 불러오기를 선택할 수 있도록 한다
	- 그리드 포지션 관련 설정 : 프로퍼티만 설정하면 **프리팹에 저장(직렬화)되지 않는다!** 
		- `public` 필드, 혹은 `[SerializeField] private` 필드만 직렬화된다.
	- [[Unity - Awake, OnValidate, Initialize 차이]]
	- [[Unity - 직렬화]] **<- 불러온 맵의 각 타일이 자기 좌표를 올바르게 갖지 못했던 이유**


### 240727

#### 유사 명방
- `MapEditorWindow.cs` 관련 수정 
	- 로드 시 그리드 변화 인식하지 못하는 문제 해결
	- **특히 이 좌표가 엄청 헷갈리므로 잘 기억해두자!!!!!**
		- Tile의 이름은 그리드 좌표를 따르도록 `Tile_{x}_{y}`로 설정
		- 이는 월드 좌표와 다르다 
			- 그리드 좌표는 좌측 상단이 (0, 0)
			- 월드 좌표는 좌측 하단이 (0, 0)
- 아예 `Map` 프리팹에 2차원 행렬을 저장하는 방식으로 바꿈
	- 기존엔 `MapManager`가 `Map`의 구조를 뜯어보는 방식이었음


### 240726

#### 유사 명방
- [[GetComponentsInChildren에 관해]]
- 게임 시작 시, 맵을 정상적으로 인식하지 못하는 문제 해결
- 위 문제를 해결하니까 다시 MapEditorWindow.cs가 이상해짐. 수정 중.
- 스포너에서 적 생성 작업 시작

### 240725

#### 블로그
- `MyDoing`의 스타일 조정
- 커서 위치에 드래그 & 드랍으로 이미지 업로드 구현
	- 추가) 이미지를 드래그 중일 때, Quill의 텍스트 커서 위치도 마우스 커서 위치에 따라 이동할 수 있게끔 구현하기(당연히 이동할 수 없는 위치로는 텍스트 커서가 움직일 수 없음)
- 버튼 클릭 없이, 본문에 유튜브 링크 붙여넣기 시 바로 동영상 임베드 삽입 기능 구현



