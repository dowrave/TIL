
## 블로그
- 데이터가 제때 수집되고 있는지 눈팅 정도만 하면 충분할 것 같다.
- 사실 Quill을 쓰면서 되돌리기 / 붙여넣기 기능이 좀 이상하게 작동하고 있는 문제가 있긴 한데... 언제 해결할지는 모르겠음?

## 작업 예정

### 유사 명방(전체)
#### 구현 예정
- 스킬 (오퍼레이터마다 2개씩)
- 캐릭터 스프라이트 (이건 못하지 않을까 싶다)
- 스테이지 1-1 ~ 1-3 구현
> - `OperatorSelectPanel.LeftArea`의 하단 부분은 나중에 스킬 등록하는 부분으로 만들 거임

#### 발생 중인 이슈
- `StageData`의 `Spawner`들 관리하는 거

- 간헐적인 문제
	-  `Enemy` 기준, 바리케이드 파괴 로직이 동작하지 않는 현상이 있음

# 12월

## 241212
[[241212]]
### 짭명방

#### OperaetorLevelUpPanel 수정
- `OperatorLevelUpPanel.UpdateItemUsageDisplay` 메서드 채우기
	- 어떤 레벨에 도달하기 위해 필요한 경험치 아이템들의 최소 갯수를 계산함
	- 사용되는 아이템들을 패널의 좌측 하단에 띄우고, 해당 레벨에 도달하고 나서 경험치량도 오른쪽 패널에 미리보기로 보여주도록 구현
	- 일단 AI한테 초안 던져보고 테스트해봄 : 계산 로직, 패널 반영 다 이상한 듯
	- 일단 `OperatorGrowthSystem.GetRequiredExp`가 혼용되고 있다.
		1) `현재 레벨 -> 다음 레벨` 로 도달하기 위해 필요한 경험치량
		2) `어떤 레벨`에 도달하기 위해 필요한 총 경험치량
	- 추가로, 레벨업에 필요한 경험치를 따로 정리해두는 게 좋을 것 같음.

- `OperatorGrowthSystem`에서 레벨업에 필요한 경험치는 `ScriptableObject`로 따로 빼두고, 이 파일은 `GameManagement`에 할당. 
	- 시스템 자체는 스태틱이지만, 레벨업에 필요한 경험치는 파일로 관리되므로 `GameManagement`에서 파일을 할당해주고 `Initialize`를 실행

- 대체로 거의 구현은 다 됐음. 남은 사항은
	- 레벨업 버튼 클릭 시 좌측 하단의 아이템 패널 초기화시키기
	- 경험치 바 제대로 반영하기
	- `SetScrollToLevel` 부분에 애니메이션 파라미터 추가하기

- 패널에서 계산하는 로직이 들어가 있는데 계산은 OperatorGrowthManager로 빼고 패널에서는 그 결과를 받아와서 사용하도록 구현함

- 자동 계산 구현 수정 필요
	- 지금의 구현으로는 레벨 2에 도달하는 데 경험치 100이 필요하다고 하면, 500짜리 아이템을 무조건 우선적으로 사용하게 구현되어 있음
	- 그런데 가장 경제적인 방법은 500짜리를 쓰는 게 아니라 200짜리를 쓰는 방법임
	- ...코테가 생각나는 순간이다.
	- EXP 갱신 자체는 정상적으로 이뤄지는 듯.
	- [[경험치 아이템 사용 알고리즘]]
		- DP를 오랜만에 봐서 헷갈린다. 정리하고 넘어간다.
	- 레벨업 후 현재 경험치 갱신 로직 수정
```
현재 경험치 + 
플랜으로 만들어진 경험치(=사용되는 아이템들의 경험치의 합) - 
해당 레벨에 도달하기 위한 최소 경험치(1레벨 경험치 0 ~ 해당 레벨 경험치 0이 되기 위한 경험치의 합)
```

- 레벨업을 했는데 스탯이 멀쩡하게 반영되지 않는 현상 수정
- `OperatorSlot`에서 경험치 반영 이상하게 되는 문제까지 수정
- 오늘의 스샷
![[Pasted image 20241212223121.png]]
> 추가로, 도달 불가능한 레벨에 도달했을 경우 슬라이더 값이 0이 되도록 함

![[Pasted image 20241212223139.png]]

- 이외에도 레벨 3을 지정하려고 하면 가장 효율적인 방식이 200을 2개 쓰는 것인데, 이 경우 레벨이 4가 되므로 자동으로 4로 스냅핑된다.
- 마지막으로 `OwnedOperator`의 `LevelUp` 메서드는 제거한다. 전부 `OperatorGrowthManager`의 `TryLevelUpOperator`로 이동했음.

## 241211
### 짭명방

- `ItemUIElement`에 들어가는 이미지 수정 : 외부 경계 영역이 너무 넓은 듯 해서 좁힌 이미지를 다시 만들었음
- 이미지 3개 만들고 끝낸다
	- 실사 느낌의 이미지까지는 못 만들어도, 단순히 입체감 있는 느낌만 주고 싶다면 명암만 잘 처리해도 괜찮은 것 같음
![[Pasted image 20241212002225.png]]
> 다 `프로크리에이트`로 손수 그림 ㅋㅋ......
> 그리기 시작하면 그래도 생각보단 빨리 나오는 거 같은데 시간은 훅훅 가 있다. 이미지를 더 만지는 건 **전체적인 작업 시간에 영향을 줄 거 같으니 아이템 이미지 만들기는 여기까지 하겠음.** 포토샵 같은 거 배울 시간은 없는 듯.
> 작은 경험치는 플로피 디스크, 큰 경험치는 CD로 하겠다는 발상 자체는 아재 냄새도 나면서 적당히 좋았던 것 같기는 한데, 실물을 보니까 좀 아쉽긴 하다. CD가 특히 EXP를 명시하기가 힘들다. 


## 241210
[[241210]]
### 짭명방

#### StageSelectPanel
- 스테이지 버튼을 클릭해서 우측에 패널이 뜬 상태에서의 취소 동작 구현
	- 스테이지 버튼들이 위치한 공간 중 버튼을 제외한 빈 공간을 클릭했을 때 현재 선택된 스테이지를 취소시키고 디테일 패널을 없애는 동작
- 해결
```
StageSelectPanel
	- ButtonContainer(Image, Button)
		- Buttons
	- StageDetailPanel
		- StageDetailContent
		- ConfirmButton
```
> - 스테이지 디테일 패널이 나타나면, 버튼 컨테이너의 `interactable`을 켜는 방식으로 구현함
> - `CancelArea`를 버튼 컨테이너와 디테일 패널의 형제 오브젝트로 만들어 봤는데 취소 동작이 선행되어야 다른 버튼을 클릭할 수 있음. **지금의 구현은 디테일 패널이 나타난 상태에서도 다른 버튼을 클릭할 수 있도록 구현한 것**

#### 아이콘 이미지 만들기
- `ItemInventoryPanel`로 이어지는 버튼용 아이콘 하나
![[InventoryIcon (2).png]]
> 윤곽선이 있는 것도 작업을 해봤는데 유니티상에서 튀는 느낌임 - 프로크리에이트가 벡터 기반이 아니라서 그런가..

- 아이템 이미지 3개 : `ExpSmall, ExpMiddle, ItemPromotion`
	- `ExpSmall` 이미지를 넣기는 넣었는데 평면적인 이미지를 넣으니까 아쉬운 느낌
	- 그나마 색감을 무채색 위주로 바꾸니까 나아지기는 했다. EXP라는 손글씨를 넣었는데.. 흠.


## 241209
[[241209]]
### 짭명방
#### 아이템, 인벤토리 UI 구현하기
- 어제 못 끝낸 내용
>  `Description` 부분이 어떤 식으로 들어가는지 레이아웃을 살펴보고, 스크립트랑 연결만 해주면 될 듯? 그 다음은 배경화면 디밍 되는 걸 블러로 바꿔서 처리하면 될 것 같다.

- `ItemUIElement` 프리팹 작업
- `ItemInventoryPanel` 작업
- `ItemDetailPanel -> ItemInfoPopup` 이름 변경
- `ItemInfoPopup` 클릭 시 `ItemUIElement`가 나타나도록 연동
	- `PopupManager` 추가
	- 이 과정에서 팝업이 나타날 때 흐린 패널이 화면 전체를 뒤덮는 현상이 있음 -> 원인 발견에 시간이 좀 걸린다
		- 팝업이 나타나면서 `backgroundUICanvasGroup`인 `mainCanvas` 자체의 알파값을 만지게 되면서 흐릿한 현상이 나타나는 거란다. 
- [[Unity - DOTween#Append와 Join의 차이]]
![[Pasted image 20241209174016.png]]
> 일단은 이런 느낌의 구현임. 
- 해결) 아이템들 제대로 읽어오지 못하는 이슈가 있다.
	- `ScriptableObject`의 각 스크립트 이름과 데이터의 필드 이름을 일치시킴
- 저 `갯수` 부분의 경우 `ContentSizeFitter`에 의해 자동으로 수정되는 부분이 있음
	- 그런데 텍스트를 할당하고 바로 보여주는 경우 `Content Size Fitter`에 의해 수정되기 전의 UI가 나타나서 레이아웃이 깨지는 현상이 있다. 강제로 한 번 새로고침을 넣었음.
	- 그래도 해결이 안됨. `ContentSizeFitter`을 쓰고 있는데, 패널을 껐다가 켰다가 할 때마다 레이아웃이 미세하게 변하고 있다. 
- 지금 문제가 되는 부분의 구조가 아래와 같았음
```
ItemCountContainer
* ItemCountIndicatorBackground (Image, Vertical Layout Group, Content Size Fitter)
   * ItemCountIndicatorText (Text)
* ItemCountBackground (Image, Vertical Layout Group, Content Size Fitter)
   * ItemCountText (Text)
```
- 원래 `ItemCountContainer`에 `Horizontal Layout Group`도 있었는데, 이 경우에 게임을 실행하고 팝업을 띄우면 `Name`의 위치와 `Count Container`의 y값이 똑같아야 하는데, `Count Container`만 이상하게 배치되는 현상이 있었음
- 해결) `ItemCountContainer`에도 기존의 `Horizontal Layout Group` + **`Content Size Fitter`을 추가, 두 필드 모두 `Preferred`로 설정**
![[Pasted image 20241209221634.png]]
![[Pasted image 20241209221657.png]]
> 고민했던 것에 비해 생각보다 쉽게 해결됐음..

- UI 레이아웃의 갱신 순서
	1. 각 UI 요소의 크기 계산
	2. Layout Group이 자식 요소들을 배치함
	3. Content Size Fitter가 컨테이너 크기를 조정함
	- 기존 문제가 발생했던 이유는 컨테이너가 자식 요소들의 크기 변화에 즉각적으로 대응하지 못했기 때문이며, 팝업을 열 때마다 위치가 수정되었던 이유는 캔버스가 리빌드되면서 레이아웃이 새로 계산되기 때문이었다.

## 241208
[[241208]]
### 짭명방
#### 아이템, 인벤토리 UI 구현하기
- 아이템 UI와 아이템 디테일 UI를 우선적으로 구현함
- 아이템 패널 UI 구현 중. [[글자의 크기에 따른 배경 맞추기]]

- **부모 캔버스의 `Canvas Scaler` 설정이 `Scale With Screen Size`** 라면 자식 오브젝트에서 height, width에 **특정 값을 넣더라도 해상도가 변화함에 따라 그 크기가 자동으로 변화**함

> `ItemDetailPanel` 구현하다가 끝냈다. UI에서 또 생각할 게 있었다.
>  `Description` 부분이 어떤 식으로 들어가는지 레이아웃을 살펴보고, 스크립트랑 연결만 해주면 될 듯? 그 다음은 배경화면 디밍 되는 걸 블러로 바꿔서 처리하면 될 것 같다.


## 241206
[[241206]]
- 적고 나니까 왤케 한 게 없어 보임?
### 짭명방

#### 아이템, 아이템 인벤토리 구현하기
- [[아이템, 아이템 인벤토리 구현하기]]

#### OperatorLevelUpPanel에 미리보기 기능, 최대 레벨 버튼 추가하기
- 계산 시스템 : `ExpCalculationSystem`
	- 보유한 아이템들로 도달할 수 있는 최대 레벨을 계산
		- 이거의 경우 `MaxLevelButton`을 구현해서 해당 레벨로 바로 스크롤될 수 있게끔도 함
		- 스크롤 중에는 살짝 오른쪽으로 밀려나고, 멈출 때는 원래 위치에서 클릭 가능하도록 움직임도 구현
	- 어떤 레벨에 도달하기까지 필요한 경험치 아이템의 종류와 수 계산

#### 기타 수정
- 정예화 후에 레벨이 1로 돌아갈 때 스탯도 1로 돌아가는 현상 수정
- `OwnedOperator`, `OperatorGrowthSystem`에 있는 오퍼레이터 성장 메서드들 정리
- `OperatorInventoryPanel`에 정예화 표시하기
	- `iconHelper`에 정예화 - 이미지 할당 기능 추가, `OperatorIconhelper`로 수정, `OperatorIconData`에 할당해서 관리함.
	- 정예화 이미지 구현 및 `OperatorSlot`, `OperatorDetailPanel`, `OperatorPromotionPanel` 등에서 해당 부분을 할당하게끔 작성. 없다면 이미지 오브젝트 끔

> 발견한 이슈
> - 인게임에서 레벨업한 내용이 반영이 안 됨. 아마 `ScriptableObject`을 가져와서 그럴 거임

- 스크립트가 많아지고 찾기 어려워져서 디렉토리 다시 정리.

## 241205
소녀전선 2 해보고 후기 글 쓰느라 많이 늦었다.
[[241205]]
### 짭명방

#### 정예화 패널 구현하기
- 미리보기 완성하기
	- 스킬은 아직 만든 게 없으니까 냅두고
	- 추가되는 공격범위만 미리보기 가능하게 하기
	- 확인 버튼의 조건 체크

- ~~정예화 이후의 레벨 관리(못함)~~
	- 0정예화 50레벨과 1정예화 1레벨의 스탯은 동일함
	- 레벨업 시의 스탯이 올라가는 로직은 똑같다.


#### 이슈 해결
> 해결해야 할 일
> - `OperatorInventoryPanel`과 달리, `DetailPanel`에서는 `UIHelper`의 클래스 초기화가 제대로 되지 않는 듯 보임
- 해결 : `DetailPanel`에서는 해당 클래스 초기화 시점을 `Initialize`로 옮겨줌
	- 추가로 패널이 켜지고 꺼질 때마다 기존 공격 범위가 남는 이슈가 있었음.  `CurrentOperator`가 변할 때마다 타일을 없앰.
- 패널마다 공격 범위 그리드 크기를 다르게 지정해주기 위해, `UIHelper`에서 타일 크기를 지정할 수 있게끔 변경함

---
- 깨알 지식
```cs
// tileSize를 지정하지 않게끔 메서드를 쓰고 싶을 경우
CreateAttackRangeHelper(container, offset);

// 1. 이렇게 쓰면 안됨
public AttackRangeHelper CreateAttackRangeHelper(RectTransform container, float offset, float? tileSize)
    {
        return new AttackRangeHelper(container, offset, tileSize);
    }

// 2. 이렇게 써야 함
public AttackRangeHelper CreateAttackRangeHelper(RectTransform container, float offset, float? tileSize = null)
    {
        return new AttackRangeHelper(container, offset, tileSize);
    }
```
여기서 `float? tileSize`로만 지정하는 경우, 실제로 이 메서드를 사용할 때에는 `tileSize`에 해당하는 값을 지정해야 함.
- `float?`을 쓴다는 건 해당 매개변수가 `null`이 와도 된다는 의미지만, **이 메서드를 사용할 때 해당 변수에 아무것도 쓰지 않아도 된다는 의미는 아님!**
- **기본값까지 설정해줘야 아무것도 안 써도 동작하는 선택적 매개변수가 된다.**
---
- 디테일 패널 초기화 이슈 : 레벨업 후 상태가 업데이트되지 않는 문제 수정
	- `OnEnable`에서 현재 오퍼레이터가 할당된 경우에만 업데이트하도록 함 -> 그래서 `Initialize` 하기 전에 패널이 켜졌을 때에는 `UpdateAllUI()`가 `OnEnable`에서 먼저 실행되는 걸 막았다.

- 레벨업 패널 스크롤 이슈
	- 어떤 오퍼레이터의 레벨업 수행 -> 다른 오퍼레이터의 레벨업 패널을 켜면 스크롤이 이전 오퍼레이터의 레벨과 현재 오퍼레이터의 레벨 사이에 위치하는 현상이 있음
	- `OperatorLevelUpPanel.OnDisable`에 패널의 정보를 정리하는 코드 추가

## 241204

### 짭명방
#### OperatorInventoryPanel
- `OperatorSlot`에 레벨 게이지 추가

#### OperatorLevelUpPanel
- 수정사항이 생기면서 스크롤이 다시 생성되거나 변동이 있는 경우에, 스크롤이 위에서 날아오는 현상이 있었음
	- `Movement Type`을 `Elastic -> Clamped`로 고치니까 원하는 구현이 나오는 것 같다.
- 레벨업 후 `targetLevel`이 `currentLevel`이 되면서 반영되어야 할 스탯 업데이트 반영
- `ConfirmButton` 활성화 조건 수정
- `ConfirmButton` 클릭 시 우측 상단에서 확인 패널 들어오게 하기
- `OwnedOperator`의 현재 경험치가 게이지에 반영되도록 함
	- `OperatorDetailPanel`도 같은 부분이 있어서 수정

#### 여러 패널 공통 사용 UI를 따로 빼둠 : UIHelper
- 인벤토리, 디테일, 정예화 패널에서 공통적으로 쓰이는 옵션들이 있어서 따로 게임 오브젝트로 뺌
- 정예화 패널의 경우 정예화가 된 다음의 공격 범위는 다른 색으로 미리 보여주는 기능을 구현할 것이기 때문에 추가적인 처리가 필요함


#### ~~아이템 인벤토리 시스템, 경험치 아이템 구현 시작 못함~~



## 241203
[[241203]]
### 짭명방

> 할 일

> - 정예화 후에 미리보기
> 	- 그냥 단순하게 어떤어떤 기능이 해금됩니다 정도만 있어도 무방할 것 같음

- 계속 헷갈린다. [[오퍼레이터 성장 시스템 만들기]]
	- `OperatorProgress`를 없애고 `OwnedOperator`에 통합 

> - 레벨업 패널의 확인 버튼 클릭 시 레벨업 반영하기

이거에 대해 생각하고 있는 옵션이 2가지가 있음. 원본 게임은 아마 1번일 거임
1. 일관된 동작을 위해 확인 버튼을 누른 후에도 레벨업 패널 유지
2. 만렙을 달성했을 경우 더 이상 올릴 레벨이 없으니 뒤로 가기

#### 현상 수정
- `OperatorLevelUpPanel` : 패널을 처음 열 때는 괜찮은데, 2번째부터는 스크롤이 위에서부터 날아오는 효과가 보임.
	- `currentLevel`이 1이 아닐 때 패널을 여는 상황에서 스크롤이 날아오는 현상이 있다. 레벨업 누른 직후에는 애니메이션을 없애야 할 듯.


## 241203
### 짭명방
?
## 241202
[[241202]]
### 짭명방

#### OperatorLevelUpPanel 마무리
- `OperatorData`에 레벨업 당 스탯 반영, 좌측 하단에 레벨업 시 적용될 스탯 보여주기
![[Pasted image 20241202163319.png]]
> 저 원 슬라이더에 나타날 노란 표시는 경험치 아이템을 먹이고 나서의 슬라이더 표현
> 그걸 구현하려면 특정 레벨에 도달하기 위해 필요한 경험치를 계산하는 식이라든가 이런 게 필요할 것 같다. 아직 경험치 아이템 같은 걸 구현하지는 않았으니 이 정도.

#### OperatorPromotionPanel 구현
- 업데이트 로직이랑 확인 버튼만 구현해둠. 
- 오늘은 확실히 게을렀다.



## 241201

### 블로그
- 휴일을 맞아!!!! 평소에 건드리지 못하는 자기소개랑 데이터 수집 관련한 이슈를 정리했다
	- 조회 단위를 `오늘로부터 n일 전` 같은 식으로 구현했는데, 이를 날짜 범위 및 드롭다운 버튼으로 수정했음.
	- 프론트랑 백엔드 다 고치고 프론트 버킷 지우고 클라우드 프론트 무효화 한 번 하고 백엔드 이미지 다시 만들어서 올렸는데
	- **갑자기 데이터 수집이 또 잘 작동한다.** 다행히 백엔드에 마지막 날짜에 관한 조건을 넣지는 않았어서 이미지 빌드는 다시 안 해도 될 것 같음. 버킷에만 조건 다시 정리해두면 될 듯.
- 올해는 버닝비버가 땡기지 않는구만 허허..


