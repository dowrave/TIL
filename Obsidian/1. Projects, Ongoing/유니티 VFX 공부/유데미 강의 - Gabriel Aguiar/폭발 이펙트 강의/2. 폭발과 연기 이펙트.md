1. [[#1. 연기 이펙트 - 상단 연기 구현|1. 연기 이펙트 - 상단 연기 구현]]
2. [[#2. 메쉬 구현 - 블렌더|2. 메쉬 구현 - 블렌더]]
3. [[#3. 셰이더 구현|3. 셰이더 구현]]
	1. [[#3. 셰이더 구현#Particle System - Custom Vertex Streams|Particle System - Custom Vertex Streams]]
	2. [[#3. 셰이더 구현#일단 계속 진행|일단 계속 진행]]
	3. [[#3. 셰이더 구현#버텍스 애니메이션|버텍스 애니메이션]]
4. [[#Mid, Btm도 구현|Mid, Btm도 구현]]
	1. [[#Mid, Btm도 구현#중간|중간]]
	2. [[#Mid, Btm도 구현#아래|아래]]


## 1. 연기 이펙트 - 상단 연기 구현

- 오브젝트 트랜스폼 설정
	- `Rotation` : `-90, 0, 0`

- `Renderer`
	- 메쉬, `Sphere` 사용

- `Velocity Over Lifetime`
	- Z축만
		- `Curve`로 구현, 최상단 값을 3으로 수정한 뒤
		- 시간 0.5 쯤에서 `Edit Key` 기준 0.15 정도로 끝나게끔 구현
		- 여기 속도는 `Start Speed`의 영향을 받는다.

- `Shape`
	- `Circle`, `Radius = 0.4`

>[!note]
>- 값을 일일이 적어놓지는 않겠음 
>	- 프로젝트마다, 상황마다 다 달라지니까.
>- 대신 어떻게 동작하는지는 적어두겠음

`Circle`에서 시작, `Z`축에 관한 스케일 값을 크게 줬기 때문에 방사형으로 퍼져나가되 위로 올라가다가 속도가 팍 죽는 모양이 나온다. 
![[particlemove.png]]
> 대충 이런 느낌.
- `Start Speed`에 비해 `Velocity Over Lifetime`의 Z축 스케일 값을 더 크게 설정했기 때문에 `Circle`에서 사선으로 퍼져나감.
- `Color over Lifetime`이나 `Size over Lifetime`을 줘서 커지면서 사라지는 효과를 줬다. 

## 2. 메쉬 구현 - 블렌더
- `Icosphere`를 만듦. `Subdivisions : 1`로 설정
- `Add Modifier - Subdivision Surfaces` 추가. 
- 이 상태에서 `Shift + D`로 오브젝트를 복사해서 총 6개의 오브젝트를 겹치게 설정한다. 각 오브젝트가 정팔면체의 꼭짓점에 위치한다는 느낌으로 배치한다.
- 만족할 만한 모양이 되었다면 모든 오브젝트를 잡은 상태에서 `Ctrl + J`로 1개의 메쉬로 붙인다.
![[Pasted image 20250908134843.png]]
> [!warning]
> 1. 이런 식으로 겹치는 부분에 면이 많이 남아 있으면 성능에 좋지 않음
> 2. 표면도 부드럽게 처리하겠음

- `Add Modifier - Remesh`, `Voxel, Smooth Shading`을 켠다
	- `Voxel Size : 0.15 ~ 2`
	- `Adaptivity : 0`

- 이 상태에서 `Edit Mode`로 들어가서 다른 것들도 수정할 수 있음
![[Pasted image 20250908135329.png]]
> 여기서 한 버텍스를 잡고 `L`을 누르면 해당 구체(처음에 복사했던 1개의 `Icosphere`)만 잡힌다. 

- 만들어진 메쉬
![[Pasted image 20250908135557.png]]

이름 바꾸고 `Modifier`들을 `Subdivision Surface`부터 `Apply(Ctrl + A)`해준다.

이렇게 **메쉬들을 이어붙여서 새로운 메쉬를 하나 만들고 나면 반드시 해야 할 작업으로, `Shift + A -> Apply All Transforms`을 적용**한다.
- 지금의 메쉬 형태가 오브젝트의 새로운 기준이 됐다. 지금의 형태를 `0, 0, 0` 회전과 `1, 1, 1` 스케일이라고 하자! 라고 정의하는 것에 가깝다. 즉 새로운 기준을 정한 것임.

- UV Map 적용
	- 지금 같은 형태는 예외적인 형태 중 하나로, **`Unwrap - Sphere Projection`이 잘 먹힌다.**
	- 모든 버텍스를 사각형 내에 넣고 저장해줌. 
	- 지금 강의의 경우 `Export`할 때 별도의 세팅을 하지 않는다. 거의 그대로 저장했음. 근데 **오브젝트 모드에서 오브젝트를 선택한 상태로 내보내는 건 잊지 말자.**

- 유니티에 옮긴 다음 스케일 팩터만 100으로 설정하고 `Apply`

## 3. 셰이더 구현
- `ErosionVoronoiShader`를 만듦.
- `URP - Lit, Transparent, Alpha Blended`

![[Pasted image 20250908143050.png]]
여기까지는 아는 내용임.


### Particle System - Custom Vertex Streams
>[!question]
> **파티클 시스템에서 파티클 생성 -> `lifetime` 동안 진행되면서 사라지는 동작(=AlphaClip을 파티클 시스템이 진행되면서 서서히 증가시킴)을 어떻게 구현할 수 있을까?**
> - `color over liftime`은 파티클 전체가 한꺼번에 사라지는 동작이지 일부부터 시작해서 서서히 사라지는 건 아니었다.

- 파티클 시스템의 `Renderer`에는 **`Custom Vertex Streams`** 이라는 옵션이 있다. 
![[Pasted image 20250908143338.png]]
이는 셰이더에 있는 파라미터를 조절할 수 있게 해주는 옵션임. 

이를 체크, `+ -> Custom -> Custom1.xyzw`를 추가한다.
![[Pasted image 20250908143813.png]]

다시 셰이더로 돌아가서, **`UV` 노드를 추가한다. 여기서 채널은 `UV1`로 설정**한다. `Split` 노드를 연결한 뒤 `R(커스텀의 x채널)`을 `Alpha Clip Threshold`에 연결한다. 기존의 `Alpha Clip` 프로퍼티는 삭제한다.
![[Pasted image 20250908144358.png]]

`Custom Vertex Streams`에서 `UV2`를 추가한다. 위치는 `Custom1.xyzw`보다 위로 옮긴다.

- 파티클 시스템의 `Custom Data`를 활성화한다. 2개의 `Custom`이 있는데, `Custom1`에서 `X`를 `Curve`로 바꾸고 시간 0.5 지점에서부터 값을 증가시켜서 시간 1 지점에서는 1이 되게끔 구현함.

> 원리가 궁금해서 이것저것 살펴봤는데, 정황 상 `Custom1.xyzw`가 동작하는 게 아니라 **밑에서 추가한 `UV2`가 `Custom Data`의 `Custom1`로 들어가고 있다.** `UV2`를 없애면 사라지는 효과가 동작하지 않았기 때문임.
> 그러면 왜 `custom1.xyzw`가 필요한 걸까? 강의를 더 본다.

### 일단 계속 진행
- 머티리얼의 `Surface Options` 켜는 방법 : **셰이더에서 `Allow Material override` 켜기**
- 이러면 `Transparent <-> opaque` 변경이 머티리얼 단위에서 가능해지는데, **`Opaque`로 변경하면 `Alpha Clip`이 꺼진다. 다시 활성화해줌.**

- 색상 추가
	- HSV 기준` 11, 92, 75`, 알파 `100`, 강도 `3.5`

- 만약 더 밝은 효과를 주고 싶다면 `Global Volume`에서 `Bloom - Intensity`를 만질 것

- 정적인 보로노이 효과 개선하기
	- 알쥬? `AngleOffset = Time * VoronoiSpeed(Property)`

- 폭발에서 검은 부분 증가시키기
	- `Voronoi`의 결과값에 `Power`를 적용한다. 이 값은 `Color`로 가는 값에만 적용하고 `Alpha`에는 영향을 주지 않는다.
	- 여기서도 **`Custom Data`를 사용해서 시간에 따른 변화를 구현**한다. `UV1`의 `G`값을 `Power`의 승수인 `B`에 연결하고, `Custom Data`의 `Y` 채널을 `Curve`로 구현, `t = 0.5`까지 `20` 정도로 확 증가시켜서 폭발 후에 검은 연기가 나타나는 효과를 구현한다.

![[VFXTutorial_Explosion.gif]]

여기서의 문제점이라면 `Power`를 확 증가시켰는데도 1. 여전히 밝은 곳이 남아 있는 현상이 있고, 2. 빛을 반사하는 효과도 있다는 것임

1. **`Vertex Color`를 추가해서 파티클 시스템의 `Color`가 반영되게** 함. -> `Color over Lifetime`에서 알파 효과는 제거하고 뒤로 갈수록 검정색이 되도록 수정
	- 사실 얼핏 봤을 때도 완전히 해결은 안됐는데, 일단 넘어감
2. 셰이더 설정
	- `Emission(Color)` 프로퍼티 추가. 검정색을 기본 값으로 넣는다. 마스터 노드의 `Emission`에 연결한다.
	- `Smoothness(Float)` 프로퍼티 추가. `Slider`로 `0~1`을 지정 가능하게 하고 `0`을 기본값으로 넣는다. 마스터 노드의 `Smoothness`에 연결한다.
	- `Metalic`이나 `Ambient Occlusion` 등의 옵션도 있지만 여기선 사용하지 않음. 

- **연기의 어두운 부분은 `Emission`의 색으로 변경 가능**하다. 내 경우 `Color`의 설정만 가져와서 명도만 2로 지정했음.
- 위에서 나타나는 광택 같은 건 확실히 없어진 걸 확인할 수 있다. 은은하게 나타나는 밝은 부분도 `Color over Lifetime`에서 검은 부분을 증가시켜주면 더 이른 시점에 다 제거할 수 있는 부분임.
![[VFXTutorial_Explosion_v2.gif]]

### 버텍스 애니메이션
> [!warning]
> - 모바일 게임이나 로우 엔드 플랫폼에는 추천하지 않음 - 성능에 영향을 주는 요소임

1. `Position` 노드를 하나 만듦. `Space : Object`로 설정
	- `Local Space`와 동일한 개념. 말 그대로 메쉬의 원점을 `0, 0, 0`으로 하는 좌표계.

2. 이후는 아래처럼 구현. 원래의 로컬 좌표계와 노이즈를 섞은 로컬 좌표계를 보간한 개념이다.
![[Pasted image 20250908155119.png]]
> `VertexAmount`는 `[-1, 1]`로 설정함.

3. 애니메이션 효과 구현
- `Tiling And Offset`에 `Time * Vector2` 하는 그거다. `Simple Noise`의 `UV`에 전달함.
- ![[VFXTutorial_Explosion_Wobble.gif]]
> 파티클 시스템이 멈췄는데도 자체적으로 요동치는 효과를 확인하면 됨

## Mid, Btm도 구현
- 지금까지 구현한 게 폭발하고 위로 올라가는 지점이었음
- 중간, 아래도 마저 구현함.

### 중간
- `ExplosionTop`을 복붙, `ExplosionMid`로 구현함
- `Y` 포지션은 `1.5 -> 1`로 수정
- `lifetime`은 `top`보다 짧게 : 아래가 먼저 사라지고 위가 나중에 사라지는 구현을 할 것
- `speed`도 `top`보다 짧게
- `size`는 `top`보다 크게
- `Velocity Over Lifetime`의 `Z`은 상수로 설정, `0.75`
	- `X, Y`는 `0`으로 설정
- `Top`, `Mid` 모두 `Rotation Over Lifetime`을 `45 ~ 90`으로 설정

### 아래
- 비슷한 원칙으로 구현하면 됨. `lifetime, speed, velocity over lifetime.z`는 작게, `size`는 크게..

- 3개의 이펙트 적용
![[VFXTutorial_Explosion_Fin.gif]]


