## 250515 - 블로그

### SavingPlan이 적용된 AWS 요금
![[Pasted image 20250515173439.png]]
> 5월 14일에 `SavingPlans`을 달고 나서 미리 요금이 잡혀있는 모습이다.
> 5월 14일에 시작했으니, **EC2 요금(하늘색)과 `SavingPlans`(와인색)이 같이 잡혀 있으니 정상적으로 적용되고 있다고 볼 수 있겠음.**
> `t2.micro`를 사용 중이며, 검색에 잡히는 블로그도 아니니까 현상을 유지할 생각.

플랜을 신청할 때 **시간 당 얼마까지 적용할 것인지를 묻는 부분**이 있다.

- 플랜을 적용한 후 할인 요금 기준인가?
- `On-Demand`로 사용하는 요금이 기준인건가? 

애매해서 AI들한테 물어보고 다녔는데 **플랜을 적용한 후 할인 요금 기준**으로 작성하면 된다. 
내 경우 `t2.micro`는 `on-demand`라면 `0.0144$/시간`이고, `1년, 선지불 없음`으로 하면 `0.0086$/시간`이어서 `0.0086$`을 입력했음. 요금표는 플랜 신청하는 곳에 링크로 있다.

플랜은 인스턴스 패밀리랑 리전을 고정하는 것으로 선택했다.

### 블로그 글쓰기 관련 이슈들 수정
- AWS의 `saving Plans`을 1년 달아버렸기 때문에, 최소한 1년은 더 써야 한다.
	- 그런 김에 **블로그에 글을 작성할 때 거슬렸던 부분들을 수정**함.

- [x] 붙여넣기 할 때 현재 커서에 붙여넣기되지 않고 문서의 가장 마지막 부분에 붙여넣기되는 현상
```ts
// QuillEditor.tsx
const selection = editor.getSelection(true); // true로 설정하면 커서 위치를 가져온다.
```
> 원래 `getSelection()`으로 사용되었음
> - 인자가 전달되지 않으면 `Quill`이 내부적으로 마지막으로 알고 있던 캐시된 정보를 반환함. 
> 	- `paste` 같은 이벤트에서는 에디터의 포커스 상태가 순간적으로 변할 수 있기 때문에, 실제 커서 위치와 다른 커서 위치를 가져올 위험이 있다.
> 	- 그게 왜 문서 끝부분인지는 몰루겠워요
> - **`true`가 전달되면 브라우저가 실제로 인식하고 있는 위치나 선택 영역을 강제로 조회**해서 가져옴. 에디터가 포커스되지 않았다면 포커스를 시도하기도 한다.

- [x] 영역을 잡고 붙여넣기 할 때, 새로운 글이 삽입되지 않는 현상
```ts
e.preventDefault();

// 선택된 텍스트가 있으면 먼저 삭제
if (length > 0) {
	editor.deleteText(index, length);
}

// 텍스트를 삽입하고 커서 위치를 조정함
editor.insertText(index, text, 'user');
editor.setSelection(index + text.length, 0);
```
> `deleteText`로 글이 지워진 다음에, `insertText`가 동작하지 않는 현상
> 1. `setTimeout`을 아래 영역에 줘서 삭제와 삽입 사이에 딜레이를 주기
> 	- 잘 동작하긴 하는데, 딜레이가 체감되는 게 보인다. 0.01초를 줘도 딜레이가 보인다?
> 2. 중간에 커서 위치를 조정하는 `SetSelection`을 넣는 방법도 시도해봤는데, 별 효과는 없었음.

1번으로 진행함.

- [x] 이미지 넣는 상황에서 커서의 위치 설정
	- 기존에는 마우스 커서의 위치에서 가장 가까운 위치로 텍스트 커서가 잡히는 방식이었음
	- 그런데 실제로 이미지를 삽입하는 상황을 생각해보면
```
글 <이미지> 글
```
처럼 쓰는 경우는 없고

```
글
<이미지>
글
```
처럼 글과 이미지 영역을 구분해서 쓴단 말임?

그러면 실질적으로 마우스 커서 위치에서 잡아내야 하는 건 "글의 몇 번째 줄이냐"가 더 중요한 정보로 보이고, 수평적인 정보는 그 다음에 생각하면 될 것 같다.
```ts
while (leafIndex >= 0) {
	// 현재 인덱스의 바운딩 박스 계산
	const bounds = editor.getBounds(leafIndex);
	// 세로 거리 계산 (텍스트 중심과 커서 위치)
	const verticalDistance = Math.abs((bounds.top + bounds.height / 2) - relativeY);

	// 세로 거리가 더 가까운 경우 갱신
	if (verticalDistance < minVerticalDistance) {
		minVerticalDistance = verticalDistance;
		minHorizontalDistance = Math.abs(bounds.left - relativeX);
		closestIndex = leafIndex;
	} else if (verticalDistance === minVerticalDistance) {
		// 같은 줄일 때 가로 거리 비교
		const horizontalDistance = Math.abs(bounds.left - relativeX);
		if (horizontalDistance < minHorizontalDistance) {
			minHorizontalDistance = horizontalDistance;
			closestIndex = leafIndex;
		}
	}

	// 인덱스 감소 (이전 leaf로 이동)
	leafIndex--;
}
```
> 의도한 바에 맞게 잘 동작한다. 이걸 사용함.
> 같은 질문을 넣었는데, ChatGPT-4o가 Gemini 2.5 Pro보다 훨씬 빠르게 응답했고 더 간결한 코드를 줬다. 클로드 3.7 Sonnet도 실험해봣는데 제미나이보다는 간단한 코드를 줬지만 의도한 대로 동작하진 않았음. ChatGPT-4o만 의도한 대로 동작함.
> 이건 의외다.


- [ ] (보류)엔터가 있는 글을 붙여넣기할 때 엔터가 1번 더 들어가는 현상
	- 이 컴포넌트에 붙여넣기 하는 상황이 문제인 줄 알았는데, 복사할 때가 문제였다. 외부 텍스트에 붙여넣기 해도 엔터가 2번씩 들어가는 현상이 나타나고 있음. 정작 `Quill` 내부에서는 복사하지 않은 원본 텍스트는 잘 유지됨.
	- 이 이슈 처리가 생각보다 빡세다. 
	- **괜찮은 상황을 O, 거슬리는 상황을 X**라고 해보자.
		- (O) `VSCode` 등의 코드를 에디터로 복붙할 때
		- (△) 에디터의 글을 복붙할 때
			- (O) 티스토리는 글에 적힌 대로 잘 들어감
			- **(X) 같은 에디터로 복붙할 때**
			- **(X) 마크다운, 메모장 등에 복붙할 때**
	- 이거는 그냥 보류하겠음. 
		- `Quill`의 `delta` 옵션이 어떻게 동작하는지까지 파고들어야 함
		- 구체적으로 어디가 원인인지 파고 드는 것도 시간을 많이 잡아먹을 것 같다. 
		- 그렇다고 치명적으로 거슬리는 이슈도 아니다.
		- 실질적으로 복붙을 활용한다고 하면
			- 외부의 글을 에디터에 넣거나
			- 블로그의 글을 티스토리로 빼는 경우
			- ..정도인데 이 두 경우는 엔터가 추가로 입력되는 경우는 아니다.
				- 특히 블로그의 글을 티스토리로 빼는 경우는 `에디터`에서 작성하다가 글을 외부로 빼면 문제가 되는데, 작성된 글은 Delta가 아니라 HTML로 저장되기 때문에 이걸 복사하면 큰 문제가 없음.

- [x] `ctrl + z`로 되돌리기할 때 사라진 텍스트가 제대로 되돌려지지 않는 현상
	- 정확히는 `붙여넣기` 동작을 할 때, 영역이 선택되어 있으면 영역을 지우고 붙여넣기가 들어간다.
	- 여기서 **`ctrl + z`를 누르면 붙여넣기된 글은 지워지지만, 이전에 지워졌던 `선택된 영역`이 되돌리기로 돌아오지 않는 현상이 있음.**
```ts
// 'user' 파라미터 추가
        if (length > 0) {
            editor.deleteText(index, length, 'user');
        }
```
> 이게 잡혀 있으면 `ctrl + z`을 눌렀을 때 삽입된 글이 지워지면서 기존 글이 다시 나타나게 된다.

- 영역을 잡고 붙여넣기를 할 때 기존 영역이 지워지는 로직은 유튜브 링크 조건문에 관계 없이 밖으로 뺐다.
	- 이 경우 `ctrl + z`를 할 때 임베드된 유튜브 영상이 지워지지 않는다는 문제가 있기는 하다. 하지만 **`ctrl + z`로 삽입된 유튜브 영상을 지울 상황 자체가 흔히 발생하는 경우는 아니기 때문에 그냥 이대로 가도 괜찮을 듯?**

- [x] 1번째 글자만큼은 한글이 조합되지 않는 현상 
	- 예를 들면 `예`를 친다고 하면 `ㅇㅖ`로 꼭 처음에만 이렇게 동작하는 현상이 있음. 다른 작업을 하다가 다시 첫 글자로 가는 경우는 멀쩡하게 잘 동작한다.
```ts
//handleTextChange의 아래 부분을 제거
// editor.root.setAttribute('spellcheck', "false"); // 빨간 밑줄 밴

// 초기화하는 useEffect 부분으로 빼서 spellcheck 부분은 1회만 설정하도록 함
quill.root.setAttribute('spellcheck', "false");
```

