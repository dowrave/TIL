
# 백엔드

## 새로운 앱 추가
```python
python manage.py startapp reviews
```

- `settings.py`
```python
INSTALLED_APPS = [
	# ...
    'reviews.apps.ReviewsConfig',
]
```

## reviews app

### models.py
```python
from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator

# 리뷰 카테고리
class ReviewCategory(models.Model):
    name = models.CharField(verbose_name = '카테고리 이름', max_length = 50, unique=True)
    
    def __str__(self):
        return self.name

# 개별 리뷰 글
class Review(models.Model):
    category = models.ForeignKey(
        ReviewCategory,
        on_delete=models.PROTECT, # 카테고리에 속한 리뷰가 하나라도 있으면 삭제 불가
        related_name='reviews'
    ) 
    title = models.CharField(verbose_name = '작품 이름', max_length = 100)
    release_year = models.IntegerField(verbose_name = '출시 연도', null = True)
    poster_image = models.ImageField(verbose_name = '포스터 이미지', upload_to='media/reviews/posters/', null=True, blank=True)
    rating = models.DecimalField( # 고정 소수점 숫자를 위해 FloatField 대신 사용(정확한 비교를 위해 필요함)
        verbose_name = '별점', 
        max_digits = 2, # 필드에 저장될 수 있는 숫자의 총 자릿수(5.0은 2자리)
        decimal_places = 1, # 소수점 이하 자릿수 1개
        validators=[MinValueValidator(0.0), MaxValueValidator(5.0)]
    )
    content = models.TextField(verbose_name = '리뷰 내용')
    created_at = models.DateTimeField(verbose_name = '작성일', auto_now_add=True)
    updated_at = models.DateTimeField(verbose_name = '수정일', auto_now=True)

    class Meta:
        ordering = ['-updated_at']

    def __str__(self):
        return self.name
```

### serializers.py
```python
from rest_framework import serializers
from .models import Review, ReviewCategory


class ReviewCategorySerializer(serializers.ModelSerializer):
    class Meta:
        model = ReviewCategory
        fields = ['id', 'name']

class ReviewListSerializer(serializers.ModelSerializer):
    """목록 뷰(그리드)를 위한 시리얼라이저"""
    category = ReviewCategorySerializer(read_only=True)

    class Meta:
        model = Review
        fields = ['id', 'title', 'release_year', 'poster_image', 'rating', 'category', 'created_at', 'updated_at']

class ReviewSerializer(serializers.ModelSerializer):
    """상세 뷰 (모달)를 위한 시리얼라이저"""
    category = ReviewCategorySerializer(read_only=True)

    class Meta:
        model = Review
        fields = '__all__'
```

### views.py
```python
from rest_framework import viewsets
from rest_framework.pagination import PageNumberPagination
from .models import Review, ReviewCategory
from .serializers import ReviewListSerializer, ReviewSerializer, ReviewCategorySerializer

# 무한 스크롤을 위한 페이지네이션 클래스
class ReviewPagination(PageNumberPagination):
    page_size = 10  # 페이지당 리뷰 개수
    page_size_query_param = 'page_size'  # 쿼리 파라미터로 페이지 크기 조정 가능
    max_page_size = 100  # 최대 페이지 크기

class ReviewViewSet(viewsets.ReadOnlyModelViewSet):
    queryset = Review.objects.all()
    pagination_class = ReviewPagination

    def get_serilializer_class(self):
        if self.action == 'list':
            return ReviewListSerializer
        return ReviewSerializer

    def get_queryset(self):
        queryset = Review.objects.selecte_related('category').all()
        category_id = self.requeset.query_params.get('category')
        if category_id:
            queryset = queryset.filter(category_id=category_id)
        return queryset 
    
class ReviewCategoryViewSet(viewsets.ReadOnlyModelViewSet):
    queryset = ReviewCategory.objects.all()
    serializer_class = ReviewCategorySerializer
```

### urls.py
```python
from django.urls import path, include
from .views import ReviewViewSet, ReviewCategoryViewSet
from rest_framework.routers import DefaultRouter

router = DefaultRouter()
router.register(r'items', ReviewViewSet, basename = 'review') # /api/reviews/items/
router.register(r'categories', ReviewCategoryViewSet, basename = 'review-category') # /api/reviews/categories/

urlpatterns = [
    path('', include(router.urls)),  # /api/reviews/
]
```

# 프론트엔드

