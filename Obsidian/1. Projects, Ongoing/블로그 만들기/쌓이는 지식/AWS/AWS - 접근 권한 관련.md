- 현재 프로젝트의 **의도**
	- 클라우드 프론트 도메인으로 접속한 누구나 사이트의 컨텐츠를 볼 수 있어야 함
	- 컨텐츠를 가져오는 건 모두에게 오픈된 클라우드프론트이므로, **로드밸런서의 설정과 스토리지 버킷의 정책이나 인바운드 규칙이 사용자에게 영향을 줘선 안됨**
	  
- 현재 상황
	- **s3 스토리지 버킷의 설정, 로드밸런서의 설정에 의해 컨텐츠의 노출 여부가 결정**됨
		- 즉 로드밸런서에 인바운드로 `80`이나 `443`에 대해 `0.0.0.0/0` 정책 설정이 되어 있지 않다면 블로그에 작성한 글이 노출되지 않음
		- 스토리지 버킷의 설정도 마찬가지.

- 답이 안 보이는데?
	- 일단 **스토리지 버킷, 로드밸런서의 인바운드 규칙으로 모든 접근을 허가**해뒀음;
	- **블로그의 글이나 컨텐츠가 모든 사용자에게 오픈**되어야 하는 건 맞거등요?
	- 근데 그 방식이 클라우드프론트에서의 요청으로부터 나와야 한다는 거임
	- 지금처럼 그냥 모든 IP에 대해 로드밸런서로의 접근 허용 이런 게 되면 안되는 걸로 앎
		- `admin`에도 사용자가 접근할 수 있고...

- 일단 이미지 관련) 
	- 클라우드프론트에서는 `s3` 링크의 값을 `src`로 갖는 이미지가 보이지만, 해당 링크로 사용자가 직접 접근하면 `Access Denied`가 뜨도록 설정함
	- 클라우드 프론트에서는 해당 오리진에 대해 OAC 설정을 하고, 스토리지 버킷에서는 해당 클라우드프론트에 대한 접근을 허용해주면 된다.

## 답을 찾아봅시다
- [내가 올린 질문](https://repost.aws/questions/QUb7pk0Un9RRyb03Iu7pHjjw#ANX2gSzc8sQ_2g6vS41t1ogA)
	- **저 형님의 답변과 대충 추측이 간 바를 토대로 AI에게 물어본 걸 정리**하면..
	- 클라우드프론트에 접속한 다음, 해당 사이트에서 발생하는 axios 요청은, axios에 들어간 URL이 정확히 어떤 곳을 가리키느냐가 중요해진다.
		- 브라우저가 클라우드프론트로부터 받은 페이지를 렌더링하는 과정에서 `axios.get` 요청을 만나면 `api.htlee-blog.com` 으로 새로운 HTTP 요청을 보낸다.
			- 이 때, 이 요청은 **사용자의 브라우저(로컬IP)에서 출발**한다.
		- 만약 `api.htlee-blog.com`이 클라우드프론트를 가리킨다면 이 요청이 다시 클라우드프론트로 라우팅된다.

- 즉 `axios.get`으로 나가는 요청을 클라우드프론트를 가리키게 하면 됨
- 그러려면 클라우드프론트의 동작 설정을 다시 해줘야겠죠?

- 일단 504에러 -> 502에러로 오기는 했다
	- `https`에 대한 접근으로 통일시켜줬음
- **502 에러는 클라우드프론트 - 오리진 간의 통신은 되지만, 유효한 응답은 받지 못할 때 발생**한다고 한다. 
- `api` 랑 `www`가 다른 SSL 인증서를 써서 그런가?
- 인증서를 통일하려면 클라우드프론트를 아예 싹 지웠다가 다시 만들어야 할 듯?