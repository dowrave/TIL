#tableau #데이터시각적분석태블로로끝내기

#### 참고
- Tableau Public은 구글 스프레드 시트를 가져올 수는 있는 거 같은데, 함수로 가져온 내용을 열면 내용이 다 사라짐
- 따라서 그 내용을 한 번 복사 - 붙여넣기 한 다음, 이를 호출한 함수를 없애고 피쳐에 이름을 다시 지정하는 방식으로 실습 진행함

## 1. 구글 파이낸스 주식 데이터 불러오기

> 1. 웹 페이지의 데이터를 자동으로 가져오는 방법?
> 2. 경쟁 회사를 비교하는 대시보드를 만들기 위해 고려해야 할 것들

1. 네이버(`035420`) 종가 기준으로 가져오기
```googlesheet
= GOOGLEFINANCE("035420", "close", DATE(2010, 1, 1), TODAY())
```
	- 종가(`CLOSE`)기준 2010년부터 오늘까지
	- 참고) 시가(open), 저가(low), 고가(high)
	- 현재 가격 ) `GOOGLEFINANCE("035420", "price")`


## 2. 테이블 구성과 데이터 원본 바꾸기
- 가져온 엑셀 파일은 2개의 시트로 구성되어 있고, 날짜 / Open / 날짜 / Close ... 이런 식으로 구성됨
- 일단 1개의 시트를 올렸을 때, 중복되는 날짜는 활용할 필요가 없으니까, 1개만 남기고 나머지는 `숨기기`를 적용함
- 2번째 시트를 올리면 **관계를 만들 일치하는 필드**를 선택하라고 뜬다(`JOIN`하고는 다른 듯?)
- 이 경우 `Date`를 맞춰줄 수 있으니까, `Date`를 지정하면 됨
	- 스프레드시트에서 필드 이름을 동일하게 했지만, 여기서 2번째 시트 뒤에는 (KAKAO)가 붙기 때문에 한 번 더 물어본다
	- 이렇듯 관계를 설정할 때는 기본적으로 **공통된 필드명**이 기준이 된다.

## 3. 대시보드 구성
- 상단에는 CI 이미지를, 그 아래에는 3종류의 매개변수를 배치함
- 상단에서 선택한 회사 CI에 따라 최고가, 최저가, 최근가를 표현하고 아래에는 두 회사의 추이를 살펴볼 수 있는 라인 그래프를 만듦

## 4. 특정 날짜 기준 N일 동안의 추세 살펴보기

#### 1. 기준이 되는 날짜 매개 변수 만들기
- 이름 : `p. from`
- 데이터 유형 : 날짜
- 허용 가능한 값 : 범위
- 범위 : `다음에서 값 추가 - Date`
- 최솟값 유지, 최댓값 체크 해제

#### 2. 설정한 날짜 기준 이전 N일 제한을 두는 정수 매개변수 만들기
- 이름 : `p. last n days`
- 유형 : 정수
- 현재 값 : 28 (지난 28일 간의 데이터를 보겠다)
- 허용 가능한 값 : 전체

#### 3. 1, 2를 이용한 날짜 범위 계산된 필드 만들기
- 이름 : `f. date range`
```tableau
DATETRUNC('day', [Date]) >= DATEADD('day', 
                    -[p. last n days], 
                    [p. From]) + 1
AND
DATETRUNC('day', [Date]) <= [p. From]
```
- **필터**에 들어가는 식이며, 날짜의 범위를 `[p. From]`부터 `[p. last n days]`일 이전까지를 지정함
> 지금까지 해온 것에서 보이듯, 매개변수 자체는 화면에 주는 영향이 없지만 이를 이용한 특성을 만들어서 화면에 영향을 줄 수 있다.

#### 4. 기간 화면과 전체 화면을 Toggle로 번갈아가며 보여주는 매개변수 작성
- `p. toggle`
- `bool`
- 참 : `범위 내`
- 거짓 : `포함 전체 범위`

#### 5. 4.를 이용한 계산된 필드 만들기
1. `f. from to` :  `4.`가 거짓(전체 범위)이라면 전체 날짜 범위
```tableau
DATETRUNC('day', [Date]) >= { FIXED  : min([Date])}
and
DATETRUNC('day', [Date]) <= { FIXED: MAX([Date])}
```

2. `f. toggle` : `4.`가 참(한정 범위)라면 한정 범위를 보여줌
```tableau
IIF([p. toggle] = True, [f. date range], [f. from to])
```

- 위에서 `f. date range`를 필터에 넣었다 : 이건 토글을 True로 놨을 때 나와야 하는 화면이므로, 필터에서 제거한다
- 즉, `f. date range`와 `f. from to`라는 2개의 필터를 `f. toggle`이라는 1개의 필터로 합쳐주며, 이걸 켜고 끄는 파라미터가 `p.toggle`인 것이다

- 참 거짓을 동시에 표현할 수는 없다(당연히!) -> 필터에 올릴 때 `참` 혹은 `거짓` 1개의 값만 선택해서 올린다

#### 6. 전체 범위에서 파라미터로 지정된 기간 배경 색칠하기
##### 1. 계산식 만들기
- `p.from` -> `p. last n days`로 이동하는 `to` 계산식 만듦
```tableau
DATEADD('day', -[p. last n days], [p. from]) + 1
```
- `+1`은 `p. from` 날짜를 포함해서 최근 N일을 살펴보게 해줌
- `dateadd` : 뒤의 날짜 기준 중간 날짜를 1번째 단위만큼 움직인 날짜를 반환함

- 이후 `날짜` 및 `연속형`으로 바꾼 뒤, 우클릭 드래그 -> `세부 정보` -> 가장 위의 `연속형`

##### 2. 범위 지정하기
- `분석` - `참조 구간`- `패널, 일(Date)` 선택
	- 시작 구간 값 : `p.from`
	- 시작 구간 레이블, 도구 설명 '없음'
	- 끝 구간 값 `to`
	- 끝 구간 레이블, 도구 설명 `없음`
	- 서식 지정 채우기 '밝은 회색'