
> 설치를 하려고 딱 봤더니? `Anima 2D`가 애셋 스토어에 없다. 유니티의 `2D 애니메이션 패키지`에 포함이되어있다고 해서 그걸 사용해보기로 함. 막히면 멈춤.
> 책이 2020년 1~3월에 쓰였다고 하니 참고.

- `Anima 2D`를 이용한 캐릭터 설정 및 간단한 애니메이션 구현
- `Anima 2D`는 유니티 테크놀로지스에서 무료로 제공하는 애셋, 이를 활용해 2D 본 애니메이션을 간단히 만들 수 있다. 
- `2D 본 애니메이션`은 이미지에 **뼈대**를 할당하고, **가중치**를 할당해 **3D 폴리곤 모델과 같이 뼈대를 따라 이미지를 변형**시킬 수 있다.
	- 이를 활용해 이동, 회전 등으로만 구성된 애니메이션보다 풍부한 표현을 할 수 있다.

## 유니티에서 쓸 수 있는 대표적인 애니메이션
1. 이미지를 연속해서 표시하는 `프레임 애니메이션`
2. 이미지를 분할하고, 피봇을 기점으로 이동과 회전을 제어하는 `2D 애니메이션`
3. 뼈대를 사용한 `본 애니메이션`
4. 외부 도구에서 만든 애니메이션 로드

이 중 1, 2는 유니티의 기본 기능으로 만들 수 있고, 설정도 간단하다. 하지만 
- `프레임 애니메이션`은 여러 이미지가 필요하고, 
- `2D 애니메이션`에서는 이미지 변형 표현이 불가능하다.

`본 애니메이션`의 구현은 공식 패키지인 `Anima2D`와 `2D Animation`을 사용한다.  


## Anima2D의 장단점
- 장점
	- 유니티 내에서 애니메이션을 만들 수 있다
	- 유니티 내에서 실시간 확인이 가능하다
	- 유니티 내에서 확장 가능하다
	- 유니티에서 공식적으로 제공하는 애셋이다
- 단점
	- `메시Mesh`의 꼭짓점에 애니메이션을 붙일 수 없다

자유도가 높기 떄문에 사람마다 구조나 각 부품을 만드는 방법이 다르다. 여기서의 설명 역시 필자가 사용하는 예시일 뿐이다.


## Anima2D의 워크플로우

<이미지 데이터 만들기 : 외부 이미지 저작 도구(포토샵 등)를 활용>
1. 이미지 만들기
2. 스프라이트 만들기 및 유니티로 임포트

<Anima2D 설정>
3. 스프라이트 설정과 부품 분할
4. 스프라이트 메시 만들기와 배치
5. 스프라이트 메시 설정(스프라이트 메시 에디터)
	- 뼈대 설정, 스프라이트 분할, 가중치 설정
6. 리깅 설정
	- IK 설정을 수행함

<애니메이션 만들기 : 유니티의 애니메이션 만들기 + Anima2D>
7. 애니메이션 만들기
	- `Anima2D`의 기능인 `포즈 매니저, 스프라이트 메시 애니메이션, 베이크 애니메이션` 등을 활용한다.

## 1. 이미지 만들기
> 샘플 이미지는 [깃허브](https://github.com/wikibook/ugdb?tab=readme-ov-file)에서 제공 중임. 이 챕터는 3-1.
- 이미지 저작 도구를 사용해 캐릭터를 디자인한다. 처음에는 이미지를 1장으로 그려도 괜찮다. 
- 여기서 샘플 이미지는 `클립 스튜디오`에서 러프한 스케치를 그리고, `어도비 일러스트레이터`에서 다듬고, 손발의 이미지를 부품별로 `포토샵`에서 임포트해서 잘라냈다.

- 골격을 고려한 디자인
	- `Anima 2D`는 이미지에 뼈대를 통과시키는 것이다. 관절, 뼈의 위치 등 골격을 고려한 디자인이 필요하다.
	- 이 때 나체 모델을 베이스로 하면 옷에 가려진 신체가 보이므로 골격을 움직일 떄의 위화감을 줄일 수 있다. 

- 책에서 좌, 우는 사용자가 봤을 때의 좌우임

## 2. 스프라이트 만들기 및 유니티로 임포트

- 부품 분할
	- 캐릭터의 움직임을 고려해서 부품을 나눈다.
	- 표정, 관절의 움직임, 관절 부분은 연결할지 말지를 완성됐을 때의 이미지를 머릿속에 그리면서 부품을 분할해나갈 곳을 확인해 나간다. 

- 포토샵으로 이미지 애셋 만들기
	- 파츠를 자를 때는 `포토샵의 이미지 애셋`을 추천한다. 
	- 레이어에 `사용할 파일명 입력 -> File -> Generate -> Image Assets` 체크로 애셋을 만들 수 있다. 항목에 체크해두면 데이터 업데이트 시에자동으로 애셋을 만들어 대체해준다.
	- 투명한 부분도 자동으로 `trimming`해주므로 윤곽선을 다시 자를 필요도 없다.
	- 지정한 크기로 덮어 씌울 경우는 마스크로 지정한다.

> 일단 내가 갖고 있는 이미지 관련 도구가 `Procreate` 밖에 없다.
> 그러면 위의 과정) **각각의 이미지를 개별 png 파일로 저장하는 게 가능한가?** 를 따져봐야 하는데, 가능하다. 
> 1. 파츠를 자르는 건 각 파츠별로 레이어를 개별로 해서 그리면 됨
> 2. 개별 레이어는 프로크리에이트의 `동작 - 공유 - 레이어 공유 - PNG`로 한꺼번에 저장할 수 있음.
> 3. 배경의 투명함은 기존에 해왔던 것처럼 배경 레이어를 체크 해제하면 됨

> Claude한테 프로크리에이트의 비교 시 한계를 물어보니까
> - 이미지 크기 조정 상황에서 품질 저하가 발생할 수 있음
> 	- 클립 스튜디오는 벡터 기반이라서 다양한 해상도 대응이 가능하다./ 프로크리에이트는 래스터 기반.
> - 포토샵은 레이어 관리가 더 효과적
> - 산업 표준 호환성 발생 가능성
> - 고급 자동화 기능 부재
...등등의 이슈가 있다고 한다. 그런데 지금은 잘 모르겠을 이슈니까 넘기고 **프로크리에이트로 작업할 수 있다!** 정도만 체크하고 넘어간다. 

---
- 이미지 준비
	- 디자인한 일러스트에서 바탕 이미지와 아틀라스 이미지를 만든다.
		- `바탕 이미지 `: 가장 뒤쪽에 배치하는 한 장의 이미지 
		- `아틀라스 이미지` : 부품별로 분할된 이미지를 한장의 텍스처로 모은 이미지

이 때 조각난 부품들을 꼭 하나의 이미지로 모을 필요는 없다. 책에서는 하나로 모으고 진행.

- 아틀라스 이미지 만드는 방법
	- 책에서는 `텍스쳐 패커Texture Packer`를 사용했다. 여러 이미지를 하나로 합쳐주므로 간편하다. 유료 라이선스가 필요할 수도 있지만, 간소화된 버전인 `텍스처 패커 온라인`이 공개되어 있다.
	- 조각난 이미지를 드래그&드롭해서 최적화된 상태로 만들어준다.

- 유니티에서 로딩하기
	- 배경 이미지와 아틀라스 이미지를 `Images` 폴더에 드래그 * 드롭한다.
	- 배경 이미지는 `BaseImage.png`, 아틀라스 이미지는 `Atlas.png`로 변경했다.
![[Atlas.png]]
![[BaseImage.png]]

## 3. 스프라이트 설정과 부품 분할
- `Atlas.png`
	- `Texture Type : Sprite`
	- `Sprite Mode : Multiple`
	- 이후 Apply
- `BaseImage.png`
	- `Sprite`는 동일
	- `Sprite Mode`는 단일 이미지이므로 `Single`

- 이미지 분할
	- `Atlas` 를 선택해서 `Sprite Editor`를 엶(`패키지 매니저에서 2D Sprite 설치 필요`)
	- `Slice`를 이용해 아틀라스를 잘라내고, 각 부품에 이름을 설정한다
		- 기본 설정 `Automatic`으로, 그대로 자른다. 결과 각 부품에 테두리가 생긴다.
![[Pasted image 20241122133909.png]]
- 여기서 같이 움직이게 하고 싶은 부품은 사각형을 클릭했을 때 나오는 파란 사각형을 수동으로 조절해준다. 눈꺼풀 위 같은 필요없는 작은 사각형도 삭제해준다.
- 이후 각 부품을 클릭해서 우측 하단의 이름을 알기 쉽게 바꿔준다. 이후 `Apply` 클릭.
	- 가운데 저게 `BodyBack`이라는데?...

## 4. 스프라이트 메시 만들기 및 배치
-  `Sprite 2D`에서 이미지의 형태를 변경하려면 이미지를 `Sprite Mesh`로 변경해야 한다. 
	- `Sprite Mesh`는 `Anima 2D` 용으로 최적화한 확장 스프라이트다. 

- 만들기 순서
	- 프로젝트 창에서 `Atlas` 텍스처 선택 -> 우클릭 -> Create - Anima 2D - Sprite Mesh를 실행하면 동일 계층에 여러 스프라이트 메쉬가 생성된다.
> 그러나 지금은 `Anima 2D`가 없다. 
> 일단 `Sprtie Editor - Skinning Editor - Auto Geometry`을 누르면 각 이미지에 흰색 선으로 된 삼각형들이 생긴다. 이후 우측 상단의 `Apply`를 클릭해서 진행해 봄.


- 이후 3개의 오브젝트를 씬에 배치한다.
- `Character`
	- `SpriteMesh` : 스프라이트 메시를 배치해 캐릭터 외관 정리
	- `Bone` : 캐릭터를 움직이기 위한 뼈대나 IK를 배치, 캐릭터를 움직이는 뼈대를 정리

- Main Camera 설정
![[Pasted image 20241122141244.png]]

- 바탕 이미지 배치
	- 바탕 이미지인 `BaseImage`를 씬에 먼저 배치한다. 프로젝트의 `BaseImage.png`를 하이어라키에 드래그앤드랍. `Character` 오브젝트와 동일한 계층에 배치한다.
	- 바탕 이미지의 아랫쪽 중심이 끝이 되도록 `Position : (-0.16, 3.06, 0)`
	- 색 조절 : `RGB 256 기준 70, 70, 70, 128`

- 스프라이트 메시 배치
	- 바탕 이미지에 맞춰서 각 부품이 올바른 위치에 오게 조정한다.
	- 한꺼번에 여러 이미지를 올리려고 했는데, `Anim` 파일을 등록하라는 게 떠서 뭔가? 싶음. 한 부품씩 작업한다.
	- 여러 부품이 있는 눈, 입은 `Normal` 버전만 쓴다.
![[Pasted image 20241122143301.png]]
`Order In Layer` 설정
	- 머리 : 6
	- 앞머리 : 9
	- 뒷머리 : 3
	- 입 : 8
	- 눈 : 8
	- 몸 : 5
	- 몸(뒤) : 2
	- 오른팔 : 4
	- 왼팔 :7
	- 오른발 : 3
	- 왼발 : 3
	- 꼬리 : 1
- 여기서 좌/우 기준은 개발자가 보는 기준이다

## 5-1. 스프라이트 메시 설정(뼈대 설정)

> 지금 버전에서 이런 **뼈대를 설정하는 과정은 `Sprite Editor - Skinning Manager`** 에서 되는 것으로 보인다. 
> 대신 이것들을 어떻게 조립할지는 모르겠다. 포토샵에서 `PSB` 파일로 가져오면 위치 정보도 가져와서 `Skinning Manager`을 켜면 자동으로 조립이 되는 것으로 보임.
> **`2D IK`를 설치하라는 언급이 나오지만, `2D Animation`으로 통합**됨.

> 그래서 좀 어떤 원리로 작동하는지에 대한 파악만 해두고, **자세한 구현은 이제부터는 생략**하겠음. 버전이 달라서 공부할 시간보다 다른 걸 찾고 대응하는 시간이 더 긴 것 같다.
### 뼈대 설정 시 고려 사항
![[Pasted image 20241122145814.png]]
- 크게 `조인트Joint`, `뼈대Bone`, `이펙터Effect`로 나뉜다.
	- 쉽게 말하면 조인트가 검은색 점, 이펙터가 끝의 얇은 부분, 뼈대가 그 사이를 잇는 부분이다.
- `조인트`
	- 관절 부분. 뼈대 안에 있는 검은색 점이다.
	- 회전과 확대/축소의 중심이 된다.
	- 부모 자식 관계가 있다면, 부모의 조인트가 움직이면 자식의 조인트도 움직인다.
	- 씬 뷰에서 이동 조작을 수행하는 지점.
- `뼈대`
	- `조인트`와 `이펙터`를 연결하는 선형 오브젝트. 
	- 씬 뷰에서 회전 조작을 수행하는 지점
- `이펙터`
	- 뼈대의 끝부분
	- 이펙터 위치에 의해 뼈대의 길이가 결정된다.
	- IK 컨트롤러가 설정된 위치
	- IK가 설정되면 모든 조작이 이 지점에 집약된다.

### 뼈대의 부모자식 관계
- 부모자식 관계를 맺으면, 자식은 부모의 위치 관계에 영향을 받는다. 
	- 부모의 뼈대를 회전시키면 자식도 함께 이동한다.
- 연결 관계를 끊으려면 `Bone 2D`의 `Child`에 설정된 뼈대를 삭제해서 `None`으로 만들 수 있음

... 정리할 내용이 더 있는데 버전이 달라서 역시 쉽지 않다. 일단 여기까지 하겠음.
