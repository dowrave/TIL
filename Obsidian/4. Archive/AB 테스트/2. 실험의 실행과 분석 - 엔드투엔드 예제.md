- 웹 서버, 브라우저, 데스크톱 앱, 모바일 앱, 게임 콘솔, 보조 장치 등 SW가 배포되는 모든 영역에 적용할 수 있다.

## 예제 설정
> 위젯을 판매하는 가상의 온라인 상점 사이트를 생각해보자.  
> 마케팅 부서에서 할인된 쿠폰 코드가 포함된 프로모션 이메일을 보내 판매를 늘리려 한다. 이전에 쿠폰을 제공한 적은 없다.  
> 그러나 어떤 직원이 쿠폰 코드를 추가한 후 상당한 수익을 잃었다는 기사를 읽었고, 쿠폰 코드를 삭제하는 것이 오히려 긍정적인 패턴이라는 것을 알았다고 하자. 체크아웃에 쿠폰 코드 필드를 추가하는 것만으로 수익 저하 우려가 있다.

### 쿠폰 코드를 추가하는 것의 영향 평가
`가짜 문이나 페인트칠을 한 문을 이용하는 방법`을 사용할 수 있다. 체크아웃 페이지에 쿠폰 코드 필드를 추가하되, 해당 필드로 접근하면 항상 `유효하지 않은 쿠폰 코드`를 반환한다.  
이 경우
- 아이디어 = 쿠폰 필드 더하기
- 구현 = 특정 UI 변화
이 때, 쇼핑 프로세스를 `퍼널Funnel`로 생각하는 것이 유용하다. `퍼널 분석`이란, 웹사이트에 유입된 사용자가 `전환Conversion`에 이르기까지의 흐름을 시각화해서 어떤 단계에서 가장 많이 이탈하는지를 알아보는 방법이다. 
![[20230731_220741.jpg]]
- 고객은 홈페이지에서 시작, 몇 개의 상품을 관람하고 카트에 상품을 추가하고 구매 프로세스를 개시하고 구매를 완료한다. 
- 물론 이는 단순화된 것으로, 꼭 순서대로 고객이 진행하진 않는다. 그러나 **간단한 모델은 실험 디자인과 분석을 통찰하는 데 도움이 된다. 실험은 일반적으로 퍼널의 특정 스텝을 개선하는 것을 목적**으로 하기 때문이다. 

#### 실험
- 쿠폰 코드 필드를 더하고, 2개의 상이한 UI를 테스트한다. 
- 변화의 영향을 측정하고자 **목적 지표, 성공 지표를 정의**한다. 1개의 지표만 있다면 그 지표를 직접 `OEC`로 사용할 수 있다. 이 실험의 경우는 **매출**이다.
	- 실제 사용자 숫자가 어찌됐든 변화할 수 있어서 매출의 합보다는 사용자당 매출이 좋은 OEC가 된다.
- 이후, 어떤 사용자를 고려할 것인지를 결정한다. `체크아웃 = 결제 페이지`인 듯.
	- 사이트를 방문하는 모든 사용자 
		- 체크아웃을 전혀 개시하지 않은 사용자를 포함하므로, 불필요한 노이즈가 추가되어 있다. 이를 제거하면 더 민감한 A/B 테스트가 될 수 있다.
	- 구매 프로세스를 완료한 사용자 
		- 변화가 사용자당 구매액에만 영향을 준다는 가정이 포함된 선택이다. 실제로는 구매를 완료하는 사용자 수에도 변화를 줄 수 있기 때문에 잘못된 선택이다. 
	- 구매 프로세스를 시작한 사용자
		- 변화가 퍼널 내에 있다는 전제 하에 적절한 선택이다. 잠재적으로 영향을 받은 모든 사용자를 포함하지만, 퍼널 영향을 받지 않는 사용자는 포함하지 않는다.

- 최종적으로 정교한 가설은, `쿠폰 코드 필드를 체크아웃 페이지에 더하면 구매 프로세스를 시작하는 사용자에 대한 사용자당 수입이 저하된다.`가 된다.

#### 가설 검정
지표의 추정치와 변동성을 이해하기 위해 `평균`과 `평균의 표준오차`를 본다. 평균 외에도 백분위수를 선택할 수도 있다. 통계적으로 유의미한 차이를 탐지하는 `민감도`는 표준오차가 낮을수록 개선된다. 

실험 시 여러 개의 샘플을 사용한다. 특히 종합 대조 실험에서는 실험군 샘플 하나, 대조군 샘플 하나를 갖는다. 평균이 같다는 귀무가설 하에 실험군 - 대조군 쌍의 샘플 간 차이가 있을 가능성이 작은지를 정량적으로 실험한다. **평균이 같을 가능성이 낮다면, 귀무가설을 기각하고 그 차이가 통계적으로 유의하다고 주장한다.** 더 정확히는 이 차이에 대한 p값을 계산해서, 그 값이 충분히 작다면 실험이 효과가 있다고 결론지을 수 있다.  
- `충분히 작다`란, `0.05 미만의 p값`을 사용하는 것이다. 이는 효과가 실제로 없다면 100번 중 95번 효과가 없음을 정확히 추론할 수 있음을 의미한다. 
- `통계적 검정력`은 변형군 간 차이가 있을 때, 이 차이를 유의미하다고 판별할 확률이다. 일반적으로 8~90%의 검정력을 가지는 실험을 설계한다. 
- `통계적 유의도`는 귀무가설 가정 시 우연히 관찰한 결과나 더 극단적인 결과를 발생할 수 있는 가능성을 측정하지만, **모든 통계적으로 유의한 결과가 실제로 의미있는 것은 아니다.** 
- 실제로 의미 있는 결과인지 설정하는 것은 그 차이가 비용을 지불할 가치가 잇는지 여부를 이해하는 데 중요하다. 수십억 달러를 버는 기업에서 `0.2%`의 변화는 중요할 수 있지만, 스타트업은 10% 이상의 변화를 추구하므로 2%도 작다고 느낄 수 있다.

#### 실험 설계
- 가설 설정, 실제적인 유의도 경계 설정, 지표 특징 결정 이후 진행한다.
- 결정 과정
1. 무작위 추출 단위는 무엇인가?
2. 무작위 추출 단위의 모집단은 어느 정도의 대상으로 하고 싶은가?
3. 어느 정도 규모의 실험이 필요한가?
4. 얼마나 오래 실험을 진행할 것인가?

1. 사용자들로 가정하며, 모든 사용자를 대상으로 한다고 가정한다.  
2. 실험의 크기는 결과의 정밀도에 직접적인 영향을 미친다. 작은 변화를 보고 싶거나 결론에 더 충실해지려면 규모가 커야 하는데, 아래 사항을 고려할 수 있다.
	- `OEC`로 사용자당 수익 대신 구매지표(구매했는가 Y/N)를 사용하면 표준 오차가 작아지고, 같은 민감도이더라도 실험 크기를 줄일 수 있다.
	- `실질적인 유의도 수준`을 높인다면 : 즉 1%의 변화 감지보다 더 큰 변화를 감지해도 좋은 경우에는 표본 크기를 줄여도 좋다.
	- 귀무가설 기각 전, 변화 발생을 확신하는 목적으로 `0.01`과 같은 낮은 `p값 임계치`를 사용하려면 표본 크기를 늘려야 한다.
3. 실험 규모 설정
	- 실험의 안전성 : 대규모 변경의 경우 적은 비율의 사용자로 시작하는 것이 좋다.
	- 다른 실험과 트래픽 공유 필요성이 있는가? 만약 그렇다면, 트래픽 요구사항의 균형을 어떻게 맞추는가? : 높은 수준에서 다른 테스트 사항이 있다면 이들을 순차적으로, 혹은 동시에 실행하도록 변경할 수 있다. 동시 테스트 간에 트래픽 분할이 필요하다면 각 테스트는 더 적은 양의 트래픽으로 끝나게 된다.
4. 실험 기간 설정
	- 더 많은 사용자 : 온라인 실험에서는 시간이 길수록 더 많은 사용자들이 실험에 참여하고, 이는 통계적 검정력이 증가된다. `y = x` 보다는 더 적은 수의 사용자를 갖게 될 것이다.
	- 주간 효과 : 평일과 주말에 달라지는 모집단의 사용자가 있을수 있다. 최소 1주일 실험을 하면서 주간 사이클을 포착했는지 확인해야 한다.
	- 계절성 : 공휴일 등도 영향을 줄 수 있다. `외부 유효성External Validity` : 결과가 일반화될 수 있는 정도, 다른 기간까지 일반화될 수 있는 정도를 의미한다.
	- 초두 효과, 신기성 효과 : 안정성에 시간이 걸리는, 초기 효과가 크거나 작은 경향이 있는 실험도 있다. 예를 들면 새로운 플래시 버튼을 클릭해보고, 유용하지 않다는 것을 깨달을 수 있음. 

이 실험 설계는
> 1. 무작위 추출 단위 : 사용자
> 2. 모든 사용자 대상으로 체크아웃 페이지 방문 사용자 분석
> 3. 사용자당 수익의 1% 이상의 변화를 감지할 수 있는 80%의 통계적 검정력을 갖기 위해 검정력 분석을 실시해 크기를 결정한다
> 4. 대조군 / 실험군 1 / 실험군 2 간 1/3씩 분할된 상태로 최소 4일 동안 실험을 실행한다. `요일 효과`를 확실히 이해하기 위해 1주일 실험을 실행하며, 더 오래 걸릴 수도 있다.

- 일반적으로 검정력을 과하게 높게 설정하는 건 문제가 없다. 오히려 세그먼트(지리적 지역, 플랫폼 등)를 검사하고 실험이 몇 가지 주요 지표의 변화 감지에 충분한 검정력을 가졌는지를 확인하기 위해 권장된다. 

#### 실험 실행과 데이터 수집
- 실험을 실행하려면 아래 2가지가 모두 필요하다.
- 사용자 - 사이트 상호작용 방식과 이러한 상호작용이 어떤 실험에 속하는지에 대한 로그 데이터를 얻기 위한 `계측Instrumentation`
- `인프라Infrastructure` : 실험 구성부터 변형 할당까지 실험을 수행할 수 있음

#### 결과 해석
|                    | 사용자당 수입(실험군) | 사용자당 수입(대조군) | 차이          | p값     | 신뢰구간       |
| ------------------ | --------------------- | --------------------- | ------------- | ------- | -------------- |
| 실험군 1 vs 대조군 | $3.03               | $3.12                 | -$0.09(-2.8%) | 0.0003  | (-4.3%, -1.3%) |
| 실험군 2 vs 대조군 | $2.96                 | $3.12                 | -$0.25(-7.8%) | 1.5e-23 | (-9.3%, -6.3%) |

- 실험 결과를 무효로 할 수 있는 문제가 발생하는 경우들이 있다.
- `가드레일 지표, 불변 지표` : 대조군 - 실험군 사이에서 유지되는 지표.
- 불변 지표의 유형
	1. `신뢰 관련 가드레일 지표` : 구성에 따른 샘플 크기 조정, 캐시 적중률 등
	2. `조직 가드레일 지표` : 조직에 중요하고 많은 실험에서 불변할 것으로 예상됨
- 이러한 가드레일 지표로 적절성 검사를 테스트한 후, 결과를 검토한다.
	- 둘 다 `p < 0. 05`이므로, 실험군 vs 대조군의 평균이 같다는 귀무가설을 기각한다.
	- 즉, 쿠폰 코드 입력란을 추가했더니 수익이 감소하더라는 패턴이 확인되었다. 
	- 따라서 **프로모션 코드를 도입하는 아이디어를 폐기**하기로 결정한다.

#### 결과 -> 의사결정
- 고려할 다른 요소들
	- 여러 지표 간의 절충
	- 변화 시작에 드는 비용
		- 출시 전 기능을 완전하게 구축하는 비용
		- 출시 후 지속적인 엔지니어링 유지 보수 비용
	- 잘못된 의사결정의 단점은? 