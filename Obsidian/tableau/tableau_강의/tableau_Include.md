#tableau_levelup 

> 예제
> `평균(Sales)`와 `Category`를 넣음
>> Category에 따른 평균값이 나오겠죠?
>위 상태에서 LOD 특성을 하나 만들고 선반에 넣음
```tableau
{ Include {Sub-Category} : AVG([Sales])}
```

- 새로운 특성은 어떻게 계산되는가?
- 이미 VLOD에 `Category`가 있는데, `Include`로 `Sub-category`를 넣었음 
- **현재 카테고리 레벨에서 `Include`로 호출한 특성까지 포함하여 `AVG[(Sales)]` 값을 구하게 됨.**
- **그 다음, `Category`를 기준으로 다시 계산**이 이뤄짐
	- 새로 만든 특성(측정값)은 집계값을 포함하여 들어가게 됨. `합(새특성)` 같은 느낌으로. 

> 예제에 대해 적용하면
> 1. 새로운 특성은 `Category(현재 VLOD) - Sub-Category(Include)`에 대한 `평균(Sales)`을 구함
> 2. VLOD는 `Category`이므로, `Category`에 대해 합계가 이뤄지게 됨

|                 | 평균 Sales | Sub-Category의 합계 |
| --------------- | ---------- | ------------------- |
| Technology      | 453        | 4432                |
| Furniture       | 350        | 1781                |
| Office Supplies | 119        | 1079                |

- 오른쪽의 값은 실제로 `Category, Sub-Category`를 차원에 올린 다음 `평균(Sales)`를 했을 때 나오는 값들의 합계와 완전히 동일함

---

## Include로 만든 특성은, VLOD에서 만든 특성보다 깊을 수 밖에 없다
- **추가로 특성을 포함해서 계산**이 이뤄지기 때문임
- 따라서 **더 단순화된 레벨에서 값들을 표현하기 위해, 반드시 집계가 들어가야 함**

---

#### 평균으로 특성을 바꾸면, 값의 차이가 있다
- 계산 방식
1. `(카테고리, 평균(Sales))`
> 1. 카테고리별로 모든 Sales를 더한다
> 2. 매출의 합계를 카테고리의 행의 갯수로 나눠 단순 평균을 구한다.

2. `Include 특성 포함`
> 1. 카테고리 - 서브카테고리 별로 모든 평균을 구한다
> 2. 카테고리 레벨에서 평균을 다시 구한다
> - 즉, 평균의 평균을 구하게 되는 것임!

- **평균의 평균이 전체 평균과 같으려면, 1번째 평균으로 데이터들을 나눴을 때 그 샘플의 수가 모두 동일해야 한다. 그게 아니라면 평균의 평균은 일반적으로 다르다.**

---
## 연습
> 각 도시(City) 별 평균 매출을 기준으로, 최대 - 최소 차이가 5번째로 큰 주는 어디인가?

1. 도시별 평균 매출을 알아야 함
- `State`를 포함하고, `{INCLUDE [City] : AVG([Sales])}`

2. **주에 있는 도시끼리의 최댓값 - 최솟값** 계산을 어떻게 할까?가 포인트임
	- `집계(집계)`는 사용할 수가 없음
	- 여기서 막혀서 설명 듣겠음

### 해답
1. `State`와 `평균(Sales)`을 닮
2. 특성을 만듦
```tableau
{{ INCLUDE [Citys] : AVG([Sales])}}
```
3. 위에서 만든 특성을 그냥 넣으면 기본적으로 `합계`가 되는데, 이를 `최솟값`과 `최댓값`으로 1번씩 넣어 2개를 만든다. 
	- `CTRL + 드래그앤 드랍`으로도 가능함
4. **강사님의 테크닉**이기도 한데, 이런 걸 배워야 함
	1. 한 연속값을 다른 연속값의 축(이중축이 아님!)으로 드래그앤 드랍함. 그래프는 `원`으로 만듦
	2. 그러면 한 그래프에 최댓값과 최솟값이 다른 색으로 구분되어 나타나며, `측정값`으로 선반에 나타남
	3. `측정값`을 `ctrl + 드래그앤드랍`해서 복사한 다음, `마크 카드`에서 `라인`으로 바꾸고 `마크 카드`에 있는 `측정값 이름`을 `경로`로 드래그앤 드랍
	4. `3.`에서 만든 그래프를 `2`에서 만든 그래프와 `이중 축`으로 합침. 그러면 최댓값과 최솟값을 이은, 주마다 선으로 나타난 그래프를 얻을 수 있음
5. `4.`로 만든 그래프를 정렬해야 하는데, `최댓값 - 최솟값` 순서대로 정렬해야 하기 때문에 특성을 하나 더 새로 만듦
```tableau
(측정값에 있는 최댓값) - (측정값에 있는 최솟값)
```
6. 정렬 : `State 우클릭 - 정렬 - 정렬 기준 : 필드, 필드 명 : 5.에서 만든 필드, 내림차순` 

> 정리 : 
> 1. INCLUDE를 통해 더 깊은 레벨에서 계산이 이뤄졌음
> 2. 이렇게 얻은 특성을 더 얕은 레벨에 나타내면, 더 깊은 레벨에서의 값들을 1차적으로 집계함(집계된 값이지 개별 데이터에 접근할 수는 없음)
> 3. 1차적으로 집계된 값들을 **다시 집계하려면 이들을 그래프에 올린 뒤 `측정값`으로 나타나는 특성을 이용**하면 됨 : 5번 과정이 그것

어렵다!


---
## INCLUDE LOD는 언제 쓰나요?
- 쓸 상황이 많지는 않으나 **이런 상황은 고려해보자**

1. 데이터셋의 뎁스가 깊어야 함(2뎁스 이상)
2. 집계를 2번 이상 해야할 경우(평균의 최댓값, 최솟값의 평균, 평균의 평균 등)에 고려할 수 있다
3. 재집계를 할 때 `SUM`을 제외한 다른 집계값일 경우