

## 기억할 것
### docker compose 관련
- **프론트엔드, 백엔드의 변동 사항은 이미지 빌드부터 다시** 해야 한다.
	- **프론트엔드**에 변동 사항이 생기면, **`npm run build`부터 다시 하고 컨테이너**에 올려야 한다!
	- 백엔드는 **모델의 경우에만** 변동 사항이 생기면 **로컬에서 `python manage.py makemigrations`까지 진행**해야 한다.
- **데이터 백업** : [[MySQL - DB 이전하기#1단계 로컬 MySQL 데이터베이스 백업]] 참고

### 이외
- 구글 애널리틱스 나중에 서버 띄우면 URL 지정해야함!!
- 로컬에서 마이그레이션 할 때 케라스 어쩌고 하면 `tensorflow-intel==2.15.0`을 깐 다음에 마이그레이션을 실행하고, 다시 지우자!
	- 없으면 마이그레이션할 때 케라스 핑계를 댄다. 
	- 있은 채로 이미지에 올리면 해당 라이브러리를 못 찾는다는 오류가 발생한다.
## 할 수도 있고 안할 수도 있음
- `WritePost`
	- 글을 수정할 때, 기존에 작성된 글이 있는 상태에서 `ctrl + z`를 누르면 내용이 다 사라지는 이슈
	- 코드블럭이 2개 이상일 때 글 수정 시 1개로 합쳐지는 현상이 있음
- 별점 기능 추가하기
	- 방법 1) 별도의 테이블을 추가, 작품명, 별점, 이미지, 리뷰를 추가한다
	- 방법 2) QuillEditor에 별점을 등록할 수 있는 기능만 구현한다
- 이미지 회전 기능과 크기 조절 기능 통합하기
	- 현재는 회전을 하고 크기 조절을 하면 화면 밖으로 이미지가 나가는 현상이 있음
		- 근데 손이 많이 가는 작업이다. 회전 넣는 거만 해도 그냥 타입스크립트로 바꾸는 작업인데 하루 죙일 했음.
# 일지

- **할 일**
	- 지금 프론트엔드 - 백엔드 간의 연결에서 구현이 되지 않고 있는게
		1. 별도의 s3 스토리지 버킷을 사용하는 로직들
		2. 로그인 유지. 로그인 자체는 성공하지만, 로그인 상태를 유지하는 것에 실패합니다.

### 240506
- 일단 비용 관리 : 3$ 정도의 비용이 발생하고 있다.
	- [[AWS - 비용 관리]] 에 정리해둠.

- `s3 프론트엔드 버킷` -> `s3 스토리지 버킷`으로 접근하기
	- `s3` 스토리지가 퍼블릭 액세스 차단이면 `http://`로 그 값을 가져오는 건 불가능함
	- 그냥 **모든** 퍼블릭 액세스 차단이 문제였음. [[AWS - 프론트엔드에서 다른 s3 버킷 스토리지의 파일 가져오기]]


### 240505
- 오늘은 어린이날!!!!!! 와!!!!
- 일단 S3, EC2, RDS 연결까지는 성공
- **이런 문제들이 새로 발생하고 있다 슈박!!** 
	1. 프론트엔드가 `http`만 적용되는 문제 (보안 관련 이슈가 있어 보임)
	2. 음악, 이미지 등 별도의 s3 버킷으로 돌린 경우 로드 안됨
	3. 로그인 유지가 안됨 (로그인 하고 얼마 안돼서 바로 튕김)
	4. subsection style 적용 안됨(Redux 문제??)
- [[★) 무지성 WSL2 + Docker 재설치]]
- 일단 **프론트엔드에서 저장 버킷의 데이터들을 정상적으로 가져오도록** 해야 함. 
	- 스토리지 버킷 - 프론트엔드 간의 `CORS` 설정 필요
	- EC2 백엔드에 IAM 권한 추가 : `AmazonS3ReadOnlyAccess`이 들어 있음 -> 근데 상황이 나아지진 않았음
	- subsection style 못 가져오는 문제 수정 : `app.tsx`에 `backend`가 `localhost:8000`으로 설정돼있었다.

### 240503
- **데이터 수집 부분은 그냥 로컬로 진행하려 한다.**
> 1. VPC 내부에서 인터넷 게이트웨이를 뒀는데, 5분 로딩 이후 튕김. HTTPS 아웃바운드 규칙은 당연히 다 ON인 상황.
> 2. 찾아보니까 VPC 외부에 두는 방법도 있는데, RDS랑 ssm에 접근해야 해서 X
> 3. VPC 내부에서 프라이빗 서브넷과 NAT 게이트웨이를 두는 방법도 있다. 근데 NAT 게이트웨이는 비용이 나간다.
> 4. NAT 인스턴스를 쓰는 방법도 있는데, EC2에는 Django를 띄울 예정이다.
- 그래서 일단 로컬에서 작업한 내용인 `docker compose up`을 띄워본 다음, 해당 RDS로 데이터가 잘 전송되는지만 확인하면 될 것 같음!
- [[Docker 청소하기]]
- 하나를 넘으니까 또 하나가 안되죠? 후..
	- [[AWS - Lambda 함수 시행착오]]
	- [[AWS - 네트워크 대충 알기]]
	- NAT 인스턴스 시도하기
		- 얘도 EC2를 써야 하는데..
### 240502
- [[AWS - RDS(MySQL) 설정하기]] : 작업 완료
> 	작업은 아래처럼 가져갔다.
> 	0. `RDS 콘솔`에서 `수정 - 퍼블릭 액세스 가능`으로 변경
> 	1. `mysql -h [RDS엔드포인트] -u [RDS마스터이름] -p`로 RDS의 mysql에 접근
> 	2. `CREATE DATABASE blog`, `CREATE DATABASE steam`으로 2개의 DB를 생성
> 	3. `exit`로 나온 다음, `mysql -h [RDS엔드포인트] -u [RDS마스터이름] -p [db이름] < [db백업파일.sql]`로 백업 파일을 데이터베이스에 등록
> 	4. `RDS 콘솔 - 데이터베이스 - 수정 - 퍼블릭 액세스 불가능`으로 다시 변경
- [[AWS - Lambda 함수 띄우기]]
	- [[AWS - Systems Manager Parameter Store로 환경 변수 세팅하기]]

- 저 Lambda 함수에서 계속 무한 로딩이 걸린다.
	1. 엔드포인트의 필요성
		- `Lambda` 함수에서 `ssm`에 저장한 환경 변수를 가져와야 함
		- 그러려면 AWS 서비스에 액세스를 해야 함
		- 일반적으로 VPC 내의 리소스가 AWS 서비스에 액세스하려면 인터넷 게이트웨이 or NAT 게이트웨이로 퍼블릭 인터넷을 거쳐야 함
		- 그런데 **VPC 엔드포인트**를 사용하면 AWS 네트워크 내에서 AWS 서비스에 연결할 수 있음
			- `게이트웨이 엔드포인트` : S3, DynamoDB 등
			- `인터페이스 엔드포인트` : 대부분의 AWS 서비스에 대한 액세스를 제공함. 고유의 프라이빗 IP 주소를 가짐.
	2. 엔드포인트 설정
		1. `서비스 이름` : `com.amazonaws.ap-northeast-2.ssm`
		2. VPC, 퍼블릭 서브넷(람다의 설정과 동일)
		3. 엔드 포인트 정책 : `전체 액세스`
	



### 240501
- 클라우드에 프로젝트 띄우기 진행 중
	- [[AWS - EC2에 Django 배포하기]] : Putty를 통해 우분투 쉘로 접근하는 것까지 성공
	- 백엔드부터 띄우려고 하니까 또 생각해볼 게 다른 인스턴스들과의 연결이다
	- [[AWS - S3 + Cloudfront 프론트엔드 설정하기]] : 서버 뜨는 것까지 확인 완료
		- 주소(임시) : `http://htlee-frontend.s3-website.ap-northeast-2.amazonaws.com/`
	- [[AWS - RDS(MySQL) 설정하기]]
		- 설정 중 인스턴스를 띄우고, 로컬에서 `mysql` 명령어로 접근하는 도중, `HY000`에러가 발생했다. 여기서 막힘.
