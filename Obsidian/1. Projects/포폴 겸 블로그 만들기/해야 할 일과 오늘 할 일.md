
## 해야 할 일

- 이미지 & 동영상 크기 수정 기능 넣기
- `Subsection` 글씨 커스터마이징 기능 구현(아마 페이지로 해야 할 듯)
- ☆최종☆ 포트폴리오 작성하기(프로젝트들 나열하기)

- 진행중인 듯
	- DeletePost 구현
	- ★비상★ - QuillEditor가 페이지(CreatePost, EditPost)에서 정상적으로 렌더링되지 않음
		- `highlight.js` 관련 처리 사항으로, 일단 뒤로 미룸.

- 레이아웃 관련
	- 아카이브는 그냥 category의 메인 페이지에만 두면 되지 않을까? 굳이 글 보는데 필요함?
	- 글의 왼쪽에는 서브섹션에 따라 글을 볼 수 있게 하고, 오른쪽에는 마크다운 섹션 같은 기능을 넣으면 될 듯 

## 오늘 한 일

### 240113

#### 세부 내용
- 토큰 저장 위치 변경
	- 액세스 토큰 : 로컬 스토리지 -> 메모리 or 세션 스토리지(휘발성)
	- 리프레시 토큰 : HttpOnly 쿠키 (XSS 공격으로부터 보호가 목적, 100% 보호는 불가능)
	- 이거 너무 복잡해진다. 일단 오늘 변경사항 이전으로 돌리고 DeletePost만 구현하겠음;
- DeletePost 구현 완료(인증까지)
### 240112
- **`EditPost` 구현 완료**
- **토큰 재발급 구현 완료**
- **405 에러 해결 완료**
#### 세부 내용
- 액세스 토큰 만료 후에도 정상적으로 리프레시 토큰을 이용해 액세스 토큰을 재발급받지 못하는 문제 해결 필요
	- 현재 이거 처리 중. 백엔드의 `TokenRefreshView`에서 보내는 Response를 이상하게 처리했을 가능성이 높음. -> 왜인지 모르겠는데 해결됨;
- `CreatePost`에서 `405` 에러가 갑자기 발생한다. 
```python
	re_path(r'^post/(?P<slug>[\w-]+)$', PostDetailView.as_view(), name='PostDetail'),
    re_path(r'^post/create$', PostCreateView.as_view(), name='PostCreate'),
```
> - `urls.py`가 이렇게 정의되어 있었는데, 이 경우 `PostCreate`에 대한 요청을 보냄에도 `create`라는 단어를 슬러그로 봤기 때문에 해당 에러가 발생한 것이다.
> - 따라서 `post/create`를 `post/slug`보다 위로 올려야 함.
> 추후에 다른 종류의 충돌이 발생할 수도 있으므로, `detail`을 아예 따로 추가해뒀다.
```python
    re_path(r'^post/create$', PostCreateView.as_view(), name='PostCreate'),
    re_path(r'^post/detail/(?P<slug>[\w-]+)$', PostDetailView.as_view(), name='PostDetail'),
```
> - 이거 안 번뜩였으면 ㄹㅇ 해결 못했겠는데 ㅋㅋㅋㅋㅋㅋㅋ

- `EditPost.tsx`
	- 제목을 수정할 경우, 프론트엔드와 백엔드 모두에서 슬러그를 수정해야 할 것이다.
	- 기존엔 `PostSerilalizer`로 구현하고 그 안에 `create`와 `update`로 분리해서 관리했는데, 양쪽에 필수적인 필드가 다르기도 하고 해서 **Serializer 자체를 분리하기로 했다.**

### 240111
- 일단 렌더링 기능 자체의 문제는 `highlight.js`을 적용하는 것과 관련있어 보임. `onChange`가 문제인가? 싶었는데, 다르게 추적해보니 `syntax` 부분을 주석처리하면 정상적으로 작동하는 것을 확인할 수 있었음
	- **이 부분 수정이 생각보다 어려워서 다시 뒤져보는 중...**

- EditPost 구현
	- (완료)PostDetail, EditPost 백엔드 URL 수정 중


### 240110
- EditPost
	- setContent로 불러온 내용이 QuillEditor에 전달되지 않는지, QuillEditor의 렌더링 자체가 되지 않는 현상이 있다. 수정 방법을 알아보는 중.
	- (완료) `subsections` 또한 `createpost`와는 약간 다르게 지정해야 한다. 이미 있는 걸 가져오는 거니까 선택 박스를 디폴트로 놓아야 함 
	- 직접 입력 / 있는 것 중 선택 버튼을 글씨 대신 아이콘을 넣어 통합하자
	- ☆글 내용이 바뀔 때마다 **`setContent` 등 useState를 사용하는 경우, `QuillEditor`가 아니라 상위 컴포넌트로 뺀다.** (`CreatePost, EditPost` 등) <-- 이거 해결 안돼서 골머리앓는 중


### 240109
- 로그인한 상태에서만 작동 가능하게 하기 
	- ★`MyUser`의 `__str__` 부분이 닉네임임 (일반적으로 아이디를 의미하는 `username`이 아님)
	- `PostList` - 글쓰기
	- `CreatePost` - 링크를 별개로 타고 들어가는 경우, 로그인하고 들어간 뒤 로그아웃하는 경우
	- `PostDetail` - 수정, 삭제 버튼 활성화(이건 그 게시글을 작성한 사람만 보이게)
- 로그인 시 발급받는 JWT 토큰에는 유효 시간이 있다. 이 시간이 지나면 백엔드에 로그인한 상태로 요청을 보내더라도 권한이 없다는 오류가 뜸. 기존엔 설정안했더니 터무니없이 짧았음;
	- `django`의 `settings.py`에서 `SIMPLE_JWT` 항목에서 발급하는 토큰의 유효 시간을 설정해줄 수 있다. **근데 6시간으로 적용했는데 계속 5분으로 나옴. 뭐지????** 
	- 해결 : [[복합 - 로그인(인증)이 필요한 기능 구현하기]] 참조. 
		- 전체 과정을 질문하고, **리프레쉬 토큰**이라는 것을 배우고 적용해서 알았다.
- `utils/getAccessToken.tsx` 구현
	- 액세스 토큰의 유효 시간이 지나면 갱신해줘야 하므로, 해당 로직도 구현해줘야 한다. -> **프론트엔드에서 리프레쉬 토큰을 백엔드로 전달하고, 백엔드에선 뷰를 따로 구현하지 않고 불러오기만 해서 연결**해주면 됨.
	- 해당 컴포넌트는 유효 시간이 지나지 않았다면 그대로 로컬 스토리지의 값을 이용하고, 지났다면 백엔드에서 다시 받아온다. `async` 함수이므로 받아온 값을 이용하려면 함수 앞에 `await`를 붙여준다.

### 240108
- NavBar - Login 위치 변경
- Index.css - form-input에 자주 쓰는 css 통합
- SignIn.tsx - 로그인 구현
	- 로그인 상태 관리 작업 -> Redux 사용 시작
	- **그럼 로그아웃도 만들어야겠네?** -> Json Web Token(JWT)을 이용할 경우, 백엔드에 로그아웃 로직은 구현하지 않아도 된다. 프론트엔드에서 토큰만 제거하면 됨
		- 만약 세션을 추적해서 사용자의 패턴을 분석하고 싶다면 JWT 대신 다른 방법을 써야 한다.
		- 근데 내 블로그의 경우는 나중에 구글 애널리틱스를 달 걸 생각했을 때, 구글 애널리틱스는 로그인과는 별개로 작동하기 때문에 JWT로 구현해도 괜찮을 것 같다.
- 로그인 상태 관리) 새로고침 시 로그인 정보가 날아가는 거 수정(App.tsx 및 로그인 기능에 구현)
- SignUp
	- `onMouseUp` 부분 제거 및 `useEffect`에서 `window.addEventListener('mouseup', handleMouseUp);`을 이용하기로 함
	- `onMouseDown, onMouseUp`으로 비밀번호 보이기 on/off 를 구현하면, 클릭한 채로 `input` 태그 밖으로 커서를 빼면 비밀번호가 보이는 상태를 유지하게 되기 때문
	- 따라서 이를 처리하기 위해 페이지 전역에서 상태를 관리한다.

### 240106
- SignUp
	- 이메일 인증 기능
		- 프론트엔드에서 유효성(형식) 검사 -> 백엔드에서 중복 검사
		- 통과 시 해당 메일로 6자리 숫자 코드를 보내고, 백엔드의 인증 테이블에 이메일과 코드, 생성 시간을 저장
		- 프론트엔드는 인증 버튼 클릭시, 새로운 `input`이 나타나서 인증 코드 6자리를 입력함
		- 다시 백엔드에서는 인증 코드 6자리가 테이블에 있는 이메일, 코드 및 5분 이내의 시간과 일치하는 지 확인
			- 5분이 지난 경우, 자동으로 청소하도록 `django-background-tasks`을 설치 및 `tasks.py`에 구현... 하려고 했는데 그냥 인증 요청이 들어올 때마다 정리하는 걸로.
		- 모두 통과시 submit 버튼 활성화 조건 중 하나 만족
	- 닉네임 어떻게 처리할까? - 걍 2~6자 / 필수 입력 / 유니코드 문자, 숫자 가능하게 함
	- **SignUp이 이렇게 오래 걸릴줄은 몰랐네요;** 오늘 잠깐 할 생각이었는데 벌써 7일 새벽2시임

### 240105
- SignUp.tsx 
	- 1월 4일 - `input` 태그가 `focus`이면서 `valid`일 때 `style`이 바뀌어야 하는데 안바뀌는 이슈 해결해야 함
	- `border`가 있고, `outline`이 있음. [[tailwind CSS - border와 outline]] 참고
	- id 유효성 & 중복 점검 및 그에 따른 스타일 변경 : 언제 초록색과 빨간색으로 바꿀까?
		- 그냥 `idAvailable` 변수를 정수로 다루자
			- `0` : 유효성 통과 X
			- `1` : 유효성 통과 O / 중복 통과 X
			- `2` : 유효성, 중복 통과 
- 백엔드 
	- 백엔드에서 관리하는 `id`와, 사용자가 직접 입력하는 `username` 항목을 분리함
	- `SubsectionSerializer`를 분리했음 - `create`의 경우, 프론트엔드에서 소분류를 만들 때 에러가 발생했는데 필드 이름을 `name`으로 안하고 `subsection`으로 해서 발생한 문제


### 240104
- SignUp.tsx
	- 실시간 피드백 구현하는 중


### 240103
- App.tsx의 라우터 구조 변경
	- Navbar.tsx가 모든 경로(로그인 , 회원 가입, NotFound)에도 적용되게 변경
- 로그인 기능 구현 시작
	- 백엔드에 user 관련 앱 만듦
	- 프론트엔드에도 로그인 페이지 만듦

### 240102

- 게시글 조회 : id -> slug로 변경하기
	- **특수문자만으로 제목을 만든다면, 슬러그로 표시되는 건 아무 것도 없다.** `???`로 제목을 작성한 글 링크가 타지지 않는 걸 보고 알았네 ㅋㅋㅋ
	- 수정) 슬러그의 중첩을 방지하고자, 제목을 슬러그화했을 때 겹치는 슬러그가 있다면 뒤에 `-번호`를 붙임 - 슬러그는 링크에 쓰이기 때문에 `unique`해야 한다.
- `try - error` 부분들 - 에러 발생 시 `catch (e)`로 잡았다면, `e.message`를 해야 표시된다.
  - 내용을 HTML로 잡기 때문에 빈 공간임에도 p태그가 존재해서 글이 생성되는 경우가 있었음. 수정.

### 240101
- PostList(수정 완료)
	- 미리보기 기능이 제대로 적용되지 않는 현상이 있음 : 백엔드에 저장된 HTML 태그를 파싱하는 과정에서 일어나는 문제
	- **텍스트를 가공하는 기능을 백엔드에 구현함** : 그 중에서도 `PostList`에만 사용할 것이기 때문에 `views.py`에 구현함. 이외에도 `serializers.py`에 구현하는 옵션도 있다.

### 231230
- WritePost
	- Content가 담기지 않는 문제가 있다. -> 수정 완료 : `submit` 버튼을 누를 때에만 `content`가 갱신된다.

### 231229
#### highlight.js 적용하기 
- 가장 큰 이슈는 `onChange`를 구현하면 `modules.syntax`에 highlight 를 구현했을 때와 충돌이 발생한다는 것이었다. (뭐라도 하나 쓰면 바로 컴포넌트가 날아가는 이슈.)
- 따라서 일단 onChange를 제외하기로 했음.
- 무슨 마크다운 문법을 HTML에 적용하고 별 생쇼를 다하다가 결국 돌아온 곳이 이거다.. ㅠㅠ 하루 종일 했는데..

### 231228
- PostDetail
	- 게시글로 돌아가기 버튼 구현
	- Quill 본문은 그냥 TextArea가 차지하는 크기만큼을 차지하게 하기로 했다. 대신 패딩을 집어넣자.
- Navbar
	- 각 아이콘은 각 category의 홈으로 가는 링크여야 하는데, Intro로 돌아가게 구성되었음. 이를 수정.
- QuillEditor
	- 글자에 색 배경, 색 적용 안되는 문제 수정 - formats만 수정하면 되는 ez한 문제였음


### 231227
- QuillEditor에는 읽기 전용 모드가 있다 -> 이걸 이용하면 `PostDetail`을 어떻게 보여줄까 하는 고민이 해결됨
	- 이를 위해 QuillEditor에 `isReadOnly`라는 인자를 받도록 하고, return 값에 `readonly = {isReadOnly}`를 추가한다.
	- isReadOnly 값에 따라 툴바가 나타나거나 나타나지 않도록 한다.
	- 아무런 글을 입력하지 않더라도, 초기 영역이 어느 정도의 공간을 차지하게끔 구성해야 함
### 231226
- PostList 수정
	- 미리보기 표시 : 백엔드에서 HTML 태그를 포함해 150글자까지 가져오고, 이 중 p태그로 완전히 열고 닫히는 모든 내용을 표시한다. 단 p 태그 내부의 HTML 태그는 별도로 표시하지 않는다.
	- [테일윈드 예시](https://freefrontend.com/tailwind-code-examples/)에 PostList에 적용할 만한 괜찮은 예시가 있어서 PostList에 적용했다. 별도로 구성해야 할 것도 있어서, 화면의 가운데 쪽에만 수정해서 구현.
- NavBar 통합
	- 기존엔 NavBar의 Category 전환 버튼을 클릭하면 기존에 렌더링 됐던 요소들이 다 사라졌다. 이는 `Link`로 연결되어 있어서 바로 해당 url로 넘어갔기 때문이다.
	- 이게 마음에 들지 않아서 NavBar만을 전환할 수 있지 않을까라고 생각해서 구현 완료
	- NavBar를 통합했다. 최초엔 useParams을 이용해 URL에서 값을 가져오지만 그 이후에는 useState를 통해 상태를 관리하는 식으로 작업했음. 굳이 NavBar를 나누지 않아도 될 듯.

### 231225
- PostDetail 수정
	- `ma`에서 정상적으로 글 등록되지 않는 현상 수정 - 백엔드에서 ma를 movieanimation으로 바꾸는 과정을 전부 제거했고, 해당 category를 `ma`로 수정했다.

- PostList 수정
	- HTML 태그가 Content 미리보기에서 보이는 현상 수정 중
```tsx
        const textContent = new DOMParser().parseFromString(content, 'text/html').body.textContent.replace(/<[^>]+>/g, '') || "";
```
> `~textContent`까지는 특수문자를 없애고, `replace()` 부분은 HTML 태그를 없앤다.
	- 그러나 이런 식의 미리보기가 맞는지 모르겠음 : 차라리 1번째 p태그를 가져오는 게 나을지도?

### 231223
- (완료) 글 업로드 구현 중
	- (완료) `PostSerializer`을 통합하려는 시도 중 : 겹치는 코드가 많아서
	- 마참내 ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ

### 231222

- 글 업로드 구현 중
	1. subSection을 직접 입력하는 상황이라면 subSection부터 등록하게끔 구현(중)
	2. subSection의 중복 체크 & 글 업로드 기능 구현
> 글 업로드 과정에서 계속 이슈 발생) 아마 백엔드의 테이블과 매칭하는 과정에서 계속 이슈가 나는 듯?

### 231221
- 이미지 업로드 구현 완료 : 백엔드에 등록하고, 해당 링크를 HTML 태그와 함께 가져오는 방식

### 231220
1. 글 작성 페이지 : `subsection` 상태 초기화 안되는 문제 해결


### 231219
- Quill을 이용해 글을 작성하고, 이미지까지 저장하기
	- Quill : 글 작성, 폰트 지정, 색깔 설정, 볼드, 이탤릭 등등 다 기본 기능에 있긴 하다. 공식 문서의 `Toolbar`에 있음.
	- `Code-Block`도 있는데, 언어에 따라 지정하는 `highlight.js`를 따로 설치해준 뒤, 설정해야 하는 듯? <-- 에서 막힘

### 231218

1. 제목, 소분류 입력란 가로 너비 : 상위 `flex`, 하위 `w-full`
2. 소분류 불러오기 / 소분류를 직접 입력하거나, 있는 것 중에 선택하기
	- **RESTful API 디자인의 원칙 중 하나인 "Single Responsibility Principle"** : 하나의 엔드포인트는 1개의 기능만을 갖는다 - 즉, 게시글을 불러오는 요소에 카테고리나 서브카테고리를 불러오는 기능이 있더라도, 프론트엔드에서 이 기능을 가져올 때는 해당 기능만을 제공하는 URL에 접근하는 게 맞다는 것이다.


### 231215

-  ~~글쓰기 버튼 추가~~