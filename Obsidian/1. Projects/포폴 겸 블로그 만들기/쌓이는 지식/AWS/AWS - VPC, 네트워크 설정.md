
- 로컬에서는 `docker-compose.yml` 파일에 각각의 프로젝트에 대한 설정과 네트워크 연결을 넣고, docker compose 명령어로 한꺼번에 띄우는 방법을 택했다.
- 그런데 **클라우드에서는 인스턴스들을 분리**하잖아? 그러면 기존의 docker-compose 같은 방식을 사용하기는 힘들 것이다.

- 이를 위해 있는게 `VPC Virtual Private Cloud`이다.
	- AWS에서 제공하는 가상 네트워크 환경으로, 클라우드 내에서 격리된 네트워크를 생성한 뒤 서브넷, IP 주소 범위, 라우팅 테이블, 보안 그룹 등을 설정할 수 있다.
	- 모든 서비스가 공통으로 사용할 VPC를 생성해놓는 것이다.

### 서브넷, 라우팅 테이블
- **서브넷**
	- VPC 내부의 IP 주소 범위를 나눠 논리적 네트워크 세그먼트를 구성한다.
	- 즉, **각 서브넷은 VPC의 IP 주소 범위 중 일부**를 차지한다.
	- 각 서브넷은 공개나 프라이빗으로 지정할 수 있다.
		- 공개 : 리소스가 인터넷 게이트웨이를 통해 인터넷에 접근할 수 있다.
		- 프라이빗 : 리소스가 인터넷 게이트웨이를 통해 인터넷에 직접 접근할 수 없다.
- **라우팅 테이블**
	- 네트워크 **트래픽이 대상으로 향하는 경로**를 결정한다
	- 각 라우팅 테이블에는 대상 CIDR 블록과 타깃(인터넷, NAT 게이트웨이) 등으로 구성된 경로 항목이 있다. 
	- **서브넷은 특정 라우팅 테이블과 연결되어 있다.**
		- 공개 서브넷의 라우팅 테이블 : `0.0.0.0/0` 대상의 경로 항목이 인터넷 게이트웨이를 가리킨다.
		- 프라이빗 서브넷의 라우팅 테이블 : `0.0.0.0/0` 대상의 경로 항목이 NAT 게이트웨이 등을 가리킨다.
	- **라우팅 테이블은 서브넷의 트래픽 흐름을 제어**한다.
		- 프라이빗 서브넷의 앱 서버는 NAT 게이트웨이를 통해 인터넷으로 `아웃바운드 요청`은 보낼 수 있어도, 인터넷에 직접 액세스할 수는 없다.
- 서브넷과 라우팅 테이블의 적절한 구성은 네트워크 리소스 격리, 보안 강화 등에 도움이 된다.
- **공개 서브넷에는 외부 노출 리소스를, 프라이빗 서브넷은 내부 리소스를 배치**한다.


> 서브넷에서 공개/프라이빗을 결정하는 게 아니라, **서브넷과 연결되는 라우팅 테이블이 공개/프라이빗을 결정**한다.


#### 이해하기 쉽게 docker compose의 network와 비교
- Docker Compose의 네트워크로 여러 컨테이너를 연결할 수 있었다. 그리고 이 네트워크 안에서 여러 컨테이너 간의 통신이 가능했다.
- 하지만 Docker Compose는 기본적으로 단일 호스트에서 작동했다.
- 한편, AWS 서브넷은 VPC 내에서 여러 AWS 리소스 간의 상호 작용과 통신을 가능하게 해주는 개념이다. 더 쉽게 말하면 **여러 인스턴스(기기) 간의 상호 작용을 가능**하게 만드는 개념인 것.

### 내 프로젝트에 적용하기
- 프론트엔드 `AWS S3` 
	- 완전 관리형 스토리지형 서비스 개념에 가까워서 별도의 서브넷이 필요하지 않음
	- S3 버킷에 React 앱을 빌드하고 업로드함
	- CloudFront에 S3 버킷을 웹 배포, 백엔드 EC2와 통신할 수 있도록 구성
- 백엔드 `AWS EC2` 
	- **프라이빗 서브넷**에 EC2 인스턴스를 배치함
	- 보안 그룹을 구성해 CloudFront와의 통신을 허용
	- NAT 게이트웨이나 NAT 인스턴스로 아운바운드 인터넷 액세스를 제공한다
- DB
	- **프라이빗 서브넷**에 MySQL 인스턴스 2개를 생성
	- 백엔드와 같은 서브넷에 있어도 되고 별도로 있어도 됨
	- 보안 그룹을 구성, 백엔드 EC2 인스턴스와의 통신을 허용함
- 데이터 수집기
	- **프라이빗 서브넷**에 배치
	- 얘는 근데 AWS LAMBDA를 쓸 수도 있음

### CloudFront
- AWS 콘텐츠 전송 네트워크 서비스 : S3 호스팅 정적 웹앱을 전세계 엣지 로케이션에서 빠르게 제공할 수 있다.
- 그래서 React는 VPC 대신, CloudFront + S3 조합으로 호스팅을 한다.

### 아웃바운드 통신
- 프라이빗 서브넷의 리소스(앱 / 웹 서버, DB 등)는 직접 인터넷에 액세스할 수 없다.
- 하지만 **보안 업데이트, 소프트웨어 설치 등 인터넷의 아운바운드(=외부로 나가는) 통신이 필요**할 수 있다.
- `NAT : Network Address Translation` 서비스로 이러한 아웃바운드 인터넷 통신을 제공할 수 있다.
	- 프라이빗 IP 주소를 임시 공개 IP 주소로 변환, 인터넷 요청을 전달한다.

