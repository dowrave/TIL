- Route 53에 도메인을 할당한 후, `$0.40 per 1,000,000 queries for the first 1 Billion queries 71,456 Queries USD 0.0` 명목으로 비용이 증가하는 게 있어서, 무엇을 의미하는 지 궁금해서 찾아봄


## Route 53의 쿼리
- **도메인 이름을 IP 주소로 변환하는 `DNS(Domain Name System)` 조회 요청**
	- 사용자가 도메인 이름을 입력하면
	- DNS 서버는 도메인 이름에 매핑된 IP 주소를 반환한다
	- 사용자는 반환된 IP 주소로 인스턴스에 접속, 데이터를 주고 받는다.

- 사용자가 웹에 접속할 때마다 DNS 조회가 발생하므로, 트래픽이 많을수록 쿼리 수는 증가한다.
- **DNS 조회는 데이터를 가져오는 게 아니라** 데이터를 주고 받기 위해 도메인 주소와 IP 주소를 매핑하는, 데이터 교환의 첫 단계라고 볼 수 있다.

- 주의)
	- 서버 내에서의 도메인 통신이더라도, DNS 쿼리가 발생할 수 있다
	- 도메인을 쓴다면 IP주소랑 매핑해야 되니까! DNS 쿼리가 발생한다는 의미!

### 쿼리 수 줄이기
- `Route 53` 콘솔에서 TTL 값을 늘리는 방법
	- TTL이란, **DNS 응답 결과가 캐시에 유지되는 시간**을 의미한다. TTL이 높을수록 동일한 도메인에 대한 반복적인 DNS 조회 요청이 감소한다.

- TTL이 너무 높다면?
- DNS에 있는 값의 변경 사항이 반영되는 데 시간이 너무 오래 걸릴 수 있다.
	- 예를 들면 도메인이 매핑하는 IP 주소가 변경된 경우, TTL이 너무 길다면 연결이 반영되지 않음
- 클라이언트가 특정 서버에 계속 연결되는 경향이 증가, 로드 밸런싱의 효과가 감소할 수 있다.

### 새로고침과 쿼리 수의 관계
- **브라우저의 DNS 캐싱 동작**에 따라 새로고침 시 쿼리 수가 증가할 수도, 유지될 수도 있다.
- 브라우저는 **1번 가져온 DNS 레코드를 일정 시간 캐시에 저장했다가 같은 도메인에 대한 요청 발생 시 캐시에서 IP 주소를 가져와 사용**한다. 이 때, DNS 서버로 새로운 쿼리를 보내지 않기 때문에 쿼리 수가 증가하지 않는다.

- 이런 경우에는 새로고침 시 DNS 쿼리가 발생한다
	- 브라우저 캐시에 해당 도메인의 DNS 레코드가 없다
	- DNS 레코드의 TTL이 만료되었다
	- 강력 새로고침을 수행한 경우(Ctrl F5 / Shift F5)

# 그런데
- 위 설명대로면 DNS 쿼리가 7만개 가까이 발생하는 건 비정상적인 동작 아닌가?
	- 같은 도메인에 대한 다른 요청(즉 어떤 블로그의 글 1 -> 글 2로 옮기는 행위)는 DNS 쿼리를 증가시키지 않는다 (TTL이 만료되지 않은 한)

- 흠...