### 240530
- 스포일러 경고 커스텀 블랏을 넣은 뒤 수정하는 과정에서 예상치 못한 동작이 자꾸 일어남
	- 그래서 이참에 Quill에 어울리는 저장 방식인 json이나 delta를 사용해보려 한다.
	- 근데 delta로 구현해도 **스포일러 경고 커스텀 블랏에서 발생하는 문제점이 완전히 동일**함
	- 또 기존에 구현한 로직이 다 HTML 구현에 초점이 맞춰져 있어서(코드 하이라이트 등) 그냥 Delta를 버리고 HTML을 써도 될 것 같다.

- 한 8시간 붙잡았는데, 모르겠다! 정보도 많이 없고. **그냥 format이랑 constructor 다 떼버리고 수정할 때마다 스포일러 경고 버튼 따박따박 넣자.**
	- 의도적으로 인식 못하게 `formats` 메서드의 className 부분에 절대로 사용하지 않을 것 같은 className만 커스텀 블랏으로 인식되도록 설정했다. `vioadvnisvndliajsnlns`
	- 인식하면 가장 마지막 부분이 오히려 이상해짐
	- 근데 이럴 거면 Quill을 쓰는 게 맞냐라는 생각이 든다. 마크다운 쓸걸 그냥.................. 너무 멀리 온 것 같아...

### 240528
- 일지를 오랫동안 안 썼다.
#### 로드밸런서 제거하기
- 로드밸런서를 제거하는 작업을 하려고 함
	- 하루에 0.24$ 씩 고정 지출이 발생하는데, 대략 **1개월에 만원** 정도 나간다.
	- **로드밸런서를 사용할 정도로 높은 트래픽이 예상되지 않기 때문에 일단은 제거해서 비용 지출을 줄이려 함**
- 기존 설정
	- 로드밸런서(`api.htlee-blog.com`)에서 EC2 인스턴스의 80포트로만 접근 중 (443으로 오는 접근도 다 80포트로 바꿔줌)
	- `NGINX`에서도 80포트만 열려 있는 상태
	- 클라우드프론트에서 연결된 오리진은 로드밸런서로 되어 있음.
- 그러면 수정은 어떻게 해야 하는가
	- EC2 인스턴스 보안 그룹의 인바운드 규칙을 클라우드프론트로 변경
	- 클라우드프론트 - ec2 간의 오리진 프로토콜이 HTTP면 443포트를 열지 않아도 됨
	- `api.htlee-blog.com`의 로드밸런서에 대한 dns 레코드를 EC2로 변경
```
- EC2의 인바운드 규칙으로 80포트를 열어둔다
- 위 설정은 클라우드프론트의 '오리진 프로토콜'에 적용된다. 클라우드프론트 - 동작 - '뷰어 프로토콜'은 별도의 과정이다.

뷰어 프로토콜은 최종 사용자 - 클라우드프론트 간의 통신 프로토콜
```
- 최종 설정 정리
	- 클라우드프론트에 할당된 로드밸런서 제거, EC2 탭의 로드밸런서 설정도 제거
	- 클라우드프론트에서 `원본 도메인` 을 **EC2 인스턴스의 DNS값**으로 설정, `80`포트로 통신
		- `443` 포트를 쓰고 싶다면 SSL 인증서를 받아놔야 하는데, 해당 설정을 했는데도 502 에러가 발생. 일단은 클라우드프론트 내부에서의 통신이므로 `80`도 안전하지 않을까라는 생각으로 뒀다. 
		- 해당 원본에 대한 동작은 기존과 동일하게 `/api/*`로 지정, 여기는 수정할 거 없음
	- Route 53에 있던 `api.htlee-blog.com` 제거 
		- Route 53 설정에서 프라이빗 IP 주소를 할당하라는데, 다 없애버려서 아무래도 상관없게 되어버렸다.
	- EC2 인스턴스 : 인바운드 보안 그룹으로 클라우드프론트에 대한 80포트 추가
- 모니터링
	- **하루에 0.24$ 씩 발생하던 VPC 내역이 계속 발생하는지 체크**할 것



### 240522
- 레이아웃 형식 수정 
	- 크기에 따라 서식이 달라지게 하려고 했는데, 그냥 아래의 형식으로 통일하기로 했다. 
	- 섹션/서브섹션의 글 길이에 따라 제목 시작 위치가 달라지지도 않고
	- 일관성 측면에서 더 나은 것 같음
```
섹션(서브섹션)                                                                  날짜
글 제목
```




### 240521
- 레이아웃에 따른 형식 수정 중 - 특히 모바일 환경
	- `PostList` : 모바일환경에서 `content` 노출 x
	- [React + Vite + TS에서 svg 파일 컴포넌트로 사용하기](https://breathof.tistory.com/311) 

### 240520 - 마무리 시작
- 더 할 게 생각나지도 않고, 발견한 문제점들을 수정해나가는 **마무리 작업**으로 들어가겠음
1. 이미지 관련 기능 수정하기(완)
	- 여러 이미지 한꺼번에 업로드 구현하기 
	- 이미지 업로드 시 커서 위치 조정
	- PNG 파일도 업로드 가능하게 수정
	- 이미지 압축은 프론트엔드에서 수행됨


### 240517
- 클라우드프론트 -> 로드밸런서 를 설정을 못해서(답도 안보이고) 그냥 아래처럼 구현하겠음.
- **로드밸런서가 모든 포트에 열려 있음***(보안상 당연히 권장되는 상황은 아님)
	- 대신, 프론트엔드와 백엔드 어드민 **로그인 시 3회 틀리면 하루 동안 로그인 밴**임
	- 백엔드는 아직 구현 못함
- 자기 전에 re:Post에 글을 올리고 잤었는데 이번에도 같은 형님이 답변을 주셨다 [요거](https://repost.aws/questions/QUa5djaU2wT3ixpL2BZUysHg#ANH6OCZ98pQDGFioq1Emye8w)
	- 502에러가 발생하는 이유는, 로드밸런서에 할당된 SSL 인증서와 도메인의 이름이 일치하지 않았기 때문임 **클라우드프론트에는 로드밸런서의 오리진 도메인으로, SSL 인증서에 할당받은 도메인 이름을 지정해야 함** 
	- 즉 로드밸런서의 DNS 대신 **`api.htlee-blog.com`을 로드밸런서의 오리진 도메인으로 지정하라는 뜻**이다

### 240516
- EC2 컨테이너에서 `steamspypi`에 요청을 보내면 오류 발생
	- 컨테이너 내부에서 `curl`로 해당 페이지에 요청을 보내니까 정신없는 답변이 오는데, CloudFlare에서 요청을 차단시켰을 가능성이 있다고 한다.
	- **`steamspypi`의 `download.py`에 헤더 정보를 추가한 뒤 테스트 -> 잘 되는 듯**
		- 결국 `requests` 라이브러리를 쓰는 건 똑같아서 거기에 헤더 정보만 넣고 Dockerfile에 라이브러리 설치 후 헤더 정보를 수정한 `download.py`를 넣어줬음
- 갑자기 EC2가 먹통임 
	- [[AWS - 접근 권한 관련]]에 정리 중
	- 대충 살펴보니까 **스토리지 버킷의 접근 권한, 로드 밸런서의 인바운드 설정** 이 컨텐츠 열람 가능 여부에 영향을 주고 있음
	- 모바일에서 블로그에 접속했을 때 작동이 이상했던 것도 이런 거였네
	- **근데 모르겠다!!!** 하루종일 해도 모르겠다!
- 로그인 3회 이상 오류 시 접근 제한 기능이나 설정해두자
	- 일단 구현 해둠 : 프론트엔드에서 로그인 3회 이상 오류 시 하루 밴 
	- 나는 RDS에 접근해서 `authuser_loginattempt` 테이블의 데이터를 삭제하면 됨



### 240515
- `mp3` 파일 업로드 후, 플레이리스트 / 세그먼트 파일을 정상적으로 못 만드는 문제 수정 중
	- `s3` 버킷에 저장은 잘 하는데, 다시 가져올 때 Access Denied가 뜬다. print() 문을 넣어서 경로 지정하고, 해당 URL을 가져와서 실행해보면 그건 또 잘된다.
	- 즉 PutObject가 되는데 GetObject가 안된다. 관련 권한 설정은 당연히 다 되어 있다.
	- 즉 - 원인 불명임
	- 따라서 그냥 **`admin.py`를 이용해 mp3 파일을 등록할 때, 플레이리스트 파일, 세그먼트 파일을 모두 같이 만들어버리는 방식으로 로직을 수정**하겠음

- 당연히 EC2 서버의 용량 관리에 주의해야 하는데 그건 원래부터 그랬음 ㅅㄱ
	- 관리를 할 곳이 크게 s3 버킷, ec2 서버의 hls_output, RDS 인데
	- hls_output의 용량이랑 RDS만 잘 관리해주면 될 듯?
	- 근데 파일을 자주 올렸다 내렸다 하지는 않을 거라서 상관 없을지도?


### 240514
- **이미지 업로드 안되는 문제 수정 완료**
- [[AWS - 테스트 코드]]가 정상적으로 스토리지 버킷에 들어가는 걸 봐서는..
	- 수정 내역 
	1. Nginx에서 `body`에 넣을 수 있는 용량 제한을 10M(b)으로 설정
	2. Django의 `settings.py`를 보면, `boto3` 관련 설정에 미스가 있었음
		1. `AWS_SECRET_ACCESS_KEY`로 써야 하는데 `AWS_SECRET_ACCESS_KEY_ID`로 썼다든가
		2. `AWS_DEFAULT_ACL = 'public-read'` 설정이 되어 있다든가. 이걸 없애주면 IAM이나 버킷 정책 선에서 권한이 관리가 된다. 저게 지정이 되어 있으면 '읽기' 권한만 들어감.
	3. 그 외에는 **`MEDIA_URL` 에 지정한 경로에 파일이 저장되지 않는다**는 것 정도? 저거는 Django 자체에서 접근할 때의 경로인 듯 하다.  모델의 `settings.py`에 지정한 버킷 경로 + `upload_to` 에 지정한 경로에 파일이 저장됨. 그래서 `upload_to`에 일일이 `media/`를 넣어줬다.
		- 그 다음은 이미지 저장 위치랑 불러오는 위치의 매칭을 잘 해주면 됨

### 240513
- IPv4 address 비용 줄이기 [AWS 퍼블릭 IPv4](https://shortcuts.tistory.com/53)
	- `RDS - 내 인스턴스 - 수정 - (추가 구성) - 퍼블릭 액세스 불가능`으로 설정한다.
		- RDS는 데이터 넣을 때마다 켰다 껐다 해야 할듯, 아니면 EC2 인스턴스에 넣든가.
	- 이거랑 **로드밸런서에서 나오는 2개의 IP**가 있다. 
	- 그 외에도, `퍼블릭 서브넷`에 대해 `서브넷 설정 편집 - 퍼블릭 IPv4 주소 자동 할당 활성화`를 해제해줬다.
	- 가만히 냅뒀으면 거의 월 9$ 정도 나왔을 듯.
- **데이터 수집 과정을 EC2 내부에 별도의 이미지로 띄워놨다.** 
	- **내일부터가 본격적인 실행**이라 지켜봐야 함. 일단 엔진 연결은 정상적으로 작동하는 것 같다. 외부 데이터를 잘 긁어올 수 있느냐가 문제겠지만.
	-  VPC 외부로 아웃바운드 연결해서 데이터를 긁어올 경우 월 최대 15GB 까지만 무료라고 한다. 눈팅을 잘 해야 할 듯?
	- 일반적으로 아웃바운드 규칙에 `80`, `443` 포트를 설정한다고 함
	- 컨테이너의 포트 설정 같은 경우는 인바운드가 많이 들어올 것으로 예상되는 서비스에서만 중요하다고 함. 즉 데이터 수집의 경우는 ec2에서 밖으로 나가는 통신이므로 크게 중요하지 않음.
- 프론트엔드에서 로그인 안 되는 문제 해결하기
	- 현상 : **코드에서 POST 요청으로 정의한 로그인 로직이, 백엔드에는 GET 요청으로 날아가고 있음.**
	- `Signin.tsx`를 보면, 분명히 프론트엔드에서는 `POST` 요청을 보내고 있는데, 백엔드에는 `Method Not Allowed`가 뜬다. 브라우저에서 확인했을 때, 요청 URL은 `https://api.htlee-blog.com/api/user/login/`인데 요청 메서드는 `GET`으로 되어 있음. 뭐지?????
	- 이외에도 로컬에서 됐는데 클라우드에서 잘 안되는 기능들은 대부분 **요청 경로 이슈**인 것 같다.  예를 들면 `도메인이름/api`로 접근해야 하는데, `도메인이름//api`로 들어간다든가, api 경로의 끝이 `/` 로 끝나지 않는다든가 등등.
- 이외에도 프론트엔드에서 아쉬웠던 서식들 변경
	- 폰트 크기
	- 수정, 삭제 버튼 위치
	- 등등..
- **이미지 업로드가 안됨**
	- 근데 **글은 써지는 거 보면 또 ec2 -> 스토리지 버킷 간의 문제 같음**
### 240512
- IPv4 비용은 로드밸런서에서 발생할 가능성이 높다고 함. 자체적으로 `퍼블릭 IP`를 할당받기 때문.
- [[AWS - DNS 서비스의 쿼리]]
- 프론트엔드 : 이미지 다시 못 가져오기 시작
	- **스토리지 버킷도 클라우드 프론트에 묶을 수 있음**
	- 그래서 웹사이트는 `/blog`, 스토리지는 `/storage`으로 설정
		- 근데 **웹에서 파일을 가져올 때, 클라우드프론트의 루트도메인을 기준으로 파일을 가져오려고 한다.** 
	- `app.tsx`의 경로가 기존에는 `''`으로 된 `path`가 2개였고, 바로 다음이 `:category`로 된 `path`여서, `/storage`와 충돌할 수 있었다 : 즉, `storage`를 `category`의 일부로 인식할 가능성 말이다.
		- 그래서 빈 경로를 `blog` 경로로 바꾸고, 클라우드 프론트의 기본 도메인 설정은 유지하고, `/blog` 은 제거하겠음
	- 위 부분은 `클라우드프론트 - 동작` 설정을 만져서 고칠 수 있다.
		- 이 설정으로 경로가 리액트처럼 겹치는 것도 없을 거임 : 클라우드프론트 선에서 거른 다음 들어갈 거라서

- 그래도 이미지를 못 가져옴.. 하.. 403 Forbidden이 뜬다.
- 아예 로컬에서의 접근부터 시도해봄 : `s3` 버킷으로 로컬에서 접근했을 때 access denied가 뜸 -> 아래 정책 추가로 접근 가능해짐
```json
{
	"Sid": "AllowAccessFromSpecificIP",
	"Effect": "Allow",
	"Principal": "*",
	"Action": "s3:GetObject",
	"Resource": "arn:aws:s3:::스토리지 버킷 이름/*",
	"Condition": {
		"IpAddress": {
			"aws:SourceIp": "내 로컬 IP"
		}
	}
}
```

- 클라우드프론트 도메인으로 로컬에서 접근 : `Access Denied`가 뜸
- `s3` 버킷으로는 이미지에 접근이 되는데, 왜 클라우드프론트로는 접근이 안되지?
	- 클라우드 프론트에서 `storage/`로 돌리는 부분에 문제가 있나?
- `OAC`를 클라우드프론트에 적용할 때, `s3` 버킷에 OAC를 허용하는 정책이 있어야 한다고 함
	- 이걸 Claude는 안 알려준다. 그냥 OAC만 붙이면 되는 줄;
```json
		{
		    "Sid": "AllowCloudFrontServicePrincipalReadWrite",
            "Effect": "Allow",
            "Principal": {
                "Service": "cloudfront.amazonaws.com"
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::{bucket-name}/*",
            "Condition": {
                "StringEquals": {
                    "AWS:SourceArn": "arn:aws:cloudfront::111122223333:distribution/<CloudFront distribution ID>"
                }
		    }
		}
```
- 그래도 안되네 후

- **지금 시도할 수 있는 건 다 해봣는데 다 안돼서**
- **그냥 s3 버킷의 이미지를 직접 가져오는 방식으로 두겠다**
  
### 240511
- **로드밸런서에 ec2 인스턴스가 매핑되지 않는 문제 해결**
	- O : 탄력적 IP 주소로 연결되는 EC2 인스턴스에 접근 
	- X : 로드밸런서의 DNS로 접근 - "사이트에서 연결을 거부했습니다"
	- X : 로드밸런서로 설정된 도메인에 접근 - "504 Gateway TimeOut"
	- [[AWS - EC2와 로드밸런서 연결하기]]


### 240510
- SSL 인증 과정 진행 중
	- ACM 에서 인증서 요청 후, 도메인을 넣고 Route 53에서 레코드 생성을 누르면 된다 
	- 주의할 점은, Cloudfront에 연결하겠다면 인증서 자체를 `us-east-1`에서 받아야 함
		- 즉, 에이펙스 및 `www`는 `us-east-1`에서 인증서를 받아야 하고
		- `api`는 `ap-northeast-2`에서 받으면 된다.
	- ACM에서 인증서를 받더라도, **직접 다운받을 수는 없는 것으로 보인다**.
		- 이를 해결하는 방법으로 `Elastic Load Balancer`가 있단다
			- `CLB Classic LoadBalancer`는 프리티어 월 750시간 무료
			- `Application LB`와 `Network LB`는 프리 티어에서 월 750시간 무료이나, 일부 기능에 대해 비용이 부과될 수 있다
			- 기존의 ACM 인증서를 사용, SSL/TLS 종료를 처리할 수 있다.
- 일단 **백엔드 접근은 `https://`가 가능**해짐
	- `어플리케이션 로드밸런서` 이용
- 프론트엔드도 **https:// 접근이 가능**해짐
	- `클라우드 프론트 - 내 배포 - 설정 - 편집 - 대체 도메인 이름 2개 넣기 + 사용자 정의 SSL 인증서 넣기`
	- [이 글 참조](https://repost.aws/knowledge-center/resolve-cloudfront-bad-request-error)
		- 이 형님에게 개추를 박아주세요

- 최종적으로 프론트엔드 -> 백엔드의 요청까지 과정
	1. 사용자가 프론트엔드에 접속
	2. 클라우드 프론트는 SSL/TLS 종료 처리 및 오리진`s3 버킷`에서 컨텐츠를 가져와 전달
	3. 프론트엔드 앱은 백엔드 API를 호출
	4. 클라우드 프론트는 HTTPS 요청을 로드밸런서로 전달
	5. 로드밸런서는 SSL/TLS 종료 처리, **HTTP**를 사용해 요청을 EC2 인스턴스로 전달
	6. EC2 인스턴스의 Django 앱은 요청 처리, 응답 반환
		- 포트는 `80 - 80` 연결로 충분
	7. 로드밸런서는 응답을 HTTPS를 이용해 클라우드프론트로 전달
	8. 클라우드프론트는 응답을 사용자의 브라우저로 전달

- `데이터 수집 -> RDS 저장`이 되지 않을 때, 즉 `conn` 값이 `None`으로 나오는 경우는 내 IP가 바뀌었을 가능성이 높다. 
	- `인바운드 규칙`에서 [현재 ip(whatismyip)](https://www.whatismyip.com/)을 넣어주자.

- [[AWS - 보안 그룹의 소스가 다른 보안 그룹이다]]
	- 바뀌는 로컬 ip들이나, 클라우드 ip들을 보안 그룹으로 관리할 수 없는 이유
	- 클라우드프론트으로부터의 접근을 허용하려면 **단순히 해당 리전의 ip 범위를 ec2 인바운드로드밸런서의 인바운드에 넣으면 된다.**

- 도메인 끝에 `.`이 찍히는 이유
	- 이런 형식을 `FQDN : Fully Qualified Domain Name`이라고 한다.
	- 일반적으로는 마지막에 오는 `.`을 생략한다. 즉 `.`이 있든 없든 같은 도메인임


### 240509
#### 에러
- 오늘도~~~~ 죽이고 싶은~~~~ 도메인 - 인스턴스 연결과 ~~~~ 싸운다 ~~~~
- 여전히 프론트엔드는 접근 시 클라우드프론트에서 발생시키는 `403`에러 발생
- 백엔드는 `사이트에서 접근 차단`이 뜨고 있다.
	- **근데 `:8000`을 붙이면 접근이 된다!**
#### 해결?
- **백엔드**의 경우 `:8000`을 붙이면 Django에 접근이 되는 것으로 보임 
	- 즉, **포트 매핑 문제**로 보인다
		- 현재 `docker run -p 8000:8000`인데,
		- 이는 호스트로 들어오는 8000 요청을 컨테이너의 8000번 포트가 받겠다는 의미가 된다. 
		- 그렇다면 `nginx.conf`에 설정된 `80->8000` 이 적용될 수 없다 : 컨테이너 내부에서 봣을 때
			- `80`번 포트는 인스턴스에 못 들어오고 입구컷 당함
			- `8000`번 포트만이 들어옴
			- 그런데 `nginx`는 `80`번 포트를 보고 있음 - 들어오는 게 없으니 `nginx`가 사실상 하는 게 없다
	- 전체적인 포트에 관한 설정은 크게
		- `docker run -p a:b` 부분 : 인스턴스 포트(외부) - 컨테이너 포트(내부) 매핑
		- `dockerfile의 EXPOSE x` : 컨테이너의 `x` 포트를 외부에 노출함
			- 이 부분은 실제로 포트를 여는 게 아니라, Dockerfile을 보는 사람에게 알려주는 것에 불과하다. 실제로는 `docker run -p a:b`에서 포트를 여는 작업이 이뤄짐.
		- `gunicorn --bind 0.0.0.0:8000 backend.wsgi` : 로컬호스트 8000번에 백엔드 서버 실행
		- `nginx.conf`
```conf
    upstream django {
        server localhost:8000;
    }

    server {
        listen 80;
```
> 컨테이너 내부에서 80 포트만을 기다리고, `localhost`의 8000으로 전달함

- 따라서, 최종적으로는
	1. 인스턴스의 `80` 포트로 들어오는 요청을 컨테이너의 `80`으로 전달함 : `docker run -p 80:80`
	2. `nginx`에서는 `80`으로 들어오는 요청을 `gunicorn`이 실행되는 `localhost:8000`에 전달함 (위 `nginx.conf`)
	3. `gunicorn`은 `8000`번 포트에서 실행됨 `CMD ["gunicorn", "--bind", "0.0.0.0:8000", "backend.wsgi:application"]`

- 프론트엔드에서 클라우드프론트에 접근할 때 403 에러가 뜨는 이유는, https:// 접속이 아니기 때문
- 따라서 그냥 SSL 발급부터 시작하면 된다.



### 240508
- 일단 다른 것보다 SSL 인증서를 받아서 `https://`로 도메인부터 구성해야 할 것 같다
	- 프론트엔드도 `cloudfront`를 이용해 도메인 구성을 할 수 있다는데, 이전에 네트워크 인터페이스랑 WAF 때문에 돈이 나간 적이 있어서 여기는 천천히 수정하겠음
- 헷갈린다 :  [[Django - 이미지 static과 media의 차이]]
- [[AWS - EC2 인스턴스에 SSL 인증하기]]
	- 일단 `http`로 서버를 띄운 상태에서 SSL 인증서를 받아 별도로 관리한 다음, 이후에 `nginx.conf`을 수정하고 `https://`로 서버를 띄우면서 해당 인증서를 넣는 방식을 취해보겠음
	- **EC2 기본 도메인은 인증서 발급이 안되는 듯?** 후...
- 탄력적 IP 사용 시작
- **도메인 구매 완료(hltee-blog.com), 하프도메인**
 - **결국 HTTPS 를 쓰려면 도메인을 사야 함**
	- 대신 **프론트엔드 / 백엔드 도메인을 분리할 필요는 없다.** 하나의 도메인 아래에서 둘 모두를 관리할 수 있음.
	- 백엔드 admin이 깨지는 현상도 `http` 통신의 불안정성 때문인 것으로 보임
	- 즉 이 프로젝트는 그냥 **도메인을 사서 -> SSL 인증서를 받아서 -> HTTPS를 이용할 수 있게끔** 해야 함
	- 지금 대충 이런 느낌이다
		- **HTTPS**를 써야 백엔드 CSS도 깨지지 않는다 -> 그러면 프론트엔드도 S3 배포가 아니라 클라우드 프론트를 써야 한다 -> 클라우드 프론트를 만들어야겠네? -> 비용은 안나오나? 같은 굴레에 빠져버림
- 도메인 적용 중
	- 클라우드프론트 다시 실행
	- Route 53에 `호스팅 영역` 생성, 
		- `api.htlee-blog.com`에 백엔드 연결
		- `www.htlee-blog.com`에 프론트엔드(클라우드프론트) 연결
			- `htlee-blog.com`도 프론트엔드 연결을 하고 싶은데 CNAME은 안된단다. 클라우드프론트의 IP주소를 찾는 방법이 있기는 함
- **정작 도메인으로 접근했을 때 연결이 안되는 문제가 있어서 그거 해결 중**
	- **각자의 원래 URL에 대해서는 사이트가 잘 뜨는 중**

### 240507
- [[AWS - 프론트엔드에서 다른 s3 버킷 스토리지의 파일 가져오기]] 
	- 음악 파일 스트리밍 구현 완료
- 로그인 유지 안되는 문제 시작
	- [[AWS - 인스턴스와 포트 관련]]

### 240506
- 일단 비용 관리 : 3$ 정도의 비용이 발생하고 있다.
	- [[AWS - 비용 관리]] 에 정리해둠.

- `s3 프론트엔드 버킷` -> `s3 스토리지 버킷`으로 접근하기
	- `s3` 스토리지가 퍼블릭 액세스 차단이면 `http://`로 그 값을 가져오는 건 불가능함
	- 그냥 **모든** 퍼블릭 액세스 차단이 문제였음. [[AWS - 프론트엔드에서 다른 s3 버킷 스토리지의 파일 가져오기]]


### 240505
- 오늘은 어린이날!!!!!! 와!!!!
- 일단 S3, EC2, RDS 연결까지는 성공
- **이런 문제들이 새로 발생하고 있다 슈박!!** 
	1. 프론트엔드가 `http`만 적용되는 문제 (보안 관련 이슈가 있어 보임)
	2. 음악, 이미지 등 별도의 s3 버킷으로 돌린 경우 로드 안됨
	3. 로그인 유지가 안됨 (로그인 하고 얼마 안돼서 바로 튕김)
	4. subsection style 적용 안됨(Redux 문제??)
- [[★) 무지성 WSL2 + Docker 재설치]]
- 일단 **프론트엔드에서 저장 버킷의 데이터들을 정상적으로 가져오도록** 해야 함. 
	- 스토리지 버킷 - 프론트엔드 간의 `CORS` 설정 필요
	- EC2 백엔드에 IAM 권한 추가 : `AmazonS3ReadOnlyAccess`이 들어 있음 -> 근데 상황이 나아지진 않았음
	- subsection style 못 가져오는 문제 수정 : `app.tsx`에 `backend`가 `localhost:8000`으로 설정돼있었다.

### 240503
- **데이터 수집 부분은 그냥 로컬로 진행하려 한다.**
> 1. VPC 내부에서 인터넷 게이트웨이를 뒀는데, 5분 로딩 이후 튕김. HTTPS 아웃바운드 규칙은 당연히 다 ON인 상황.
> 2. 찾아보니까 VPC 외부에 두는 방법도 있는데, RDS랑 ssm에 접근해야 해서 X
> 3. VPC 내부에서 프라이빗 서브넷과 NAT 게이트웨이를 두는 방법도 있다. 근데 NAT 게이트웨이는 비용이 나간다.
> 4. NAT 인스턴스를 쓰는 방법도 있는데, EC2에는 Django를 띄울 예정이다.
- 그래서 일단 로컬에서 작업한 내용인 `docker compose up`을 띄워본 다음, 해당 RDS로 데이터가 잘 전송되는지만 확인하면 될 것 같음!
- [[Docker 청소하기]]
- 하나를 넘으니까 또 하나가 안되죠? 후..
	- [[AWS - Lambda 함수 시행착오]]
	- [[AWS - 네트워크 대충 알기]]
	- NAT 인스턴스 시도하기
		- 얘도 EC2를 써야 하는데..
### 240502
- [[AWS - RDS(MySQL) 설정하기]] : 작업 완료
> 	작업은 아래처럼 가져갔다.
> 	0. `RDS 콘솔`에서 `수정 - 퍼블릭 액세스 가능`으로 변경
> 	1. `mysql -h [RDS엔드포인트] -u [RDS마스터이름] -p`로 RDS의 mysql에 접근
> 	2. `CREATE DATABASE blog`, `CREATE DATABASE steam`으로 2개의 DB를 생성
> 	3. `exit`로 나온 다음, `mysql -h [RDS엔드포인트] -u [RDS마스터이름] -p [db이름] < [db백업파일.sql]`로 백업 파일을 데이터베이스에 등록
> 	4. `RDS 콘솔 - 데이터베이스 - 수정 - 퍼블릭 액세스 불가능`으로 다시 변경
- [[AWS - Lambda 함수 띄우기]]
	- [[AWS - Systems Manager Parameter Store로 환경 변수 세팅하기]]

- 저 Lambda 함수에서 계속 무한 로딩이 걸린다.
	1. 엔드포인트의 필요성
		- `Lambda` 함수에서 `ssm`에 저장한 환경 변수를 가져와야 함
		- 그러려면 AWS 서비스에 액세스를 해야 함
		- 일반적으로 VPC 내의 리소스가 AWS 서비스에 액세스하려면 인터넷 게이트웨이 or NAT 게이트웨이로 퍼블릭 인터넷을 거쳐야 함
		- 그런데 **VPC 엔드포인트**를 사용하면 AWS 네트워크 내에서 AWS 서비스에 연결할 수 있음
			- `게이트웨이 엔드포인트` : S3, DynamoDB 등
			- `인터페이스 엔드포인트` : 대부분의 AWS 서비스에 대한 액세스를 제공함. 고유의 프라이빗 IP 주소를 가짐.
	2. 엔드포인트 설정
		1. `서비스 이름` : `com.amazonaws.ap-northeast-2.ssm`
		2. VPC, 퍼블릭 서브넷(람다의 설정과 동일)
		3. 엔드 포인트 정책 : `전체 액세스`
	



### 240501
- 클라우드에 프로젝트 띄우기 진행 중
	- [[AWS - EC2에 Django 배포하기]] : Putty를 통해 우분투 쉘로 접근하는 것까지 성공
	- 백엔드부터 띄우려고 하니까 또 생각해볼 게 다른 인스턴스들과의 연결이다
	- [[AWS - S3 + Cloudfront 프론트엔드 설정하기]] : 서버 뜨는 것까지 확인 완료
		- 주소(임시) : `http://htlee-frontend.s3-website.ap-northeast-2.amazonaws.com/`
	- [[AWS - RDS(MySQL) 설정하기]]
		- 설정 중 인스턴스를 띄우고, 로컬에서 `mysql` 명령어로 접근하는 도중, `HY000`에러가 발생했다. 여기서 막힘.
